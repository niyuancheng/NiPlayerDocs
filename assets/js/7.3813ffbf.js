(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{278:function(t,e,i){
/*!
 * Socket.IO v4.6.0
 * (c) 2014-2023 Guillermo Rauch
 * Released under the MIT License.
 */
t.exports=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(){return(s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,i){return(l=h()?Reflect.construct.bind():function(t,e,i){var n=[null];n.push.apply(n,e);var s=new(Function.bind.apply(t,n));return i&&a(s,i.prototype),s}).apply(null,arguments)}function d(t){var e="function"==typeof Map?new Map:void 0;return(d=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return l(t,arguments,o(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}function u(t){var e=h();return function(){var i,n=o(t);if(e){var s=o(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return c(this,i)}}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}function m(){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=f(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(arguments.length<3?t:i):s.value}}).apply(this,arguments)}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function v(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return g(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw r}}}}var b=Object.create(null);b.open="0",b.close="1",b.ping="2",b.pong="3",b.message="4",b.upgrade="5",b.noop="6";var y=Object.create(null);Object.keys(b).forEach((function(t){y[b[t]]=t}));for(var _={type:"error",data:"parser error"},x="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),w="function"==typeof ArrayBuffer,k=function(t,e,i){var n,s=t.type,r=t.data;return x&&r instanceof Blob?e?i(r):S(r,i):w&&(r instanceof ArrayBuffer||(n=r,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer))?e?i(r):S(new Blob([r]),i):i(b[s]+(r||""))},S=function(t,e){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];e("b"+t)},i.readAsDataURL(t)},E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T="undefined"==typeof Uint8Array?[]:new Uint8Array(256),U=0;U<E.length;U++)T[E.charCodeAt(U)]=U;var B="function"==typeof ArrayBuffer,C=function(t,e){if("string"!=typeof t)return{type:"message",data:I(t,e)};var i=t.charAt(0);return"b"===i?{type:"message",data:A(t.substring(1),e)}:y[i]?t.length>1?{type:y[i],data:t.substring(1)}:{type:y[i]}:_},A=function(t,e){if(B){var i=function(t){var e,i,n,s,r,o=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(e=0;e<a;e+=4)i=T[t.charCodeAt(e)],n=T[t.charCodeAt(e+1)],s=T[t.charCodeAt(e+2)],r=T[t.charCodeAt(e+3)],d[h++]=i<<2|n>>4,d[h++]=(15&n)<<4|s>>2,d[h++]=(3&s)<<6|63&r;return l}(t);return I(i,e)}return{base64:!0,data:t}},I=function(t,e){switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},z=String.fromCharCode(30);function L(t){if(t)return function(t){for(var e in L.prototype)t[e]=L.prototype[e];return t}(t)}L.prototype.on=L.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},L.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},L.prototype.off=L.prototype.removeListener=L.prototype.removeAllListeners=L.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;s<n.length;s++)if((i=n[s])===e||i.fn===e){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},L.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){n=0;for(var s=(i=i.slice(0)).length;n<s;++n)i[n].apply(this,e)}return this},L.prototype.emitReserved=L.prototype.emit,L.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},L.prototype.hasListeners=function(t){return!!this.listeners(t).length};var P="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function O(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return i.reduce((function(e,i){return t.hasOwnProperty(i)&&(e[i]=t[i]),e}),{})}var D=P.setTimeout,N=P.clearTimeout;function R(t,e){e.useNativeTimers?(t.setTimeoutFn=D.bind(P),t.clearTimeoutFn=N.bind(P)):(t.setTimeoutFn=P.setTimeout.bind(P),t.clearTimeoutFn=P.clearTimeout.bind(P))}var F,M=function(t){r(s,t);var i=u(s);function s(t,n,r){var o;return e(this,s),(o=i.call(this,t)).description=n,o.context=r,o.type="TransportError",o}return n(s)}(d(Error)),H=function(t){r(s,t);var i=u(s);function s(t){var n;return e(this,s),(n=i.call(this)).writable=!1,R(p(n),t),n.opts=t,n.query=t.query,n.socket=t.socket,n}return n(s,[{key:"onError",value:function(t,e,i){return m(o(s.prototype),"emitReserved",this).call(this,"error",new M(t,e,i)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(t){"open"===this.readyState&&this.write(t)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,m(o(s.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(t){var e=C(t,this.socket.binaryType);this.onPacket(e)}},{key:"onPacket",value:function(t){m(o(s.prototype),"emitReserved",this).call(this,"packet",t)}},{key:"onClose",value:function(t){this.readyState="closed",m(o(s.prototype),"emitReserved",this).call(this,"close",t)}},{key:"pause",value:function(t){}}]),s}(L),G="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),j={},V=0,Y=0;function q(t){var e="";do{e=G[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function W(){var t=q(+new Date);return t!==F?(V=0,F=t):t+"."+q(V++)}for(;Y<64;Y++)j[G[Y]]=Y;function K(t){var e="";for(var i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function X(t){for(var e={},i=t.split("&"),n=0,s=i.length;n<s;n++){var r=i[n].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}var $=!1;try{$="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}var Q=$;function Z(t){var e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Q))return new XMLHttpRequest}catch(t){}if(!e)try{return new(P[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function J(){}var tt=null!=new Z({xdomain:!1}).responseType,et=function(t){r(o,t);var i=u(o);function o(t){var n;if(e(this,o),(n=i.call(this,t)).polling=!1,"undefined"!=typeof location){var s="https:"===location.protocol,r=location.port;r||(r=s?"443":"80"),n.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port,n.xs=t.secure!==s}var a=t&&t.forceBase64;return n.supportsBinary=tt&&!a,n}return n(o,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(t){var e=this;this.readyState="pausing";var i=function(){e.readyState="paused",t()};if(this.polling||!this.writable){var n=0;this.polling&&(n++,this.once("pollComplete",(function(){--n||i()}))),this.writable||(n++,this.once("drain",(function(){--n||i()})))}else i()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(t){var e=this;(function(t,e){for(var i=t.split(z),n=[],s=0;s<i.length;s++){var r=C(i[s],e);if(n.push(r),"error"===r.type)break}return n})(t,this.socket.binaryType).forEach((function(t){if("opening"===e.readyState&&"open"===t.type&&e.onOpen(),"close"===t.type)return e.onClose({description:"transport closed by the server"}),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var t=this,e=function(){t.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}},{key:"write",value:function(t){var e=this;this.writable=!1,function(t,e){var i=t.length,n=new Array(i),s=0;t.forEach((function(t,r){k(t,!1,(function(t){n[r]=t,++s===i&&e(n.join(z))}))}))}(t,(function(t){e.doWrite(t,(function(){e.writable=!0,e.emitReserved("drain")}))}))}},{key:"uri",value:function(){var t=this.query||{},e=this.opts.secure?"https":"http",i="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=W()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port);var n=K(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}},{key:"request",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(t,{xd:this.xd,xs:this.xs},this.opts),new it(this.uri(),t)}},{key:"doWrite",value:function(t,e){var i=this,n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",(function(t,e){i.onError("xhr post error",t,e)}))}},{key:"doPoll",value:function(){var t=this,e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(function(e,i){t.onError("xhr poll error",e,i)})),this.pollXhr=e}}]),o}(H),it=function(t){r(s,t);var i=u(s);function s(t,n){var r;return e(this,s),R(p(r=i.call(this)),n),r.opts=n,r.method=n.method||"GET",r.uri=t,r.async=!1!==n.async,r.data=void 0!==n.data?n.data:null,r.create(),r}return n(s,[{key:"create",value:function(){var t=this,e=O(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;var i=this.xhr=new Z(e);try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var n in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&i.setRequestHeader(n,this.opts.extraHeaders[n])}catch(t){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{i.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||1223===i.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"==typeof i.status?i.status:0)}),0))},i.send(this.data)}catch(e){return void this.setTimeoutFn((function(){t.onError(e)}),0)}"undefined"!=typeof document&&(this.index=s.requestsCount++,s.requests[this.index]=this)}},{key:"onError",value:function(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=J,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete s.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),s}(L);function nt(){for(var t in it.requests)it.requests.hasOwnProperty(t)&&it.requests[t].abort()}it.requestsCount=0,it.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",nt):"function"==typeof addEventListener&&addEventListener("onpagehide"in P?"pagehide":"unload",nt,!1));var st="function"==typeof Promise&&"function"==typeof Promise.resolve?function(t){return Promise.resolve().then(t)}:function(t,e){return e(t,0)},rt=P.WebSocket||P.MozWebSocket,ot="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),at={websocket:function(t){r(s,t);var i=u(s);function s(t){var n;return e(this,s),(n=i.call(this,t)).supportsBinary=!t.forceBase64,n}return n(s,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var t=this.uri(),e=this.opts.protocols,i=ot?{}:O(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=ot?new rt(t,e,i):e?new rt(t,e):new rt(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var t=this;this.ws.onopen=function(){t.opts.autoUnref&&t.ws._socket.unref(),t.onOpen()},this.ws.onclose=function(e){return t.onClose({description:"websocket connection closed",context:e})},this.ws.onmessage=function(e){return t.onData(e.data)},this.ws.onerror=function(e){return t.onError("websocket error",e)}}},{key:"write",value:function(t){var e=this;this.writable=!1;for(var i=function(i){var n=t[i],s=i===t.length-1;k(n,e.supportsBinary,(function(t){try{e.ws.send(t)}catch(t){}s&&st((function(){e.writable=!0,e.emitReserved("drain")}),e.setTimeoutFn)}))},n=0;n<t.length;n++)i(n)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var t=this.query||{},e=this.opts.secure?"wss":"ws",i="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=W()),this.supportsBinary||(t.b64=1);var n=K(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}},{key:"check",value:function(){return!!rt}}]),s}(H),polling:et},ht=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,lt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function dt(t){var e,i,n=t,s=t.indexOf("["),r=t.indexOf("]");-1!=s&&-1!=r&&(t=t.substring(0,s)+t.substring(s,r).replace(/:/g,";")+t.substring(r,t.length));for(var o,a,h=ht.exec(t||""),l={},d=14;d--;)l[lt[d]]=h[d]||"";return-1!=s&&-1!=r&&(l.source=n,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(e=l.path,i=e.replace(/\/{2,9}/g,"/").split("/"),"/"!=e.slice(0,1)&&0!==e.length||i.splice(0,1),"/"==e.slice(-1)&&i.splice(i.length-1,1),i),l.queryKey=(o=l.query,a={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(a[e]=i)})),a),l}var pt=function(i){r(a,i);var o=u(a);function a(i){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e(this,a),(n=o.call(this)).writeBuffer=[],i&&"object"===t(i)&&(r=i,i=null),i?(i=dt(i),r.hostname=i.host,r.secure="https"===i.protocol||"wss"===i.protocol,r.port=i.port,i.query&&(r.query=i.query)):r.host&&(r.hostname=dt(r.host).host),R(p(n),r),n.secure=null!=r.secure?r.secure:"undefined"!=typeof location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=n.secure?"443":"80"),n.hostname=r.hostname||("undefined"!=typeof location?location.hostname:"localhost"),n.port=r.port||("undefined"!=typeof location&&location.port?location.port:n.secure?"443":"80"),n.transports=r.transports||["polling","websocket"],n.writeBuffer=[],n.prevBufferLen=0,n.opts=s({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},r),n.opts.path=n.opts.path.replace(/\/$/,"")+(n.opts.addTrailingSlash?"/":""),"string"==typeof n.opts.query&&(n.opts.query=X(n.opts.query)),n.id=null,n.upgrades=null,n.pingInterval=null,n.pingTimeout=null,n.pingTimeoutTimer=null,"function"==typeof addEventListener&&(n.opts.closeOnBeforeunload&&(n.beforeunloadEventListener=function(){n.transport&&(n.transport.removeAllListeners(),n.transport.close())},addEventListener("beforeunload",n.beforeunloadEventListener,!1)),"localhost"!==n.hostname&&(n.offlineEventListener=function(){n.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",n.offlineEventListener,!1))),n.open(),n}return n(a,[{key:"createTransport",value:function(t){var e=s({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);var i=s({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new at[t](i)}},{key:"open",value:function(){var t,e=this;if(this.opts.rememberUpgrade&&a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){e.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}},{key:"setTransport",value:function(t){var e=this;this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(t){return e.onClose("transport close",t)}))}},{key:"probe",value:function(t){var e=this,i=this.createTransport(t),n=!1;a.priorWebsocketSuccess=!1;var s=function(){n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",(function(t){if(!n)if("pong"===t.type&&"probe"===t.data){if(e.upgrading=!0,e.emitReserved("upgrading",i),!i)return;a.priorWebsocketSuccess="websocket"===i.name,e.transport.pause((function(){n||"closed"!==e.readyState&&(p(),e.setTransport(i),i.send([{type:"upgrade"}]),e.emitReserved("upgrade",i),i=null,e.upgrading=!1,e.flush())}))}else{var s=new Error("probe error");s.transport=i.name,e.emitReserved("upgradeError",s)}})))};function r(){n||(n=!0,p(),i.close(),i=null)}var o=function(t){var n=new Error("probe error: "+t);n.transport=i.name,r(),e.emitReserved("upgradeError",n)};function h(){o("transport closed")}function l(){o("socket closed")}function d(t){i&&t.name!==i.name&&r()}var p=function(){i.removeListener("open",s),i.removeListener("error",o),i.removeListener("close",h),e.off("close",l),e.off("upgrading",d)};i.once("open",s),i.once("error",o),i.once("close",h),this.once("close",l),this.once("upgrading",d),i.open()}},{key:"onOpen",value:function(){if(this.readyState="open",a.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},{key:"onPacket",value:function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}},{key:"onHandshake",value:function(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var t=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){t.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var t,e=1,i=0;i<this.writeBuffer.length;i++){var n=this.writeBuffer[i].data;if(n&&(e+="string"==typeof(t=n)?function(t){for(var e=0,i=0,n=0,s=t.length;n<s;n++)(e=t.charCodeAt(n))<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}(t):Math.ceil(1.33*(t.byteLength||t.size))),i>0&&e>this.maxPayload)return this.writeBuffer.slice(0,i);e+=2}return this.writeBuffer}},{key:"write",value:function(t,e,i){return this.sendPacket("message",t,e,i),this}},{key:"send",value:function(t,e,i){return this.sendPacket("message",t,e,i),this}},{key:"sendPacket",value:function(t,e,i,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof i&&(n=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){(i=i||{}).compress=!1!==i.compress;var s={type:t,data:e,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}}},{key:"close",value:function(){var t=this,e=function(){t.onClose("forced close"),t.transport.close()},i=function i(){t.off("upgrade",i),t.off("upgradeError",i),e()},n=function(){t.once("upgrade",i),t.once("upgradeError",i)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){t.upgrading?n():e()})):this.upgrading?n():e()),this}},{key:"onError",value:function(t){a.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}},{key:"onClose",value:function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(t){for(var e=[],i=0,n=t.length;i<n;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}]),a}(L);pt.protocol=4,pt.protocol;var ct,ut="function"==typeof ArrayBuffer,ft=Object.prototype.toString,mt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ft.call(Blob),gt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ft.call(File);function vt(t){return ut&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))||mt&&t instanceof Blob||gt&&t instanceof File}function bt(e){var i=[],n=e.data,s=e;return s.data=function e(i,n){if(!i)return i;if(vt(i)){var s={_placeholder:!0,num:n.length};return n.push(i),s}if(Array.isArray(i)){for(var r=new Array(i.length),o=0;o<i.length;o++)r[o]=e(i[o],n);return r}if("object"===t(i)&&!(i instanceof Date)){var a={};for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(a[h]=e(i[h],n));return a}return i}(n,i),s.attachments=i.length,{packet:s,buffers:i}}function yt(e,i){return e.data=function e(i,n){if(!i)return i;if(i&&!0===i._placeholder){if("number"==typeof i.num&&i.num>=0&&i.num<n.length)return n[i.num];throw new Error("illegal attachments")}if(Array.isArray(i))for(var s=0;s<i.length;s++)i[s]=e(i[s],n);else if("object"===t(i))for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(i[r]=e(i[r],n));return i}(e.data,i),delete e.attachments,e}!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(ct||(ct={}));var _t=function(){function i(t){e(this,i),this.replacer=t}return n(i,[{key:"encode",value:function(e){return e.type!==ct.EVENT&&e.type!==ct.ACK||!function e(i,n){if(!i||"object"!==t(i))return!1;if(Array.isArray(i)){for(var s=0,r=i.length;s<r;s++)if(e(i[s]))return!0;return!1}if(vt(i))return!0;if(i.toJSON&&"function"==typeof i.toJSON&&1===arguments.length)return e(i.toJSON(),!0);for(var o in i)if(Object.prototype.hasOwnProperty.call(i,o)&&e(i[o]))return!0;return!1}(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ct.EVENT?ct.BINARY_EVENT:ct.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(t){var e=""+t.type;return t.type!==ct.BINARY_EVENT&&t.type!==ct.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}},{key:"encodeAsBinary",value:function(t){var e=bt(t),i=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(i),n}}]),i}(),xt=function(i){r(a,i);var s=u(a);function a(t){var i;return e(this,a),(i=s.call(this)).reviver=t,i}return n(a,[{key:"add",value:function(t){var e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var i=(e=this.decodeString(t)).type===ct.BINARY_EVENT;i||e.type===ct.BINARY_ACK?(e.type=i?ct.EVENT:ct.ACK,this.reconstructor=new wt(e),0===e.attachments&&m(o(a.prototype),"emitReserved",this).call(this,"decoded",e)):m(o(a.prototype),"emitReserved",this).call(this,"decoded",e)}else{if(!vt(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,m(o(a.prototype),"emitReserved",this).call(this,"decoded",e))}}},{key:"decodeString",value:function(t){var e=0,i={type:Number(t.charAt(0))};if(void 0===ct[i.type])throw new Error("unknown packet type "+i.type);if(i.type===ct.BINARY_EVENT||i.type===ct.BINARY_ACK){for(var n=e+1;"-"!==t.charAt(++e)&&e!=t.length;);var s=t.substring(n,e);if(s!=Number(s)||"-"!==t.charAt(e))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(e+1)){for(var r=e+1;++e&&","!==t.charAt(e)&&e!==t.length;);i.nsp=t.substring(r,e)}else i.nsp="/";var o=t.charAt(e+1);if(""!==o&&Number(o)==o){for(var h=e+1;++e;){var l=t.charAt(e);if(null==l||Number(l)!=l){--e;break}if(e===t.length)break}i.id=Number(t.substring(h,e+1))}if(t.charAt(++e)){var d=this.tryParse(t.substr(e));if(!a.isPayloadValid(i.type,d))throw new Error("invalid payload");i.data=d}return i}},{key:"tryParse",value:function(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,i){switch(e){case ct.CONNECT:return"object"===t(i);case ct.DISCONNECT:return void 0===i;case ct.CONNECT_ERROR:return"string"==typeof i||"object"===t(i);case ct.EVENT:case ct.BINARY_EVENT:return Array.isArray(i)&&i.length>0;case ct.ACK:case ct.BINARY_ACK:return Array.isArray(i)}}}]),a}(L),wt=function(){function t(i){e(this,t),this.packet=i,this.buffers=[],this.reconPack=i}return n(t,[{key:"takeBinaryData",value:function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=yt(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),t}(),kt=Object.freeze({__proto__:null,protocol:5,get PacketType(){return ct},Encoder:_t,Decoder:xt});function St(t,e,i){return t.on(e,i),function(){t.off(e,i)}}var Et=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Tt=function(t){r(a,t);var i=u(a);function a(t,n,r){var o;return e(this,a),(o=i.call(this)).connected=!1,o.recovered=!1,o.receiveBuffer=[],o.sendBuffer=[],o._queue=[],o.ids=0,o.acks={},o.flags={},o.io=t,o.nsp=n,r&&r.auth&&(o.auth=r.auth),o._opts=s({},r),o.io._autoConnect&&o.open(),o}return n(a,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var t=this.io;this.subs=[St(t,"open",this.onopen.bind(this)),St(t,"packet",this.onpacket.bind(this)),St(t,"error",this.onerror.bind(this)),St(t,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.unshift("message"),this.emit.apply(this,e),this}},{key:"emit",value:function(t){if(Et.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(i.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;var s={type:ct.EVENT,data:i,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof i[i.length-1]){var r=this.ids++,o=i.pop();this._registerAckCallback(r,o),s.id=r}var a=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,h=this.flags.volatile&&(!a||!this.connected);return h||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}},{key:"_registerAckCallback",value:function(t,e){var i,n=this,s=null!==(i=this.flags.timeout)&&void 0!==i?i:this._opts.ackTimeout;if(void 0!==s){var r=this.io.setTimeoutFn((function(){delete n.acks[t];for(var i=0;i<n.sendBuffer.length;i++)n.sendBuffer[i].id===t&&n.sendBuffer.splice(i,1);e.call(n,new Error("operation has timed out"))}),s);this.acks[t]=function(){n.io.clearTimeoutFn(r);for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];e.apply(n,[null].concat(i))}}else this.acks[t]=e}},{key:"emitWithAck",value:function(t){for(var e=this,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(i,s){n.push((function(t,e){return r?t?s(t):i(e):i(t)})),e.emit.apply(e,[t].concat(n))}))}},{key:"_addToQueue",value:function(t){var e,i=this;"function"==typeof t[t.length-1]&&(e=t.pop());var n={id:this.ids++,tryCount:0,pending:!1,args:t,flags:s({fromQueue:!0},this.flags)};t.push((function(t){if(n===i._queue[0]){var s=null!==t;if(s)n.tryCount>i._opts.retries&&(i._queue.shift(),e&&e(t));else if(i._queue.shift(),e){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];e.apply(void 0,[null].concat(o))}return n.pending=!1,i._drainQueue()}})),this._queue.push(n),this._drainQueue()}},{key:"_drainQueue",value:function(){if(0!==this._queue.length){var t=this._queue[0];if(!t.pending){t.pending=!0,t.tryCount++;var e=this.ids;this.ids=t.id,this.flags=t.flags,this.emit.apply(this,t.args),this.ids=e}}}},{key:"packet",value:function(t){t.nsp=this.nsp,this.io._packet(t)}},{key:"onopen",value:function(){var t=this;"function"==typeof this.auth?this.auth((function(e){t._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(t){this.packet({type:ct.CONNECT,data:this._pid?s({pid:this._pid,offset:this._lastOffset},t):t})}},{key:"onerror",value:function(t){this.connected||this.emitReserved("connect_error",t)}},{key:"onclose",value:function(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}},{key:"onpacket",value:function(t){if(t.nsp===this.nsp)switch(t.type){case ct.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ct.EVENT:case ct.BINARY_EVENT:this.onevent(t);break;case ct.ACK:case ct.BINARY_ACK:this.onack(t);break;case ct.DISCONNECT:this.ondisconnect();break;case ct.CONNECT_ERROR:this.destroy();var e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}},{key:"onevent",value:function(t){var e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}},{key:"emitEvent",value:function(t){if(this._anyListeners&&this._anyListeners.length){var e,i=v(this._anyListeners.slice());try{for(i.s();!(e=i.n()).done;)e.value.apply(this,t)}catch(t){i.e(t)}finally{i.f()}}m(o(a.prototype),"emit",this).apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}},{key:"ack",value:function(t){var e=this,i=!1;return function(){if(!i){i=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.packet({type:ct.ACK,id:t,data:s})}}}},{key:"onack",value:function(t){var e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}},{key:"onconnect",value:function(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var t=this;this.receiveBuffer.forEach((function(e){return t.emitEvent(e)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(e){t.notifyOutgoingListeners(e),t.packet(e)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(t){return t()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:ct.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(t){return this.flags.compress=t,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(t){return this.flags.timeout=t,this}},{key:"onAny",value:function(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}},{key:"prependAny",value:function(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}},{key:"offAny",value:function(t){if(!this._anyListeners)return this;if(t){for(var e=this._anyListeners,i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}},{key:"prependAnyOutgoing",value:function(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}},{key:"offAnyOutgoing",value:function(t){if(!this._anyOutgoingListeners)return this;if(t){for(var e=this._anyOutgoingListeners,i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var e,i=v(this._anyOutgoingListeners.slice());try{for(i.s();!(e=i.n()).done;)e.value.apply(this,t.data)}catch(t){i.e(t)}finally{i.f()}}}}]),a}(L);function Ut(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ut.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,this.max)},Ut.prototype.reset=function(){this.attempts=0},Ut.prototype.setMin=function(t){this.ms=t},Ut.prototype.setMax=function(t){this.max=t},Ut.prototype.setJitter=function(t){this.jitter=t};var Bt=function(i){r(o,i);var s=u(o);function o(i,n){var r,a;e(this,o),(r=s.call(this)).nsps={},r.subs=[],i&&"object"===t(i)&&(n=i,i=void 0),(n=n||{}).path=n.path||"/socket.io",r.opts=n,R(p(r),n),r.reconnection(!1!==n.reconnection),r.reconnectionAttempts(n.reconnectionAttempts||1/0),r.reconnectionDelay(n.reconnectionDelay||1e3),r.reconnectionDelayMax(n.reconnectionDelayMax||5e3),r.randomizationFactor(null!==(a=n.randomizationFactor)&&void 0!==a?a:.5),r.backoff=new Ut({min:r.reconnectionDelay(),max:r.reconnectionDelayMax(),jitter:r.randomizationFactor()}),r.timeout(null==n.timeout?2e4:n.timeout),r._readyState="closed",r.uri=i;var h=n.parser||kt;return r.encoder=new h.Encoder,r.decoder=new h.Decoder,r._autoConnect=!1!==n.autoConnect,r._autoConnect&&r.open(),r}return n(o,[{key:"reconnection",value:function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}},{key:"reconnectionAttempts",value:function(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}},{key:"reconnectionDelay",value:function(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}},{key:"randomizationFactor",value:function(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}},{key:"reconnectionDelayMax",value:function(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}},{key:"timeout",value:function(t){return arguments.length?(this._timeout=t,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(t){var e=this;if(~this._readyState.indexOf("open"))return this;this.engine=new pt(this.uri,this.opts);var i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;var s=St(i,"open",(function(){n.onopen(),t&&t()})),r=St(i,"error",(function(i){n.cleanup(),n._readyState="closed",e.emitReserved("error",i),t?t(i):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){var o=this._timeout;0===o&&s();var a=this.setTimeoutFn((function(){s(),i.close(),i.emit("error",new Error("timeout"))}),o);this.opts.autoUnref&&a.unref(),this.subs.push((function(){clearTimeout(a)}))}return this.subs.push(s),this.subs.push(r),this}},{key:"connect",value:function(t){return this.open(t)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var t=this.engine;this.subs.push(St(t,"ping",this.onping.bind(this)),St(t,"data",this.ondata.bind(this)),St(t,"error",this.onerror.bind(this)),St(t,"close",this.onclose.bind(this)),St(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}},{key:"ondecoded",value:function(t){var e=this;st((function(){e.emitReserved("packet",t)}),this.setTimeoutFn)}},{key:"onerror",value:function(t){this.emitReserved("error",t)}},{key:"socket",value:function(t,e){var i=this.nsps[t];return i||(i=new Tt(this,t,e),this.nsps[t]=i),this._autoConnect&&i.connect(),i}},{key:"_destroy",value:function(t){for(var e=0,i=Object.keys(this.nsps);e<i.length;e++){var n=i[e];if(this.nsps[n].active)return}this._close()}},{key:"_packet",value:function(t){for(var e=this.encoder.encode(t),i=0;i<e.length;i++)this.engine.write(e[i],t.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(t){return t()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var t=this;if(this._reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var i=this.backoff.duration();this._reconnecting=!0;var n=this.setTimeoutFn((function(){e.skipReconnect||(t.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((function(i){i?(e._reconnecting=!1,e.reconnect(),t.emitReserved("reconnect_error",i)):e.onreconnect()})))}),i);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}},{key:"onreconnect",value:function(){var t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}]),o}(L),Ct={};function At(e,i){"object"===t(e)&&(i=e,e=void 0);var n,s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,n=t;i=i||"undefined"!=typeof location&&location,null==t&&(t=i.protocol+"//"+i.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?i.protocol+t:i.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==i?i.protocol+"//"+t:"https://"+t),n=dt(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var s=-1!==n.host.indexOf(":"),r=s?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port+e,n.href=n.protocol+"://"+r+(i&&i.port===n.port?"":":"+n.port),n}(e,(i=i||{}).path||"/socket.io"),r=s.source,o=s.id,a=s.path,h=Ct[o]&&a in Ct[o].nsps;return i.forceNew||i["force new connection"]||!1===i.multiplex||h?n=new Bt(r,i):(Ct[o]||(Ct[o]=new Bt(r,i)),n=Ct[o]),s.query&&!i.query&&(i.query=s.queryKey),n.socket(s.path,i)}return s(At,{Manager:Bt,Socket:Tt,io:At,connect:At}),At}()},279:function(t,e,i){"use strict";i.r(e),i.d(e,"$",(function(){return l})),i.d(e,"BuiltInControllerComponent",(function(){return q})),i.d(e,"COMPONENT_STORE",(function(){return j})),i.d(e,"Controller",(function(){return Tt})),i.d(e,"Danmaku",(function(){return Lt})),i.d(e,"DanmakuController",(function(){return jt})),i.d(e,"DanmakuInput",(function(){return Ot})),i.d(e,"DanmakuOpenClose",(function(){return Dt})),i.d(e,"DanmakuSettings",(function(){return Ht})),i.d(e,"DutaionShow",(function(){return pt})),i.d(e,"Env",(function(){return wt})),i.d(e,"ErrorLoading",(function(){return B})),i.d(e,"FullPage",(function(){return ct})),i.d(e,"FullScreen",(function(){return rt})),i.d(e,"HIDEEN_COMPONENT_STORE",(function(){return Y})),i.d(e,"Loading",(function(){return U})),i.d(e,"MediumBar",(function(){return Ct})),i.d(e,"ONCE_COMPONENT_STORE",(function(){return V})),i.d(e,"Options",(function(){return nt})),i.d(e,"PicInPic",(function(){return ut})),i.d(e,"PlayButton",(function(){return ot})),i.d(e,"ScreenShot",(function(){return ft})),i.d(e,"SubSetting",(function(){return _t})),i.d(e,"SubsettingItem",(function(){return gt})),i.d(e,"SubsettingsMain",(function(){return yt})),i.d(e,"SubsettingsPlayrate",(function(){return bt})),i.d(e,"SubsettingsSubtitle",(function(){return Et})),i.d(e,"TimeLoading",(function(){return C})),i.d(e,"Toast",(function(){return A})),i.d(e,"ToolBar",(function(){return At})),i.d(e,"TopBar",(function(){return It})),i.d(e,"VideoProgress",(function(){return Bt})),i.d(e,"VideoShot",(function(){return mt})),i.d(e,"Volume",(function(){return at})),i.d(e,"addClass",(function(){return p})),i.d(e,"addZero",(function(){return ht})),i.d(e,"changeClass",(function(){return u})),i.d(e,"checkIsMouseInRange",(function(){return a})),i.d(e,"computeAngle",(function(){return dt})),i.d(e,"containsDOM",(function(){return m})),i.d(e,"createSvg",(function(){return b})),i.d(e,"createSvgs",(function(){return _})),i.d(e,"default",(function(){return Zt})),i.d(e,"formatTime",(function(){return lt})),i.d(e,"getDOMPoint",(function(){return o})),i.d(e,"getEl",(function(){return d})),i.d(e,"getElementSize",(function(){return g})),i.d(e,"includeClass",(function(){return f})),i.d(e,"nextTick",(function(){return St})),i.d(e,"patchComponent",(function(){return x})),i.d(e,"patchDOMProps",(function(){return w})),i.d(e,"patchFn",(function(){return S})),i.d(e,"patchStyle",(function(){return k})),i.d(e,"removeClass",(function(){return c})),i.d(e,"setSvgPath",(function(){return y})),i.d(e,"storeControlComponent",(function(){return W}));var n,s=i(278),r=i.n(s);function o(t){let e=t.getBoundingClientRect();return{x:e.left,y:e.top}}function a(t,e,i,n,s){let{x:r,y:a}=o(t),h=a-i-e.clientHeight,l=a+t.clientHeight,d=r+Math.round(t.clientWidth/2)-Math.round(e.clientWidth/2),p=r+Math.round(t.clientWidth/2)+Math.round(e.clientWidth/2),c=r,u=r+t.clientWidth;return n>=d&&n<=p&&s<=a&&s>=h||n>=c-5&&n<=u+5&&s>=a-5&&s<=l+5}!function(t){t.LOADED_META_DATA="loadedmetadata",t.TIME_UPDATE="timeupdate",t.PLAY="play",t.PAUSE="pause",t.SEEKING="seeking",t.WAITING="waiting",t.CAN_PLAY="canplay",t.ERROR="videoError",t.RATE_CHANGE="ratechange",t.VIDEO_CLICK="videoClick",t.PROGRESS_CLICK="progress-click",t.PROGRESS_MOUSE_ENTER="progress-mouseenter",t.PROGRESS_MOUSE_LEAVE="progress-mouseleave",t.VIDEO_PROGRESS_CLICK="video-progress-click",t.DANMAKU_INPUT_FOCUS="inputFocus",t.DANMAKU_INPUT_BLUR="inputBlur",t.DOT_DOWN="dotdown",t.DOT_UP="dotup",t.DOT_DRAG="dotdrag",t.VIDEO_DOT_DOWN="videoDotDown",t.VIDEO_DOT_UP="videoDotUp",t.VIDEO_DOT_DRAG="videoDotDrag",t.ENTER_FULLSCREEN="enterFullscreen",t.LEAVE_FULLSCREEN="leaveFullscreen",t.RESIZE="resize",t.SHOW_TOOLBAR="showtoolbar",t.HIDE_TOOLBAR="hidetoolbar",t.MOVE_VERTICAL="moveVertical",t.MOVE_HORIZONTAL="moveHorizontal",t.SLIDE_VERTICAL="slideVertical",t.SLIDE_HORIZONTAL="slideHorizontal",t.VOLUME_PROGRESS_CLICK="volume-progress-click",t.REQUEST_DANMAKU_DATA="RequestDanmakuData",t.SEND_DANMAKU_DATA="SendDanmakuData"}(n||(n={}));const h=/([\w-]+)?(?:#([\w-]+))?(?:\.([\w-]+))?/;function l(t,e,i){let n=[],s=h.exec(t);n[0]=s[1]||void 0,n[1]=s[2]||void 0,n[2]=s[3]||void 0;let r=n[0]?document.createElement(n[0]):document.createElement("div");n[1]&&(r.id=n[1]),n[2]&&p(r,[n[2]]);for(let t in e)if("object"==typeof e[t]){if("style"===t){let i="",n=e[t];for(let t in n)i+=`${t}: ${n[t]};`;r.setAttribute("style",i)}}else r.setAttribute(t,String(e[t]));if("string"==typeof i)r.innerHTML+=i;else if(i)for(let t of i)r.appendChild(t.el);return r}function d(t){return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):void 0}function p(t,e){let i=t.classList;for(let n of e)f(t,n)||i.add(n)}function c(t,e){t.classList.remove(...e)}function u(t,e){t.className=e}function f(t,e){let i=t.classList;for(let t in i)if(i[t]===e)return!0;return!1}function m(t,e){return t.childNodes.length>0&&t.childNodes.forEach(t=>{if(t===e)return!0;m(t,e)}),!1}function g(t){const e=t.cloneNode(!0);e.style.position="absolute",e.style.opacity="0",e.removeAttribute("hidden");const i=t.parentNode||document.body;i.appendChild(e);const n=e.getBoundingClientRect();return i.removeChild(e),n}const v="http://www.w3.org/2000/svg";function b(t,e="0 0 24 24"){const i=document.createElementNS(v,"svg");if(i.setAttribute("viewBox",e),t){const e=document.createElementNS(v,"path");e.setAttributeNS(null,"d",t),i.appendChild(e)}return i}function y(t,e){t.getElementsByTagNameNS(v,"path")[0].setAttributeNS(null,"d",e)}function _(t,e="0 0 24 24"){const i=document.createElementNS(v,"svg");i.setAttribute("viewBox",e);for(let e of t){const t=document.createElementNS(v,"path");t.setAttributeNS(null,"d",e),i.appendChild(t)}return i}function x(t,e,i){var n,s;if(t.id!==e.id)throw new Error("需要合并的两个组件的id不相同");let r=(null==i?void 0:i.replaceElType)||"replaceOuterHTMLOfComponent";for(let i in e)if(i in t)if("props"===i)w(t[i],e[i],t.el);else if("el"===i)if("replaceOuterHTMLOfComponent"===r)t.el=e.el;else{for(let e of t.el.childNodes)t.el.removeChild(e);t.el.appendChild(e.el)}else if(t[i]instanceof Function){if(!(e[i]instanceof Function))throw new Error(`属性${i}对应的值应该为函数类型`);console.log("合并函数",e[i]),t[i]=S(t[i],e[i],t),t.resetEvent()}else if(t[i]instanceof HTMLElement){if(!(e[i]instanceof HTMLElement)&&"string"!=typeof e[i])throw new Error(`属性${i}对应的值应该为DOM元素或者字符串类型`);"string"==typeof e[i]||(null===(n=t[i].parentNode)||void 0===n||n.insertBefore(e[i],t[i]),null===(s=t[i].parentNode)||void 0===s||s.removeChild(t[i]),t[i]=e[i])}}function w(t,e,i){for(let n in e)if(t.hasOwnProperty(n))"id"===n?(t.id=e.id,i.id=t.id):"className"===n?(t.className.concat(e.className),p(i,e.className)):"style"===n&&k(t.style,e.style,i);else if(t[n]=e[n],"style"!==n)i[n]=e[n];else if("style"===n)for(let t in e.style)i.style[t]=e.style[t]}function k(t,e,i){for(let i in e)t[i]=e[i];for(let e in t)i.style[e]=t[e]}function S(t,e,i){return console.log(t,e,i),function(...n){t.call(i,...n),e.call(i,...n)}.bind(i)}class E{constructor(){this.$events={}}emit(t,...e){this.$events[t]&&this.$events[t].forEach(t=>{t.call(this,...e)})}on(t,e){this.$events[t]=this.$events[t]||[],this.$events[t].push(e)}off(t,e){this.$events[t]&&(this.$events[t]=this.$events[t].filter(t=>e!==t))}}class T extends E{constructor(t,e,i,n){super();let s=l(e,i,n);if(this.el=s,this.container=t,i&&(i.id&&(this.el.id=i.id),i.className&&p(this.el,i.className),i.style))for(let t in i.style)this.el.style[t]=i.style[t];t&&t.appendChild(s)}init(){}initEvent(){}initPCEvent(){}initMobileEvent(){}initTemplate(){}initPCTemplate(){}initMobileTemplate(){}initComponent(){}resetEvent(){}dispose(){}}class U extends T{constructor(t,e,i,n,s,r){super(null,n,s,r),this.id="Loading",this.props=s||{},this.player=t,this.container=i,this.message=e,this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){p(this.el,["video-loading"]),this.loadingBox=l("div"),this.messageBox=l("div"),this.messageBox.innerText=this.message,p(this.messageBox,["video-loading-msgbox"]),this.el.appendChild(this.loadingBox),this.el.appendChild(this.messageBox)}initEvent(){}addLoading(){[...this.container.childNodes].includes(this.el)||this.container.appendChild(this.el)}removeLoading(){[...this.container.childNodes].includes(this.el)&&this.container.removeChild(this.el)}}class B extends U{constructor(t,e,i){super(t,e,i),this.id="errorloading",p(this.loadingBox,["video-loading-errorloading"]),this.initEvent()}initEvent(){this.player.on(n.ERROR,()=>{this.addLoading()}),this.player.on(n.CAN_PLAY,()=>{this.removeLoading()})}}class C extends U{constructor(t,e,i){super(t,e,i),this.id="timeloading",p(this.loadingBox,["video-loading-loadingbox"]),this.initEvent()}initEvent(){this.player.on(n.WAITING,()=>{this.addLoading()}),this.player.on(n.CAN_PLAY,()=>{this.removeLoading()})}}class A extends T{constructor(t,e,i){super(null,"div",i,null),this.id="Toast",this.player=t,this.props=i,this.dom=e||null,this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){this.dom&&this.el.appendChild(this.dom),p(this.el,["video-toast-wrapper"]),this.player.el.appendChild(this.el),window.setTimeout(()=>{p(this.el,["video-toast-animate"]);let t=30;for(let e in A.ToastQueue)t+=A.ToastQueue[e].el.clientHeight+10;this.el.style.transform=`translateY(${t}px)`,A.ToastQueue.push(this)})}initEvent(){}dispose(){let t=A.ToastQueue.indexOf(this);A.ToastQueue.splice(t,1),this.el.parentElement.removeChild(this.el);for(let e=t;e<A.ToastQueue.length;e++){let i=A.ToastQueue[e];i.el.style.transform=e===t?`translateY(${10+this.el.clientHeight}px)`:`translateY(${10+A.ToastQueue[e-1].el.clientHeight}px)`}}}A.ToastQueue=[];let I=Document.prototype.createElement;let z=Document.prototype.getElementsByClassName;let L=Document.prototype.getElementById;let P=Document.prototype.getElementsByTagName;function O(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function D(t,e,i,n){let s=0,r=0,o=0,a=0,h={x:0,y:0},l={x:0,y:0},d=[];t.addEventListener("touchstart",t=>{t.touches.length>1||(s=Date.now(),r=Date.now(),l={x:t.touches[0].clientX,y:t.touches[0].clientY},h={x:t.touches[0].clientX,y:t.touches[0].clientY},o=h.x,a=h.y)}),t.addEventListener("touchmove",t=>{if(t.touches.length>1)return;t.preventDefault();let e=Date.now();if(e-s>=10){let a=(i=t.touches[0].clientX,n=h.x,r=t.touches[0].clientY,o=h.y,Math.sqrt((i-r)*(i-r)+(n-o)*(n-o)));d.push(a/(e-s)),h={x:t.touches[0].clientX,y:t.touches[0].clientY},s=e}var i,n,r,o}),t.addEventListener("touchend",t=>{if(t.touches.length>1)return;let n=0,p=1;s=Date.now(),console.log(d);for(let t=d.length-1;t>=0&&d[t]>d[t-1];t--)n+=d[t]-d[t-1],p++;let c=h.x-o,u=h.y-a;if(n/p*100>=10&&d[d.length-1]>=20&&(c<=0&&"fastSlideLeft"===e||c>=0&&"fastSlideRight"===e||u>=0&&"fastSlideDown"===e||u<=0&&"fastSlideTop"===e||"fastSlide"===e)){let e=Object.assign(Object.assign({},t),{startPos:l,endPos:h,interval:s-r,lastSpeed:d[d.length-1],e:t});i instanceof Function?i(e):i.handleEvent(e)}d=[],h={x:0,y:0},l={x:0,y:0},s=0,r=0})}function N(t,e,i,n){let s,r,o={x:0,y:0},a=1;t.addEventListener("touchstart",t=>{t.touches.length>1&&(s=t.touches[0],r=t.touches[1],o={x:r.clientX-s.clientX,y:r.clientY-s.clientY})}),t.addEventListener("touchmove",t=>{if(t.preventDefault(),t.touches.length>1){let n=t.touches[0],s=t.touches[1],r={x:s.clientX-n.clientX,y:s.clientY-n.clientY};if(a=O(r)/O(o),"pintch"===e){let e=Object.assign(Object.assign({},t),{scale:a,e:t});i instanceof Function?i(e):i.handleEvent(e)}let h=function(t,e){let i=0,n=O(t)*O(e);if(n){let s=(t.x*e.x+t.y*e.y)/n;return i=Math.acos(Math.min(s,1)),i=t.x*e.y-e.x*t.y>0?-i:i,180*i/Math.PI}return 0}(o,r);if("rotate"===e){let e=Object.assign(Object.assign({},t),{angle:h,e:t});i instanceof Function?i(e):i.handleEvent(e)}}}),t.addEventListener("touchend",t=>{if((-1===[...t.touches].indexOf(s)||-1===[...t.touches].indexOf(r))&&"pintchOver"===e){let e=Object.assign(Object.assign({},t),{scale:a,e:t});i instanceof Function?i(e):i.handleEvent(e)}o={x:0,y:0}})}function R(t){if(t.__proto__.addEventListener===M)return t;let e=t.__proto__,i=Object.create(e);return i.addEventListener=M,Object.setPrototypeOf(t,i),Object.setPrototypeOf(i,e),t}const F=HTMLElement.prototype.addEventListener;function M(t,e,i){let n=this;switch(t){case"singleTap":case"doubleTap":case"longTap":!function(t,e,i,n){let s=null,r=null,o=-1,a=!1,h=0,l=!1,d=0;t.addEventListener("touchstart",t=>{t.touches.length>1||(h=Date.now(),"longTap"===e&&(r=window.setTimeout(()=>{},800)),o>0&&h-o<150&&(window.clearTimeout(s),d=h-o,s=null,o=-1,l=!0))}),t.addEventListener("touchmove",t=>{t.touches.length>1||(a=!0,t.preventDefault(),r&&(window.clearTimeout(r),r=null))}),t.addEventListener("touchend",t=>{if(t.touches.length>1)return;let n=Date.now()-h;r&&(window.clearTimeout(r),r=null),n<150&&!a&&("singleTap"===e&&!1===l?s=window.setTimeout(()=>{let e=Object.assign(Object.assign({},t),{interval:n,e:t});i instanceof Function?i(e):i.handleEvent(e)},150):"doubleTap"===e&&!0===l&&(s=window.setTimeout(()=>{let e=Object.assign(Object.assign({},t),{interval:d,e:t});i instanceof Function?i(e):i.handleEvent(e)})),o=Date.now()),a=!1,l=!1})}(n,t,e);break;case"swipe":case"swipeLeft":case"swipeRight":case"swipeTop":case"swipeDown":case"move":case"moveLeft":case"moveRight":case"moveTop":case"moveDown":!function(t,e,i,n){let s=!1,r={x:0,y:0},o=0,a=0;t.addEventListener("touchstart",t=>{t.touches.length>1||(r.x=t.touches[0].clientX,r.y=t.touches[0].clientY)}),t.addEventListener("touchmove",t=>{if(t.touches.length>1)return;s=!0,t.preventDefault();let n=t.touches[0].clientX,h=t.touches[0].clientY;if(o=n-r.x,a=h-r.y,"moveLeft"===e&&o<0||"moveRight"===e&&o>0||"moveTop"===e&&a<0||"moveDown"===e&&a>0||"move"===e){let e=Object.assign(Object.assign({},t),{startPos:r,deltaX:o,deltaY:a,e:t});i instanceof Function?i(e):i.handleEvent(e)}}),t.addEventListener("touchend",t=>{if(t.touches.length>1)return;let n={x:r.x+o,y:r.y+a};if(s&&("swipeLeft"===e&&o<0||"swipeRight"===e&&o>0||"swipeTop"===e&&a<0||"swipeDown"===e&&a>0||"swipe"===e)){let e=Object.assign(Object.assign({},t),{startPos:r,endPos:n,e:t});i instanceof Function?i(e):i.handleEvent(e)}s=!1})}(n,t,e);break;case"fastSlide":case"fastSlideLeft":case"fastSlideRight":case"fastSlideTop":case"fastSlideDown":D(n,t,e);break;case"pintch":case"pintchOver":case"rotate":N(n,t,e);break;default:n===G.body?F.call(window.document.body,t,e,i):F.call(n,t,e,i)}}let H=Object.create(window.document.body);H.addEventListener=M;let G={body:H,createElement:function(t,e){let i=I.call(window.document,t,e),n=i.__proto__,s=Object.create(n);return s.addEventListener=M,Object.setPrototypeOf(i,s),Object.setPrototypeOf(s,n),i},getElementById:function(t){let e=L.call(window.document,t)||null;if(null===e)return null;if(e.__proto__ instanceof HTMLElement){let t=Object.create(e.__proto__);t.addEventListener=M,Object.setPrototypeOf(e,t)}return e},getElementsByClassName:function(t){let e=z.call(window.document,t);return e.forEach(t=>{if(t.__proto__ instanceof HTMLElement){let e=Object.create(t.__proto__);e.addEventListener=M,Object.setPrototypeOf(t,e)}}),e},getElementsByTagName:function(t){let e=P.call(window.document,t);return e.forEach(t=>{if(t.__proto__ instanceof HTMLElement){let e=Object.create(t.__proto__);e.addEventListener=M,Object.setPrototypeOf(t,e)}}),e}};Object.setPrototypeOf(G,Document.prototype),console.log(G);const j=new Map,V=new Map,Y=new Map,q=["DurationShow","FullPage","FullScreen","PicInPic","PlayButton","Playrate","ScreenShot","SubSetting","VideoShot","Toast"];function W(t){j.set(t.id,t),V.set(t.id,t)}const K="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z",X="M181.333333 213.333333h661.333334a53.393333 53.393333 0 0 1 53.333333 53.333334v490.666666a53.393333 53.393333 0 0 1-53.333333 53.333334H181.333333a53.393333 53.393333 0 0 1-53.333333-53.333334V266.666667a53.393333 53.393333 0 0 1 53.333333-53.333334z m53.333334 640H96a10.666667 10.666667 0 0 1-10.666667-10.666666v-138.666667a21.333333 21.333333 0 0 0-42.666666 0v138.666667a53.393333 53.393333 0 0 0 53.333333 53.333333h138.666667a21.333333 21.333333 0 0 0 0-42.666667zM64 341.333333a21.333333 21.333333 0 0 0 21.333333-21.333333V181.333333a10.666667 10.666667 0 0 1 10.666667-10.666666h138.666667a21.333333 21.333333 0 0 0 0-42.666667H96a53.393333 53.393333 0 0 0-53.333333 53.333333v138.666667a21.333333 21.333333 0 0 0 21.333333 21.333333z m896 341.333334a21.333333 21.333333 0 0 0-21.333333 21.333333v138.666667a10.666667 10.666667 0 0 1-10.666667 10.666666h-138.666667a21.333333 21.333333 0 0 0 0 42.666667h138.666667a53.393333 53.393333 0 0 0 53.333333-53.333333v-138.666667a21.333333 21.333333 0 0 0-21.333333-21.333333z m-32-554.666667h-138.666667a21.333333 21.333333 0 0 0 0 42.666667h138.666667a10.666667 10.666667 0 0 1 10.666667 10.666666v138.666667a21.333333 21.333333 0 0 0 42.666666 0V181.333333a53.393333 53.393333 0 0 0-53.333333-53.333333z",$="M928 128H96a53.393333 53.393333 0 0 0-53.333333 53.333333v661.333334a53.393333 53.393333 0 0 0 53.333333 53.333333h832a53.393333 53.393333 0 0 0 53.333333-53.333333V181.333333a53.393333 53.393333 0 0 0-53.333333-53.333333zM377.753333 591.086667L200.833333 768H320a21.333333 21.333333 0 0 1 0 42.666667H149.206667a21.333333 21.333333 0 0 1-21.206667-21.206667V618.666667a21.333333 21.333333 0 0 1 42.666667 0v119.166666l176.913333-176.92a21.333333 21.333333 0 0 1 30.173333 30.173334zM896 405.333333a21.333333 21.333333 0 0 1-42.666667 0V286.166667l-176.913333 176.92a21.333333 21.333333 0 0 1-30.173333-30.173334L823.166667 256H704a21.333333 21.333333 0 0 1 0-42.666667h170.793333a21.333333 21.333333 0 0 1 21.206667 21.206667V405.333333z",Q="M217.8 319.89h-48c-35.9 0-65-29.1-65-65s29.1-65 65-65h48c35.9 0 65 29.1 65 65s-29.1 65-65 65zM714.8 319.89h-322c-35.9 0-65-29.1-65-65s29.1-65 65-65h322c35.9 0 65 29.1 65 65s-29.1 65-65 65zM403.8 579.89h-234c-35.9 0-65-29.1-65-65s29.1-65 65-65h234c35.9 0 65 29.1 65 65s-29.1 65-65 65zM252.8 838.89h-83c-35.9 0-65-29.1-65-65s29.1-65 65-65h83c35.9 0 65 29.1 65 65s-29.1 65-65 65zM425.8 838.89h-1c-35.9 0-65-29.1-65-65s29.1-65 65-65h1c35.9 0 65 29.1 65 65s-29.1 65-65 65zM717.73 398.22c-122.04 0-220.97 98.93-220.97 220.97 0 122.04 98.93 220.97 220.97 220.97 122.04 0 220.97-98.93 220.97-220.97 0.01-122.04-98.93-220.97-220.97-220.97zM822 554.48l-165.25 171.2c-5.9 6.12-13.77 9.19-21.65 9.19-7.52 0-15.05-2.8-20.89-8.44-11.95-11.54-12.29-30.58-0.75-42.54l165.25-171.2c11.54-11.96 30.58-12.29 42.54-0.75 11.95 11.55 12.29 30.59 0.75 42.54z",Z="M221.58 319.89h-48c-35.9 0-65-29.1-65-65s29.1-65 65-65h48c35.9 0 65 29.1 65 65s-29.1 65-65 65zM718.58 319.89h-322c-35.9 0-65-29.1-65-65s29.1-65 65-65h322c35.9 0 65 29.1 65 65s-29.1 65-65 65zM407.58 579.89h-234c-35.9 0-65-29.1-65-65s29.1-65 65-65h234c35.9 0 65 29.1 65 65s-29.1 65-65 65zM256.58 838.89h-83c-35.9 0-65-29.1-65-65s29.1-65 65-65h83c35.9 0 65 29.1 65 65s-29.1 65-65 65zM429.58 838.89h-1c-35.9 0-65-29.1-65-65s29.1-65 65-65h1c35.9 0 65 29.1 65 65s-29.1 65-65 65zM713.96 396.72c-122.04 0-220.97 98.93-220.97 220.97s98.93 220.97 220.97 220.97 220.97-98.93 220.97-220.97S836 396.72 713.96 396.72zM837.9 561.91L689.88 715.26a30.078 30.078 0 0 1-21.38 9.19h-0.27c-7.97 0-15.63-3.17-21.27-8.81l-56.57-56.57c-11.75-11.75-11.75-30.79 0-42.54s30.79-11.75 42.54 0l34.92 34.91 126.76-131.32c11.54-11.96 30.58-12.29 42.54-0.75 11.95 11.54 12.29 30.58 0.75 42.54z",J="M558.933333 490.666667L384 665.6l59.733333 59.733333 234.666667-234.666666L443.733333 256 384 315.733333l174.933333 174.933334z",tt="M503.466667 490.666667l174.933333 174.933333-59.733333 59.733333L384 490.666667 618.666667 256l59.733333 59.733333-174.933333 174.933334z",et="M456.899566 728.522382c-15.978926 15.977903-40.33873 18.47477-58.932204 7.492648-3.446495-2.039449-9.653871-9.990538-9.653871-9.990538L188.797435 526.509459c-18.938328-18.938328-18.938328-47.148833 0-66.084091 18.934235-18.938328 49.64263-16.442484 68.579935 2.495844l165.227112 165.225065 312.24449-312.24142c18.938328-18.938328 49.6457-21.435195 68.583005-2.495844 18.938328 18.940374 18.939351 47.149856 0 66.085114L456.909799 728.507032c0 0-0.005117 0.00921-0.010233 0.013303l0 0L456.899566 728.522382zM510.742868 64.090691c-246.752894 0-446.786743 200.032826-446.786743 446.786743 0 246.75187 200.033849 446.785719 446.786743 446.785719 246.752894 0 446.787766-200.034872 446.787766-446.785719C957.531658 264.125563 757.495762 64.090691 510.742868 64.090691L510.742868 64.090691 510.742868 64.090691 510.742868 64.090691z",it="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z";class nt extends T{constructor(t,e,i,n,s,r,o){super(e,s,r,o),this.id="Options",this.bottom=48,this.player=t,this.props=r||{},this.hideHeight=n,this.hideWidth=i,this.initBase()}initBase(){this.initBaseTemplate(),this.initBaseEvent()}initBaseTemplate(){this.hideBox=l("div"),p(this.hideBox,["video-set","video-set-hidden"]),this.hideHeight&&this.hideHeight>0&&(this.hideBox.style.height=this.hideHeight+"px"),this.hideWidth&&this.hideWidth>0&&(this.hideBox.style.width=this.hideWidth+"px"),this.el.appendChild(this.hideBox),this.iconBox=l("div"),p(this.iconBox,["video-icon"]),this.el.appendChild(this.iconBox)}initBaseEvent(){this.el.onmouseenter=t=>{c(this.hideBox,["video-set-hidden"]),document.body.onmousemove=this.handleMouseMove.bind(this),this.player.emit("oneControllerHover",this)},this.player.on("oneControllerHover",t=>{this!==t&&(f(this.hideBox,"video-set-hidden")||p(this.hideBox,["video-set-hidden"]))}),this.player.on(n.VIDEO_CLICK,()=>{p(this.hideBox,["video-set-hidden"])})}handleMouseMove(t){let e=t.clientX,i=t.clientY;a(this.el,this.hideBox,this.bottom,e,i)||(p(this.hideBox,["video-set-hidden"]),document.body.onmousemove=null)}replaceIcon(t){this.iconBox.removeChild(this.icon),this.iconBox.appendChild(t),this.icon=t}}var st={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.toggleFull=t.isFull=t.exitFull=t.beFull=void 0;var e=document.documentElement,i=e.querySelector("head"),n=document.createElement("style"),s="requestFullscreen",r="exitFullscreen",o="fullscreenElement";if("webkitRequestFullScreen"in e)s="webkitRequestFullScreen",r="webkitExitFullscreen",o="webkitFullscreenElement";else if("msRequestFullscreen"in e)s="msRequestFullscreen",r="msExitFullscreen",o="msFullscreenElement";else if("mozRequestFullScreen"in e)s="mozRequestFullScreen",r="mozCancelFullScreen",o="mozFullScreenElement";else if(!("requestFullscreen"in e))throw"当前浏览器不支持Fullscreen API !";function a(t){return t instanceof HTMLElement?t:e}function h(t,e){return e&&(null===i&&(i=document.createElement("head")),n.innerHTML=":fullscreen{background-color:"+e+";}",i.appendChild(n)),a(t)[s]()}function l(){return e.contains(n)&&(null==i||i.removeChild(n)),document[r]()}function d(t){return a(t)===document[o]}t.beFull=h,t.exitFull=l,t.isFull=d,t.toggleFull=function(t,e){return d(t)?(l(),!1):(h(t,e),!0)}}(st);class rt extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="FullScreen",this.enterFullScreen=!1,this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-fullscreen","video-controller"]),this.icon=b(X,"0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText="全屏",this.hideBox.style.fontSize="13px"}initEvent(){this.onClick=this.onClick.bind(this),"PC"===this.player.env?this.el.onclick=this.onClick:R(this.el).addEventListener("singleTap",this.onClick)}onClick(t){t.stopPropagation(),st.isFull(this.player.container)?st.isFull(this.player.container)&&(st.exitFull(),this.iconBox.removeChild(this.icon),this.icon=b(X,"0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.player.container.addEventListener("fullscreenchange",t=>{this.player.emit(n.LEAVE_FULLSCREEN)})):(st.beFull(this.player.container),this.iconBox.removeChild(this.icon),this.icon=b("M768 629.333333a53.393333 53.393333 0 0 1-53.333333 53.333334H309.333333a53.393333 53.393333 0 0 1-53.333333-53.333334V394.666667a53.393333 53.393333 0 0 1 53.333333-53.333334h405.333334a53.393333 53.393333 0 0 1 53.333333 53.333334z m53.333333-288h138.666667a21.333333 21.333333 0 0 0 0-42.666666h-138.666667a10.666667 10.666667 0 0 1-10.666666-10.666667V149.333333a21.333333 21.333333 0 0 0-42.666667 0v138.666667a53.393333 53.393333 0 0 0 53.333333 53.333333zM64 341.333333h138.666667a53.393333 53.393333 0 0 0 53.333333-53.333333V149.333333a21.333333 21.333333 0 0 0-42.666667 0v138.666667a10.666667 10.666667 0 0 1-10.666666 10.666667H64a21.333333 21.333333 0 0 0 0 42.666666z m138.666667 341.333334H64a21.333333 21.333333 0 0 0 0 42.666666h138.666667a10.666667 10.666667 0 0 1 10.666666 10.666667v138.666667a21.333333 21.333333 0 0 0 42.666667 0v-138.666667a53.393333 53.393333 0 0 0-53.333333-53.333333z m757.333333 0h-138.666667a53.393333 53.393333 0 0 0-53.333333 53.333333v138.666667a21.333333 21.333333 0 0 0 42.666667 0v-138.666667a10.666667 10.666667 0 0 1 10.666666-10.666667h138.666667a21.333333 21.333333 0 0 0 0-42.666666z","0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.player.container.addEventListener("fullscreenchange",t=>{this.player.emit(n.ENTER_FULLSCREEN)}))}}class ot extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="PlayButton",this.player=t,this.props=n||{},this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-start-pause","video-controller"]),this.iconBox=l("div.video-icon"),this.el.appendChild(this.iconBox),this.pauseIcon=b("M14.333 20.133H19V3.8h-4.667M5 20.133h4.667V3.8H5v16.333z"),this.playIcon=b("M6 2.914v18.172L20.279 12 6 2.914z"),this.button=this.playIcon,this.iconBox.appendChild(this.button)}initEvent(){this.player.on("play",t=>{this.iconBox.removeChild(this.button),this.button=this.pauseIcon,this.iconBox.appendChild(this.button)}),this.player.on("pause",t=>{this.iconBox.removeChild(this.button),this.button=this.playIcon,this.iconBox.appendChild(this.button)}),this.onClick=this.onClick.bind(this),"Mobile"===this.player.env?this.initMobileEvent():this.initPCEvent()}initPCEvent(){this.el.onclick=this.onClick}initMobileEvent(){R(this.el).addEventListener("singleTap",this.onClick)}onClick(t){t.stopPropagation(),this.player.video.paused?this.player.video.play():this.player.video.pause()}resetEvent(){this.onClick=this.onClick.bind(this),this.el.onclick=null,this.el.onclick=this.onClick}}class at extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i),this.id="Volume",this.volume=.5,this.mouseY=0,this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-volume","video-controller"]),this.el["aria-label"]="音量",p(this.hideBox,["video-volume-set"]),this.volumeProgress=l("div.video-volume-progress",{style:{height:"70px"}}),this.volumeShow=l("div.video-volume-show"),this.volumeShow.innerText=(100*this.volume).toFixed(0),this.volumeCompleted=l("div.video-volume-completed"),this.volumeProgress.appendChild(this.volumeCompleted),this.hideBox.appendChild(this.volumeShow),this.hideBox.appendChild(this.volumeProgress),this.volumeDot=l("div.video-volume-dot"),this.volumeProgress.appendChild(this.volumeDot),this.icon=b(K),this.iconBox.appendChild(this.icon),this.player.video.volume=this.volume}initEvent(){this.player.on(n.VOLUME_PROGRESS_CLICK,(t,e)=>{let i=t.clientY-o(this.volumeProgress).y,n=(this.volumeProgress.clientHeight-i)/this.volumeProgress.clientHeight;n<0?n=0:n>1&&(n=1),this.volumeCompleted.style.height=100*n+"%",this.volumeDot.style.top=(1-n)*this.volumeProgress.clientHeight+"px",this.volume=n,this.volumeShow.innerText=Math.round(100*this.volume)+"",this.player.video.volume=this.volume}),this.volumeProgress.onclick=t=>{t.stopPropagation(),this.player.emit(n.VOLUME_PROGRESS_CLICK,t,this)},this.volumeDot.onmousedown=t=>{t.stopPropagation(),this.mouseY=t.pageY;let e=parseInt(getComputedStyle(this.volumeDot).top);document.body.onmousemove=t=>{t.preventDefault();let i=e+t.pageY-this.mouseY;console.log(i);let n=(this.volumeProgress.clientHeight-i)/this.volumeProgress.clientHeight;n<0?n=0:n>1&&(n=1),this.volumeDot.style.top=(1-n)*this.volumeProgress.clientHeight+"px",this.volumeCompleted.style.height=100*n+"%",this.volumeShow.innerText=Math.round(100*n)+"",this.player.video.volume=n,this.volume=n},document.body.onmouseup=t=>{document.body.onmousemove=null,document.body.onmouseup=null}}}}function ht(t){return t>9?""+t:"0"+t}function lt(t){let e=(t=Math.floor(t))%60;return ht(Math.floor(t/60))+":"+ht(e)}function dt(t,e){return 0===t?90:0===e?0:Math.round(180*Math.atan(Math.abs(e)/Math.abs(t))/Math.PI)}class pt extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="DurationShow",this.currentTime="00:00",this.totalTime="00:00",this.player=t,this.props=n,this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-duration-time","video-controller"]),this.el.innerText=`${this.currentTime}/${this.totalTime}`}initEvent(){this.player.on(n.LOADED_META_DATA,t=>{let e=t.target;this.totalTime=lt(e.duration),this.el.innerText=`${this.currentTime}/${this.totalTime}`}),this.player.on(n.TIME_UPDATE,t=>{let e=t.target;this.currentTime=lt(e.currentTime),this.el.innerText=`${this.currentTime}/${this.totalTime}`}),this.player.on(n.VIDEO_DOT_DRAG,t=>{this.currentTime=lt(this.player.video.duration*t),this.el.innerText=`${this.currentTime}/${this.totalTime}`})}}class ct extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="FullPage",this.isFullPage=!1,this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-fullpage","video-controller"]),this.icon=b($,"0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText="网页全屏",this.hideBox.style.fontSize="13px"}initEvent(){this.onClick=this.onClick.bind(this),"Mobile"===this.player.env?R(this.el).addEventListener("singleTap",this.onClick):this.el.onclick=this.onClick}onClick(t){t.stopPropagation(),this.isFullPage?(c(this.player.el,["video-wrapper-fullpage"]),this.iconBox.removeChild(this.icon),this.icon=b($,"0 0 1024 1024"),this.iconBox.appendChild(this.icon)):(p(this.player.el,["video-wrapper-fullpage"]),this.iconBox.removeChild(this.icon),this.icon=b("M928 128H96a53.393333 53.393333 0 0 0-53.333333 53.333333v661.333334a53.393333 53.393333 0 0 0 53.333333 53.333333h832a53.393333 53.393333 0 0 0 53.333333-53.333333V181.333333a53.393333 53.393333 0 0 0-53.333333-53.333333z m-544 618.666667a21.333333 21.333333 0 0 1-42.666667 0V627.5l-176.913333 176.92a21.333333 21.333333 0 0 1-30.173333-30.173333L311.166667 597.333333H192a21.333333 21.333333 0 0 1 0-42.666666h170.766667A21.333333 21.333333 0 0 1 384 575.9z m505.753333-496.913334L712.833333 426.666667H832a21.333333 21.333333 0 0 1 0 42.666666H661.233333A21.333333 21.333333 0 0 1 640 448.1V277.333333a21.333333 21.333333 0 0 1 42.666667 0v119.166667l176.913333-176.92a21.333333 21.333333 0 1 1 30.173333 30.173333z","0 0 1024 1024"),this.iconBox.appendChild(this.icon)),this.isFullPage=!this.isFullPage}}class ut extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="PicInPic",this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-picInpic","video-controller"]),this.icon=b("M768 213.333333H256a85.333333 85.333333 0 0 0-85.333333 85.333334v426.666666a85.333333 85.333333 0 0 0 85.333333 85.333334h170.666667a42.666667 42.666667 0 1 1 0 85.333333H256a170.666667 170.666667 0 0 1-170.666667-170.666667V298.666667a170.666667 170.666667 0 0 1 170.666667-170.666667h512a170.666667 170.666667 0 0 1 170.666667 170.666667v128a42.666667 42.666667 0 1 1-85.333334 0V298.666667a85.333333 85.333333 0 0 0-85.333333-85.333334z m-128 341.333334a128 128 0 0 0-128 128v85.333333a128 128 0 0 0 128 128h170.666667a128 128 0 0 0 128-128v-85.333333a128 128 0 0 0-128-128h-170.666667z","0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText="画中画",this.hideBox.style.fontSize="13px"}initEvent(){this.onClick=this.onClick.bind(this),"Mobile"===this.player.env?R(this.el).addEventListener("singleTap",this.onClick):this.el.onclick=this.onClick}onClick(t){t.stopPropagation(),document.pictureInPictureElement?document.exitPictureInPicture():this.player.video.requestPictureInPicture()}}class ft extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="ScreenShot",this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){this.confirmIcon=b(et,"0 0 1024 1024"),p(this.el,["video-screenshot","video-controller"]),this.icon=b("M981.333333 224v661.333333a53.393333 53.393333 0 0 1-53.333333 53.333334H96a53.393333 53.393333 0 0 1-53.333333-53.333334V224a53.393333 53.393333 0 0 1 53.333333-53.333333h80a10.713333 10.713333 0 0 0 8.533333-4.266667L229.333333 106.666667a53.58 53.58 0 0 1 42.666667-21.333334h138.666667a53.58 53.58 0 0 1 42.666666 21.333334l44.8 59.733333A10.713333 10.713333 0 0 0 506.666667 170.666667h421.333333a53.393333 53.393333 0 0 1 53.333333 53.333333z m-348.666666 451.333333a170.666667 170.666667 0 1 0-120.666667 50 169.553333 169.553333 0 0 0 120.666667-50z m7.333333-120.666666c0 70.58-57.42 128-128 128s-128-57.42-128-128 57.42-128 128-128 128 57.42 128 128z m213.333333-234.666667a21.333333 21.333333 0 0 0-21.333333-21.333333h-85.333333a21.333333 21.333333 0 0 0 0 42.666666h85.333333a21.333333 21.333333 0 0 0 21.333333-21.333333z","0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText="截图",this.hideBox.style.fontSize="13px"}initEvent(){this.onClick=this.onClick.bind(this),"PC"===this.player.env?this.el.addEventListener("click",this.onClick):R(this.el).addEventListener("singleTap",this.onClick)}onClick(t){t.stopPropagation(),f(this.icon,"video-screenshot-animate")||(p(this.icon,["video-screenshot-animate"]),this.icon.ontransitionend=t=>{c(this.icon,["video-screenshot-animate"]),this.icon.ontransitionend=null}),this.screenShot()}screenShot(){const t=document.createElement("canvas");let e=this.player.video;t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height);const i=`${Math.random().toString(36).slice(-8)}_${e.currentTime}.png`;try{t.toBlob(t=>{const e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download=i,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(e)},"image/png")}catch(t){}let n=l("div.video-screenshot-toast"),s=l("span");s.innerText="截图成功!";let r=this.confirmIcon.cloneNode(!0);n.appendChild(r),n.appendChild(s);let o=new A(this.player,n);setTimeout(()=>{o.dispose(),o=null},2e3)}}class mt extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="VideoShot",this.countDown=30,this.timer=null,this.player=t,this.props=n||{},this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-videoshot","video-controller"]),this.icon=b("M640 266.666667v490.666666a53.393333 53.393333 0 0 1-53.333333 53.333334H53.333333a53.393333 53.393333 0 0 1-53.333333-53.333334V266.666667a53.393333 53.393333 0 0 1 53.333333-53.333334h533.333334a53.393333 53.393333 0 0 1 53.333333 53.333334z m357.053333-46.133334a52.746667 52.746667 0 0 0-53.613333 0.493334l-192 114a53.553333 53.553333 0 0 0-26.106667 45.853333v262.24a53.54 53.54 0 0 0 26.106667 45.853333l192 114a53.333333 53.333333 0 0 0 80.56-45.853333V266.88a52.746667 52.746667 0 0 0-26.946667-46.346667z","0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText="视频录制",this.hideBox.style.fontSize="13px"}initEvent(){this.onDown=this.onDown.bind(this),"PC"===this.player.env?this.el.onmousedown=this.onDown:this.el.ontouchstart=this.onDown}onDown(t){t.stopPropagation(),p(this.icon,["video-videoshot-animate"]),this.player.video.played&&this.videoShot()}videoShot(){let t=this.createInProgressToast(),e=new MediaRecorder(this.player.video.captureStream(60));e.addEventListener("start",t=>{console.log("开始录制视频")}),e.addEventListener("stop",t=>{console.log("结束录制视频")}),e.addEventListener("dataavailable",t=>{let e=t.data,i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download="Test.mp4",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),i=null}),e.start(),this.timer=window.setInterval(()=>{console.log(this.countDown),t.el.querySelector("span").innerText=`开始录屏，最多录制30秒; 还剩${this.countDown}秒`,0!==this.countDown?this.countDown--:this.stop(e)},1e3),"Mobile"===this.player.env?this.el.ontouchend=t=>{this.stop(e)}:this.el.onmouseup=i=>{c(this.icon,["video-videoshot-animate"]),this.stop(e),t.dispose(),t=null;let n=this.createSuccessToast();window.setTimeout(()=>{n.dispose(),n=null},2e3)}}stop(t){t.stop(),t=null,window.clearInterval(this.timer),this.timer=0,this.el.onmouseup=null,this.el.ontouchend=null,this.countDown=30}createInProgressToast(){let t=b("M449.59694 552.460488c-2.589471 0-5.210911-0.319688-7.800382-0.959063C313.729623 519.308862 224.280976 404.668816 224.280976 272.733659L224.280976 160.842927c0-17.646767 14.322014-31.96878 31.96878-31.96878s31.96878 14.322014 31.96878 31.96878l0 111.890732c0 102.587817 69.564066 191.716777 169.114849 216.748332 17.134267 4.315785 27.52512 21.674833 23.241303 38.778131C476.930248 542.805916 463.886985 552.460488 449.59694 552.460488L449.59694 552.460488zM574.40306 552.460488c-14.290045 0-27.301339-9.654572-30.977748-24.168398-4.315785-17.134267 6.074068-34.493315 23.208336-38.777132C666.217397 464.450435 735.781463 375.321475 735.781463 272.733659L735.781463 160.842927c0-17.646767 14.290045-31.96878 31.96878-31.96878s31.96878 14.322014 31.96878 31.96878l0 111.890732c0 131.935157-89.448648 246.575204-217.483614 278.767766C579.613971 552.1408 576.992531 552.460488 574.40306 552.460488zM767.750244 896.124878c-17.678736 0-31.96878-14.322014-31.96878-31.96878l0-95.906341c0-102.619785-69.564066-191.748745-169.114849-216.748332-17.134267-4.283817-27.52512-21.674833-23.241303-38.778131 4.347754-17.134267 21.930583-27.397245 38.777132-23.208336C710.270377 521.642583 799.719024 636.28263 799.719024 768.249756l0 95.906341C799.719024 881.802864 785.42898 896.124878 767.750244 896.124878zM256.249756 896.124878c-17.646767 0-31.96878-14.322014-31.96878-31.96878l0-95.906341c0-131.967126 89.448648-246.607173 217.516581-278.767766 17.167235-4.18791 34.461346 6.074068 38.777132 23.209335 4.315785 17.134267-6.074068 34.493315-23.241303 38.777132C357.750634 576.501011 288.218537 665.629971 288.218537 768.249756l0 95.906341C288.218537 881.802864 273.896523 896.124878 256.249756 896.124878zM863.656585 192.811707 160.343415 192.811707c-17.646767 0-31.96878-14.322014-31.96878-31.96878L128.374634 32.967805c0-17.646767 14.322014-31.96878 31.96878-31.96878l703.313171 0c17.678736 0 31.96878 14.322014 31.96878 31.96878l0 127.875122C895.625366 178.489694 881.335321 192.811707 863.656585 192.811707zM192.312195 128.874146l639.37561 0L831.687805 64.936585 192.312195 64.936585 192.312195 128.874146zM863.656585 1024 160.343415 1024c-17.646767 0-31.96878-14.322014-31.96878-31.96878L128.374634 864.156098c0-17.646767 14.322014-31.96878 31.96878-31.96878l703.313171 0c17.678736 0 31.96878 14.322014 31.96878 31.96878l0 127.875122C895.625366 1009.677986 881.335321 1024 863.656585 1024zM192.312195 960.062439l639.37561 0 0-63.937561L192.312195 896.124878 192.312195 960.062439z","0 0 1024 1024"),e=l("div.video-videoshot-inprogress-toast"),i=l("span");return i.innerText=`开始录屏，最多录制30秒; 还剩${this.countDown}秒`,e.appendChild(t),e.appendChild(i),new A(this.player,e)}createSuccessToast(){let t=b(et,"0 0 1024 1024"),e=l("div.video-videoshot-success-toast"),i=l("span");return i.innerText="录制成功!",e.appendChild(t),e.appendChild(i),new A(this.player,e)}}class gt{constructor(t,e,i,n,s){this.player=t,this.init(),e&&this.leftIconBox.appendChild(e),i&&(this.leftTextBox.innerText=i),n&&(this.rightTipBox.innerText=n),s&&this.rightElementBox.appendChild(s)}init(){this.el=l("div.video-subsettings-item"),this.leftArea=l("div.video-subsettings-itemleft"),this.rightArea=l("div.video-subsettings-itemright"),this.leftIconBox=l("div.video-subsettings-itemleft-icon"),this.leftTextBox=l("div.video-subsettings-itemleft-text"),this.rightTipBox=l("div.video-subsettings-itemright-tip"),this.rightElementBox=l("div.video-subsettings-itemright-icon"),this.el.append(this.leftArea,this.rightArea),this.leftArea.append(this.leftIconBox,this.leftTextBox),this.rightArea.append(this.rightTipBox,this.rightElementBox)}}class vt extends E{constructor(t,e){super(),this.id="SubsettingsBase",this.player=e,this.subsetting=t,this.__proto__.constructor.instance=this}initBaseSubsettingsItem(){this.SubsettingsItem.forEach(t=>{this.registerSubsettingsItem(t),t.instance.el.dataset.SubsettingsSubtitleType=t.leftText})}registerSubsettingsItem(t){let e=null;if(t.target)if(e=t.target instanceof vt?t.target:t.target.instance?t.target.instance:new t.target(this.subsetting,this.player),this.subsetting.registerSubsettingsBase(e),this.subsetting.subsettingsBaseGraph.has(this)){let t=this.subsetting.subsettingsBaseGraph.get(this);!t.includes(e)&&t.push(e),this.subsetting.subsettingsBaseGraph.set(this,t)}else this.subsetting.subsettingsBaseGraph.set(this,[e]);this.SubsettingsItem.includes(t)||this.SubsettingsItem.push(t);let i=new gt(this.player,t.leftIcon,t.leftText,t.rightTip,t.rightIcon);return t.instance=i,this.el.appendChild(i.el),i.el.addEventListener("click",i=>{i.stopPropagation(),t.target&&(this.el.style.display="none",e.el.style.display="",this.subsetting.hideBox.style.width=e.el.dataset.width?e.el.dataset.width+"px":"200px"),t.click&&t.click(t)}),t}}class bt extends vt{constructor(t,e){super(t,e),this.id="SubsettingsPlayrate",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"播放速度",target:yt},{leftText:"0.5",target:yt},{leftText:"0.75",target:yt},{leftIcon:b(it),leftText:"正常",target:yt},{leftText:"1.5",target:yt},{leftText:"2",target:yt}],this.init()}init(){this.el=l("div.video-subsettings-playrate"),this.el.dataset.width="170",this.el.style.display="none",this.initSubsettingsItem(),this.initEvent()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initEvent(){this.SubsettingsItem.forEach((t,e)=>{t.instance.el.onclick=e=>{if(e.stopPropagation(),"播放速度"===t.leftText){return this.el.style.display="none",void(this.subsetting.subsettingsBaseGraph.get(this)[0].el.style.display="")}"正常"===t.leftText?this.player.video.playbackRate=1:this.player.video.playbackRate=Number(t.leftText),t.leftIcon=b(it),t.instance.leftIconBox.innerHTML="",t.instance.leftIconBox.appendChild(t.leftIcon);for(let e of this.SubsettingsItem)e!==t&&(e.instance.leftIconBox.innerHTML="")}})}}class yt extends vt{constructor(t,e){super(t,e),this.SubsettingsItem=[{leftIcon:b("M675.328 117.717333A425.429333 425.429333 0 0 0 512 85.333333C276.352 85.333333 85.333333 276.352 85.333333 512s191.018667 426.666667 426.666667 426.666667 426.666667-191.018667 426.666667-426.666667c0-56.746667-11.093333-112-32.384-163.328a21.333333 21.333333 0 0 0-39.402667 16.341333A382.762667 382.762667 0 0 1 896 512c0 212.074667-171.925333 384-384 384S128 724.074667 128 512 299.925333 128 512 128c51.114667 0 100.8 9.984 146.986667 29.12a21.333333 21.333333 0 0 0 16.341333-39.402667zM456.704 305.92C432.704 289.152 405.333333 303.082667 405.333333 331.797333v360.533334c0 28.586667 27.541333 42.538667 51.370667 25.856l252.352-176.768c21.76-15.253333 21.632-43.541333 0-58.709334l-252.373333-176.768z m-8.597333 366.72V351.466667l229.269333 160.597333-229.269333 160.597333z","0 0 1024 1024"),leftText:"播放速度",rightTip:"正常",rightIcon:b(J,"0 0 1024 1024"),target:bt},{leftIcon:_(["M117.297548 128.825806h762.483613v172.659613a28.771097 28.771097 0 0 1-57.542193 0V186.401032H174.839742v115.084387a28.771097 28.771097 0 0 1-57.542194 0V128.825806zM117.297548 888.567742h762.483613v-172.626581a28.771097 28.771097 0 1 0-57.542193 0v115.084387H174.839742v-115.084387a28.771097 28.771097 0 1 0-57.542194 0V888.567742z","M392.588387 645.615484h-54.701419v-210.811871l-65.271742 20.248774V410.590968l114.093419-40.860903h5.879742v275.885419zM487.192774 618.727226c0-8.687484 2.906839-15.756387 8.687484-21.173678a31.545806 31.545806 0 0 1 22.131613-8.158967c8.984774 0 16.350968 2.741677 22.131613 8.158967a27.416774 27.416774 0 0 1 8.91871 21.173678c0 8.588387-2.906839 15.591226-8.687484 21.008516-5.813677 5.285161-13.245935 7.927742-22.329807 7.927742a31.545806 31.545806 0 0 1-22.131613-7.927742 27.449806 27.449806 0 0 1-8.720516-21.008516z m0-154.954323c0-8.720516 2.906839-15.756387 8.687484-21.206709a31.545806 31.545806 0 0 1 22.131613-8.125936c8.984774 0 16.350968 2.708645 22.131613 8.125936a27.416774 27.416774 0 0 1 8.91871 21.206709 27.416774 27.416774 0 0 1-8.687484 21.008516c-5.813677 5.285161-13.245935 7.927742-22.329807 7.927742a31.545806 31.545806 0 0 1-22.131613-7.927742 27.416774 27.416774 0 0 1-8.720516-21.008516zM724.463484 645.615484h-54.668387v-210.811871l-65.271742 20.248774V410.590968l114.093419-40.860903h5.84671v275.885419z"],"0 0 1024 1024"),leftText:"画面比例",rightTip:"默认",rightIcon:b(J,"0 0 1024 1024")},{leftIcon:b("M554.666667 810.666667v85.333333h-85.333334v-85.333333h85.333334zM170.666667 178.005333a42.666667 42.666667 0 0 1 34.986666 18.218667l203.904 291.328a42.666667 42.666667 0 0 1 0 48.896l-203.946666 291.328A42.666667 42.666667 0 0 1 128 803.328V220.672a42.666667 42.666667 0 0 1 42.666667-42.666667z m682.666666 0a42.666667 42.666667 0 0 1 42.368 37.717334l0.298667 4.949333v582.656a42.666667 42.666667 0 0 1-74.24 28.629333l-3.413333-4.181333-203.904-291.328a42.666667 42.666667 0 0 1-3.029334-43.861333l3.029334-5.034667 203.946666-291.328A42.666667 42.666667 0 0 1 853.333333 178.005333zM554.666667 640v85.333333h-85.333334v-85.333333h85.333334zM196.266667 319.104V716.8L335.957333 512 196.309333 319.104zM554.666667 469.333333v85.333334h-85.333334v-85.333334h85.333334z m0-170.666666v85.333333h-85.333334V298.666667h85.333334z m0-170.666667v85.333333h-85.333334V128h85.333334z","0 0 1024 1024"),leftText:"画面翻转",rightTip:"正常",rightIcon:b(J,"0 0 1024 1024")}],this.init()}init(){this.el=l("div.video-subsettings-main"),this.el.dataset.width="200",this.subsetting.hideBox.style.width=this.el.dataset.width+"px",this.initSubsettingsItem(),this.initEvent()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initEvent(){}}class _t extends nt{constructor(t,e,i){super(t,e,0,0,i),this.id="SubSetting",this.subsettingsBaseGraph=new Map,this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-subsettings","video-controller"]),p(this.hideBox,["video-subsettings-set"]),this.el["aria-label"]="设置",this.icon=b("M920.606667 611.153333A106.153333 106.153333 0 0 1 853.333333 512v-0.593333a106.166667 106.166667 0 0 1 67.106667-99.273334c26.82-10.713333 40.186667-41.426667 29.793333-68.466666a468.233333 468.233333 0 0 0-74.46-128.24A53.226667 53.226667 0 0 0 801.6 207.333333a106.666667 106.666667 0 0 1-119.433333 8.666667 106.253333 106.253333 0 0 1-52.366667-107.253333 53.46 53.46 0 0 0-44.62-60.4 474.34 474.34 0 0 0-147.893333 0.24 52.613333 52.613333 0 0 0-34.546667 21.333333 53.566667 53.566667 0 0 0-9.62 39.173333 106.753333 106.753333 0 0 1-105.493333 121.813334 107.333333 107.333333 0 0 1-66-22.793334 53.233333 53.233333 0 0 0-74.186667 8.286667A468 468 0 0 0 73.333333 344.82c-10.32 27.053333 3.126667 57.733333 30 68.38a106.706667 106.706667 0 0 1 0.166667 198.306667c-26.826667 10.666667-40.22 41.393333-29.853333 68.44A468.086667 468.086667 0 0 0 148 808.253333a52.6 52.6 0 0 0 35.673333 19.22 53.566667 53.566667 0 0 0 38.666667-11.213333 106.706667 106.706667 0 0 1 171.513333 98.893333 53.466667 53.466667 0 0 0 44.58 60.44 474.366667 474.366667 0 0 0 147.566667-0.066666 53.48 53.48 0 0 0 44.533333-60.486667 106.253333 106.253333 0 0 1 52.173334-107.373333 106.226667 106.226667 0 0 1 119.24 8.333333 53.52 53.52 0 0 0 38.706666 11.18 52.606667 52.606667 0 0 0 35.653334-19.253333 468 468 0 0 0 74.22-128.346667c10.34-27.066667-3.08-57.753333-29.92-68.426667zM640 512c0 70.58-57.42 128-128 128s-128-57.42-128-128 57.42-128 128-128 128 57.42 128 128z","0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.el.appendChild(this.iconBox),this.el.appendChild(this.hideBox),this.initSubSettingBase()}initSubSettingBase(){this.subsettingsMain=new yt(this,this.player),this.registerSubsettingsBase(this.subsettingsMain)}initEvent(){"PC"===this.player.env?this.initPCEvent():this.initMobileEvent(),this.el.onmouseenter=null,R(this.iconBox).addEventListener(this.clickOrTap,t=>{t.stopPropagation(),f(this.icon,"video-subsettings-animate")?c(this.icon,["video-subsettings-animate"]):p(this.icon,["video-subsettings-animate"]),f(this.hideBox,"video-set-hidden")?c(this.hideBox,["video-set-hidden"]):p(this.hideBox,["video-set-hidden"]),this.player.emit("oneControllerHover",this)})}initPCEvent(){this.clickOrTap="click"}initMobileEvent(){this.clickOrTap="singleTap"}registerSubsettingsBase(t){if(t instanceof vt)this.hideBox.appendChild(t.el);else{let e=new t(this,this.player);this.hideBox.appendChild(e.el)}}}const xt=window.navigator.userAgent.toLowerCase(),wt={isInWeixin:()=>-1!==xt.indexOf("micromessenger"),isInApp:()=>/(^|;\s)app\//.test(xt),isInIOS:()=>xt.match(/(iphone|ipod|ipad);?/i),isInAndroid:()=>xt.match(/android|adr/i),isInPc:()=>!(wt.isInAndroid()||wt.isInApp()||wt.isInIOS()||wt.isInWeixin()),get env(){return this.isInPc()?"PC":"Mobile"}};function kt(t){return"function"==typeof t&&/native code/.test(t.toString())}function St(t){if("undefined"!=typeof Promise&&kt(Promise))Promise.resolve().then(t());else if("undefined"!=typeof MutationObserver&&kt(MutationObserver)&&"[object MutationObserverConstructor]"===MutationObserver.toString()){let e=new MutationObserver(t),i=1,n=document.createTextNode(String(i));e.observe(n,{characterData:!0}),i++,n.data=String(i)}else setTimeout(()=>t())}class Et extends vt{constructor(t,e){super(t,e),this.id="SubsettingsSubtitle",this.switchOnIcon=b("M764 252H260C116.4 252 0 368.4 0 512s116.4 260 260 260h504c143.6 0 260-116.4 260-260S907.6 252 764 252z m0 484c-123.7 0-224-100.3-224-224s100.3-224 224-224 224 100.3 224 224-100.3 224-224 224z","0 0 1024 1024"),this.switchOffIcon=b("M764 252H260C116.4 252 0 368.4 0 512s116.4 260 260 260h504c143.6 0 260-116.4 260-260S907.6 252 764 252zM260 736C136.3 736 36 635.7 36 512s100.3-224 224-224 224 100.3 224 224-100.3 224-224 224z","0 0 1024 1024"),this.status="show",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"字幕设置",target:yt},{leftIcon:b("M128.512 214.016h768v81.92h-768zM128.512 718.336h768v81.92h-768zM128.512 466.432h486.4v81.92h-486.4zM896.512 507.392l-174.592-133.12v266.24l174.08-133.12"),leftText:"字幕显示",rightTip:"Show",rightIcon:this.switchOnIcon}],this.init()}init(){this.el=l("div.video-subsettings-subtitle"),this.el.dataset.width="180",this.el.style.display="none",p(this.switchOffIcon,["video-switch-off"]),p(this.switchOnIcon,["video-switch-on"]),this.initSubsettingsItem(),this.initEvent(),W(this)}initSubsettingsItem(){this.initBaseSubsettingsItem(),this.SubsettingsItem[1].instance.rightElementBox.appendChild(this.switchOffIcon),this.switchOffIcon.style.display="none"}initEvent(){for(let t=0;t<this.SubsettingsItem.length;t++)this.SubsettingsItem[t].instance.el.onclick=e=>{e.stopPropagation(),1!==t?this.player.emit("SubsettingsSubtitleClick",this.SubsettingsItem[t],t):"show"===this.status?(this.player.emit("HideSubtitle"),this.switchOffIcon.style.display="",this.switchOnIcon.style.display="none",this.status="hide",this.SubsettingsItem[t].instance.rightTipBox.innerText="Hide"):(this.player.emit("ShowSubtitle"),this.switchOffIcon.style.display="none",this.switchOnIcon.style.display="",this.status="show",this.SubsettingsItem[t].instance.rightTipBox.innerText="Show")}}}class Tt extends T{constructor(t,e,i){super(e,i),this.id="Controller",this.leftControllers=[ot,at,pt],this.rightController=[_t,mt,ft,ut,ct,rt],this.player=t,this.init()}init(){this.initControllers(),this.initTemplate(),this.initComponent(),W(this)}initControllers(){let t=this.player.playerOptions.leftBottomBarControllers,e=this.player.playerOptions.rightBottomBarControllers;t&&(this.leftControllers=t),e&&(this.rightController=e)}initTemplate(){this.leftArea=l("div.video-bottombar-left"),this.mediumArea=l("div.video-bottombar-medium"),this.rightArea=l("div.video-bottombar-right"),this.el.appendChild(this.leftArea),this.el.appendChild(this.mediumArea),this.el.appendChild(this.rightArea)}initComponent(){this.leftControllers.forEach(t=>{let e=new t(this.player,this.leftArea,"div");V.get(e.id)||W(e),this[e.id]=e}),this.rightController.forEach(t=>{let e=new t(this.player,this.rightArea,"div");V.get(e.id)||W(e),this[e.id]=e})}}class Ut extends T{constructor(t,e,i){super(e,i),this.id="Progress",this.mouseX=0,this.dotLeft=0,this.player=t,this.initBase()}initBase(){this.initBaseTemplate(),this.initBaseEvent()}initBaseTemplate(){this.dot=l("div"),this.completedProgress=l("div"),this.bufferProgress=l("div"),this.el.append(this.dot,this.completedProgress,this.bufferProgress)}initBaseEvent(){this.onMouseMove=this.onMouseMove.bind(this),"PC"===this.player.env?this.initBasePCEvent():this.initBaseMobileEvent(),this.on(n.PROGRESS_CLICK,(t,e)=>{let i=t/this.el.clientWidth;i<0?i=0:i>1&&(i=1),this.dot.style.left=100*i+"%",this.completedProgress.style.width=100*i+"%"}),this.on(n.DOT_DRAG,(t,e)=>{let i=(t+this.dotLeft)/this.el.clientWidth;i<0?i=0:i>1&&(i=1),this.dot.style.left=100*i+"%",this.completedProgress.style.width=100*i+"%"})}initBasePCEvent(){let t=this;this.el.onmouseenter=e=>{this.emit(n.PROGRESS_MOUSE_ENTER,e,t)},this.el.onmouseleave=e=>{this.emit(n.PROGRESS_MOUSE_LEAVE,e,t)},this.el.onclick=e=>{e.stopPropagation(),this.emit(n.PROGRESS_CLICK,e.offsetX,t)},this.dot.addEventListener("mousedown",e=>{e.stopPropagation(),this.emit(n.DOT_DOWN),this.mouseX=e.pageX,this.dotLeft=parseInt(this.dot.style.left)/100*this.el.clientWidth,document.body.addEventListener("mousemove",t.onMouseMove),document.body.onmouseup=e=>{this.emit(n.DOT_UP,this.completedProgress.clientWidth/this.el.clientWidth,t),document.body.removeEventListener("mousemove",t.onMouseMove),document.body.onmouseup=null}})}initBaseMobileEvent(){let t=this;R(this.el).addEventListener("singleTap",e=>{let i=e.e.touches[0].clientX-o(this.el).x;this.emit(n.PROGRESS_CLICK,i,t)}),R(this.dot).addEventListener("touchstart",e=>{e.preventDefault(),this.emit(n.DOT_DOWN),this.mouseX=e.touches[0].clientX,this.dotLeft=parseInt(this.el.style.left),document.body.addEventListener("touchmove",this.onMouseMove),document.body.ontouchend=e=>{this.emit(n.DOT_UP,this.completedProgress.clientWidth/this.el.clientWidth,t),document.body.removeEventListener("touchmove",this.onMouseMove),document.body.ontouchend=null}})}onMouseMove(t){if(t instanceof MouseEvent){let e=t.pageX-this.mouseX;this.emit(n.DOT_DRAG,e,this)}else{let e=t.touches[0].clientX-this.mouseX;this.emit(n.DOT_DRAG,e,this)}}}class Bt extends Ut{constructor(t,e,i){super(t,e,i),this.id="VideoProgress",this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){p(this.el,["video-progress"]),p(this.dot,["video-progress-dot","video-progress-dot-hidden"]),p(this.completedProgress,["video-progress-completed"])}initEvent(){this.on(n.PROGRESS_CLICK,(t,e)=>{let i=t/this.el.clientWidth;i<0?i=0:i>1&&(i=1),this.player.video.currentTime=i*this.player.video.duration,this.player.video.paused&&this.player.video.play()}),this.on(n.DOT_DRAG,(t,e)=>{let i=(t+this.dotLeft)/this.el.clientWidth;i<0?i=0:i>1&&(i=1),this.player.emit(n.VIDEO_DOT_DRAG,i)}),this.on(n.PROGRESS_MOUSE_ENTER,()=>{c(this.dot,["video-progress-dot-hidden"])}),this.on(n.PROGRESS_MOUSE_LEAVE,()=>{p(this.dot,["video-progress-dot-hidden"])}),this.on(n.DOT_DOWN,()=>{this.player.emit(n.DOT_DOWN)}),this.on(n.DOT_UP,t=>{this.player.emit(n.DOT_UP),this.player.video.currentTime=t*this.player.video.duration}),this.player.video.addEventListener("timeupdate",t=>{if(this.player.enableSeek){let t=this.player.video.currentTime/this.player.video.duration;this.dot.style.left=100*t+"%",this.completedProgress.style.width=100*t+"%"}})}}class Ct extends T{constructor(t,e,i){super(e,i),this.id="MediumBar",this.player=t,this.init()}init(){this.initTemplate(),this.initComponent(),W(this)}initTemplate(){this.leftArea=l("div.video-mediumbar-left"),this.mediumArea=l("div.video-mediumbar-medium"),this.rightArea=l("div.video-mediumbar-right"),this.el.append(this.leftArea,this.mediumArea,this.rightArea)}initComponent(){this.videoProgress=new Bt(this.player,this.el,"div"),this.mediumArea.append(this.videoProgress.el)}}class At extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="Toolbar",this.status="hidden",this.timer=0,this.player=t,this.props=n||{},this.init()}init(){this.initTemplate(),this.initComponent(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-toolbar"])}initComponent(){this.mediumbar=new Ct(this.player,this.el,"div.video-mediumbar"),this.controller=new Tt(this.player,this.el,"div.video-bottombar")}initEvent(){this.player.on(n.SHOW_TOOLBAR,()=>{this.onShowToolBar()}),this.player.on(n.HIDE_TOOLBAR,()=>{this.onHideToolBar()})}hideToolBar(){f(this.el,"video-toolbar-hidden")||this.player.video.paused||(p(this.el,["video-toolbar-hidden"]),this.status="hidden")}showToolBar(){f(this.el,"video-toolbar-hidden")&&(c(this.el,["video-toolbar-hidden"]),this.status="show"),this.timer=window.setTimeout(()=>{this.player.video.paused||this.hideToolBar()},3e3)}onShowToolBar(){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.showToolBar()}onHideToolBar(){this.hideToolBar()}}class It extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="TopBar",this.timer=0,this.player=t,this.props=n||{},this.init()}init(){this.initTemplate(),this.initEvent(),W(this)}initTemplate(){p(this.el,["video-topbar","video-topbar-hidden"]),this.leftArea=l("div.video-topbar-left"),this.rightArea=l("div.video-topbar-right"),this.el.appendChild(this.leftArea),this.el.appendChild(this.rightArea)}initEvent(){this.player.on(n.SHOW_TOOLBAR,()=>{this.onShowToolBar()}),this.player.on(n.HIDE_TOOLBAR,()=>{this.onHideToolBar()})}hideToolBar(){f(this.el,"video-topbar-hidden")||p(this.el,["video-topbar-hidden"])}showToolBar(){f(this.el,"video-topbar-hidden")&&c(this.el,["video-topbar-hidden"]),this.timer=window.setTimeout(()=>{this.hideToolBar()},3e3)}onShowToolBar(){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.showToolBar()}onHideToolBar(){this.hideToolBar()}}class zt{constructor(){this.newestTime=0,this.maxInterval=5,this.queue=[]}removeOutTimeData(){this.queue.filter((t,e)=>this.newestTime-t.timestamp<=this.maxInterval)}add(t){return this.newestTime=t.timestamp,this.queue.unshift(t),this.removeOutTimeData(),this}push(t){return this.queue.push(t),this}shift(){return this.queue.shift()}splice(t,e){return this.queue.splice(t,e),this}clear(){for(;this.queue.length;)this.queue.pop();return this}forEach(t){for(let e=0;e<this.queue.length;e++)t(this.queue[e],e)}get length(){return this.queue.length}}class Lt{constructor(t,e){this.moovingQueue=[],this.timer=null,this.renderInterval=100,this.trackHeight=10,this.opacity=1,this.fontSizeScale=1,this.isHidden=!1,this.defaultDanma={message:"default message",fontColor:"#fff",fontSize:this.trackHeight,fontFamily:"",fontWeight:500},this.queue=new zt,this.container=t,this.player=e,this.trackNumber=this.container.clientHeight/2/this.trackHeight,this.tracks=new Array(this.container.clientHeight/this.trackHeight),this.init()}init(){for(let t=0;t<this.tracks.length;t++)this.tracks[t]||(this.tracks[t]={track:{id:0,priority:0},datas:[]}),this.tracks[t].track={id:t,priority:15-t}}pause(){this.moovingQueue.forEach(t=>{this.pauseOneData(t)})}resume(){this.timer=window.setTimeout(()=>{this.render()},this.renderInterval),this.moovingQueue.forEach(t=>{this.resumeOneData(t)})}resumeOneData(t){t.dom.style.transform=`translateX(${-t.totalDistance}px)`,t.startTime=Date.now(),t.rollTime=(t.totalDistance-t.rollDistance)/t.rollSpeed,t.dom.style.transition=`transform ${t.rollTime}s linear`}pauseOneData(t){let e=(Date.now()-t.startTime)*t.rollSpeed/1e3;t.rollDistance=e+(t.rollDistance?t.rollDistance:0),t.dom.style.transition="",t.dom.style.transform=`translateX(${-t.rollDistance}px)`}startDanmaku(){this.render()}addData(t){this.queue.push(this.parseData(t)),console.log(this.timer),null===this.timer&&this.render()}parseData(t){if("string"==typeof t)return{message:t,fontColor:"#fff",fontSize:this.trackHeight,fontWeight:500,timestamp:this.player.video.currentTime};if("object"==typeof t){if(!t.message||""===t.message)throw new Error(`传入的弹幕数据${t}不合法`);return Object.assign(Object.assign(Object.assign({},this.defaultDanma),{timestamp:this.player.video.currentTime}),t)}throw new Error(`传入的弹幕数据${t}不合法`)}render(){try{this.renderToDOM()}finally{this.renderEnd()}}renderEnd(){0===this.queue.length?(window.clearTimeout(this.timer),this.timer=null):this.timer=window.setTimeout(()=>{this.render()},this.renderInterval)}renderToDOM(){if(0===this.queue.length)return;let t=this.queue.shift();if(!t.dom){let e=l("div.video-danmaku-message");e.innerText=t.message,""!==t.fontFamily&&(e.style.fontFamily=t.fontFamily),e.style.color=t.fontColor,e.style.fontSize=t.fontSize*this.fontSizeScale+"px",e.style.fontWeight=t.fontWeight+"",e.style.position="absolute",e.style.left="100%",e.style.whiteSpace="nowrap",e.style.willChange="transform",e.style.cursor="pointer",e.style.opacity=this.opacity+"",e.style.visibility=this.isHidden?"hidden":"",t.dom=e}this.container.appendChild(t.dom),t.totalDistance=this.container.clientWidth+t.dom.clientWidth,t.width=t.dom.clientWidth,t.rollTime=t.rollTime||Math.floor(.0058*t.totalDistance*(.3*Math.random()+.7)),t.rollSpeed=parseFloat((t.totalDistance/t.rollTime).toFixed(2)),t.useTracks=Math.ceil(t.dom.clientHeight/this.trackHeight),t.y=[],this.addDataToTrack(t),0===t.y.length?([...this.container.childNodes].includes(t.dom)&&this.container.removeChild(t.dom),this.queue.push(t)):(t.dom.style.top=t.y[0]*this.trackHeight+"px",this.startAnimate(t)),t.dom.ontransitionstart=e=>{t.startTime=Date.now()}}addDataToTrack(t){let e=[];for(let i=0;i<this.trackNumber;i++){let n=this.tracks[i].datas;if(0===n.length)e.push(i);else{let s=n[n.length-1],r=s.rollSpeed*(Date.now()-s.startTime)/1e3;r>s.width&&(t.rollSpeed<=s.rollSpeed||(r-s.width)/(t.rollSpeed-s.rollSpeed)>(this.container.clientWidth+s.width-r)/s.rollSpeed)?e.push(i):e=[]}if(e.length>=t.useTracks){t.y=e,t.y.forEach(e=>{this.tracks[e].datas.push(t)});break}}}removeDataFromTrack(t){t.y.forEach(e=>{let i=this.tracks[e].datas,n=i.indexOf(t);-1!==n&&i.splice(n,1)})}startAnimate(t){this.player.video.paused?this.queue.add(t):(this.moovingQueue.push(t),t.dom.style.transition=`transform ${t.rollTime}s linear`,t.dom.style.transform=`translateX(-${t.totalDistance}px)`,t.dom.ontransitionend=e=>{this.container.removeChild(t.dom),this.removeDataFromTrack(t),this.moovingQueue.splice(this.moovingQueue.indexOf(t),1)})}flush(){console.log("flush"),this.moovingQueue.forEach(t=>{var e;null===(e=t.dom.parentNode)||void 0===e||e.removeChild(t.dom),t.dom.ontransitionend=null,t.dom.ontransitionstart=null}),this.queue.forEach((t,e)=>{var i;[...this.container.children].includes(t.dom)&&(null===(i=t.dom.parentNode)||void 0===i||i.removeChild(t.dom),t.dom.ontransitionend=null,t.dom.ontransitionstart=null)}),this.tracks.forEach(t=>{t.datas=[]}),this.moovingQueue=[],this.queue.clear(),window.clearTimeout(this.timer),this.timer=null}close(){this.isHidden=!0,this.moovingQueue.forEach(t=>{t.dom.style.visibility="hidden"}),this.queue.forEach((t,e)=>{t.dom&&(t.dom.style.visibility="")})}open(){this.isHidden=!1,this.moovingQueue.forEach(t=>{t.dom.style.visibility=""}),this.queue.forEach((t,e)=>{t.dom&&(t.dom.style.visibility="")})}setOpacity(t){this.opacity=t,this.moovingQueue.forEach(e=>{e.dom.style.opacity=t+""})}setTrackNumber(t){this.trackNumber=this.container.clientHeight/this.trackHeight*t}setFontSize(t){this.fontSizeScale=t,this.moovingQueue.forEach(t=>{t.dom.style.fontSize=t.fontSize*this.fontSizeScale+"px"})}}function Pt(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}}Pt('.danmaku-input-wrapper {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 0 5px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 100%;\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  background-color: hsla(0, 0%, 100%, 0.15);\n  border-radius: 2px;\n}\n.danmaku-input-wrapper .danmaku-input {\n  background-color: transparent;\n  width: calc(100% - 40px);\n  height: 50%;\n  line-height: 100%;\n  color: #fff;\n  font-size: 13px;\n  outline: 0;\n  padding: 0;\n  border: 0;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.danmaku-input-wrapper .danmaku-send {\n  height: 100%;\n  width: 50px;\n  text-align: center;\n  line-height: 30px;\n  background-color: transparent;\n  color: #fff;\n  font-size: 13px;\n  vertical-align: middle;\n  cursor: pointer;\n}\n.danmaku-box {\n  cursor: pointer;\n}\n.video-danmaku-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-color: transparent;\n  left: 0;\n  top: 0;\n  z-index: 3001;\n}\n.video-danmaku-container .video-danmaku-message {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  white-space: pre;\n  pointer-events: none;\n  -webkit-perspective: 500px;\n          perspective: 500px;\n  display: inline-block;\n  will-change: transform;\n  font-weight: normal;\n  line-height: 1.125;\n  font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;\n  text-shadow: #000000 1px 0px 1px, #000000 0px 1px 1px, #000000 0px -1px 1px, #000000 -1px 0px 1px;\n  opacity: 1;\n  margin-left: 0px;\n}\n.video-danmaku-container .video-danmaku-loading-base {\n  position: absolute;\n  z-index: 3001;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  background-color: hsla(0, 0%, 100%, 0.15);\n  padding: 10px 10px;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  color: #fff;\n  border-radius: 5px;\n  left: 5px;\n  bottom: 60px;\n  overflow: hidden;\n  -webkit-transition: all 1.5s ease;\n  transition: all 1.5s ease;\n  font-size: 14px;\n}\n.video-danmaku-container .video-danmaku-loading {\n  left: 50%;\n  bottom: 50%;\n  -webkit-transform: translate(-50%, 50%);\n          transform: translate(-50%, 50%);\n}\n.video-danmaku-container .video-danmaku-shaking {\n  -webkit-animation: shake 2.5s 0.15s linear infinite;\n          animation: shake 2.5s 0.15s linear infinite;\n}\n.video-danmaku-container .video-danmaku-loading-hide {\n  -webkit-transform: scale(0);\n          transform: scale(0);\n  opacity: 0;\n}\n@-webkit-keyframes shake {\n  10% {\n    -webkit-transform: rotate(15deg) translate(-50%, 50%);\n            transform: rotate(15deg) translate(-50%, 50%);\n  }\n  20% {\n    -webkit-transform: rotate(-10deg) translate(-50%, 50%);\n            transform: rotate(-10deg) translate(-50%, 50%);\n  }\n  30% {\n    -webkit-transform: rotate(5deg) translate(-50%, 50%);\n            transform: rotate(5deg) translate(-50%, 50%);\n  }\n  40% {\n    -webkit-transform: rotate(-5deg) translate(-50%, 50%);\n            transform: rotate(-5deg) translate(-50%, 50%);\n  }\n  50% {\n    -webkit-transform: rotate(10deg) translate(-50%, 50%);\n            transform: rotate(10deg) translate(-50%, 50%);\n  }\n  60% {\n    -webkit-transform: rotate(-15deg) translate(-50%, 50%);\n            transform: rotate(-15deg) translate(-50%, 50%);\n  }\n  70% {\n    -webkit-transform: rotate(10deg) translate(-50%, 50%);\n            transform: rotate(10deg) translate(-50%, 50%);\n  }\n  80% {\n    -webkit-transform: rotate(-5deg) translate(-50%, 50%);\n            transform: rotate(-5deg) translate(-50%, 50%);\n  }\n  90%,\n  100% {\n    -webkit-transform: rotate(0deg) translate(-50%, 50%);\n            transform: rotate(0deg) translate(-50%, 50%);\n  }\n}\n@keyframes shake {\n  10% {\n    -webkit-transform: rotate(15deg) translate(-50%, 50%);\n            transform: rotate(15deg) translate(-50%, 50%);\n  }\n  20% {\n    -webkit-transform: rotate(-10deg) translate(-50%, 50%);\n            transform: rotate(-10deg) translate(-50%, 50%);\n  }\n  30% {\n    -webkit-transform: rotate(5deg) translate(-50%, 50%);\n            transform: rotate(5deg) translate(-50%, 50%);\n  }\n  40% {\n    -webkit-transform: rotate(-5deg) translate(-50%, 50%);\n            transform: rotate(-5deg) translate(-50%, 50%);\n  }\n  50% {\n    -webkit-transform: rotate(10deg) translate(-50%, 50%);\n            transform: rotate(10deg) translate(-50%, 50%);\n  }\n  60% {\n    -webkit-transform: rotate(-15deg) translate(-50%, 50%);\n            transform: rotate(-15deg) translate(-50%, 50%);\n  }\n  70% {\n    -webkit-transform: rotate(10deg) translate(-50%, 50%);\n            transform: rotate(10deg) translate(-50%, 50%);\n  }\n  80% {\n    -webkit-transform: rotate(-5deg) translate(-50%, 50%);\n            transform: rotate(-5deg) translate(-50%, 50%);\n  }\n  90%,\n  100% {\n    -webkit-transform: rotate(0deg) translate(-50%, 50%);\n            transform: rotate(0deg) translate(-50%, 50%);\n  }\n}\n');class Ot extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="DanmakuInput",this.props=n||{},this.player=t,this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){p(this.el,["danmaku-input-wrapper"]),this.inputBox=l("input.danmaku-input",{type:"text"}),this.sendBox=l("span.danmaku-send"),this.sendBox.innerText="发送",this.el.appendChild(this.inputBox),this.el.appendChild(this.sendBox)}initEvent(){this.sendBox.onclick=t=>{t.stopPropagation();let e=this.inputBox.value;this.emit("sendData",e),this.inputBox.value="",this.inputBox.blur()},this.inputBox.addEventListener("focus",t=>{t.stopPropagation(),this.player.emit("inputFocus")}),this.inputBox.addEventListener("blur",t=>{t.stopPropagation(),this.player.emit("inputBlur")}),this.inputBox.addEventListener("click",t=>{t.stopPropagation()})}}class Dt extends nt{constructor(t,e,i,n,s){super(t,e,0,0,i,n,s),this.id="DanmakuOpenClose",this.danmakuClosePath=Q,this.danmakuOpenPath=Z,this.status="open",this.msg="关闭弹幕",this.props=n||{},this.player=t,this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){p(this.el,["video-danmaku-openclose","video-controller"]),this.icon=b(this.danmakuOpenPath,"0 0 1024 1024"),this.iconBox.appendChild(this.icon),this.hideBox.innerText=this.msg,this.hideBox.style.fontSize="13px"}initEvent(){this.iconBox.addEventListener("click",t=>{t.stopPropagation(),"open"===this.status?(this.replaceIcon(b(Q,"0 0 1024 1024")),this.status="close",this.player.emit("closeDanmaku"),this.msg="开启弹幕"):(this.replaceIcon(b(Z,"0 0 1024 1024")),this.status="open",this.player.emit("openDanmaku"),this.msg="关闭弹幕"),this.hideBox.innerText=this.msg})}}class Nt extends vt{constructor(t,e){super(t,e),this.id="SubsettingsDanmakuOpacity",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"弹幕透明度",target:Mt},{leftText:"100%",leftIcon:b(it),target:Mt},{leftText:"75%",target:Mt},{leftText:"50%",target:Mt},{leftText:"0",target:Mt}],this.init()}init(){this.initTemplate(),this.initSubsettingsItem(),this.initEvent()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initTemplate(){this.el=l("div.video-subsettings-danmaku-opacity"),this.el.dataset.width="200",this.el.style.display="none"}initEvent(){this.SubsettingsItem.forEach((t,e)=>{0!==e&&(t.instance.el.onclick=()=>{this.subsetting.emit("OpacityChange",.01*parseFloat(t.leftText)),t.instance.leftIconBox.innerHTML="",t.instance.leftIconBox.appendChild(b(it));for(let e=1;e<this.SubsettingsItem.length;e++){let i=this.SubsettingsItem[e];i!==t&&(i.instance.leftIconBox.innerHTML="")}})})}}class Rt extends vt{constructor(t,e){super(t,e),this.id="SubsettingsDanmakuRange",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"弹幕显示范围",target:Mt},{leftText:"1/4",target:Mt},{leftText:"半屏",leftIcon:b(it),target:Mt},{leftText:"3/4",target:Mt},{leftText:"满屏",target:Mt}],this.init()}init(){this.initTemplate(),this.initSubsettingsItem(),this.initEvent()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initTemplate(){this.el=l("div.video-subsettings-danmaku-range"),this.el.dataset.width="200",this.el.style.display="none"}initEvent(){this.SubsettingsItem.forEach((t,e)=>{0!==e&&(t.instance.el.onclick=()=>{this.subsetting.emit("RangeChange",t.leftText),t.instance.leftIconBox.innerHTML="",t.instance.leftIconBox.appendChild(b(it));for(let e=1;e<this.SubsettingsItem.length;e++){let i=this.SubsettingsItem[e];i!==t&&(i.instance.leftIconBox.innerHTML="")}})})}}class Ft extends vt{constructor(t,e){super(t,e),this.id="SubsettingsDanmakuSize",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"字体大小",target:Mt},{leftText:"极小",target:Mt},{leftText:"小",target:Mt},{leftText:"适中",leftIcon:b(it),target:Mt},{leftText:"大",target:Mt},{leftText:"极大",target:Mt}],this.init()}init(){this.initTemplate(),this.initSubsettingsItem(),this.initEvent()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initTemplate(){this.el=l("div.video-subsettings-danmaku-size"),this.el.dataset.width="200",this.el.style.display="none"}initEvent(){this.SubsettingsItem.forEach((t,e)=>{0!==e&&(t.instance.el.onclick=()=>{this.subsetting.emit("SizeChange",t.leftText),t.instance.leftIconBox.innerHTML="",t.instance.leftIconBox.appendChild(b(it));for(let e=1;e<this.SubsettingsItem.length;e++){let i=this.SubsettingsItem[e];i!==t&&(i.instance.leftIconBox.innerHTML="")}})})}}class Mt extends vt{constructor(t,e){super(t,e),this.id="SubsettingsDanmakuMain",this.SubsettingsItem=[{leftIcon:b(tt,"0 0 1024 1024"),leftText:"弹幕设置",target:yt},{leftText:"弹幕速度",rightTip:"适中",rightIcon:b(J,"0 0 1024 1024")},{leftText:"弹幕透明度",rightTip:"100%",rightIcon:b(J,"0 0 1024 1024"),target:Nt},{leftText:"字体大小",rightTip:"适中",rightIcon:b(J,"0 0 1024 1024"),target:Ft},{leftText:"显示范围",rightTip:"半屏",rightIcon:b(J,"0 0 1024 1024"),target:Rt}],this.init()}init(){this.initTemplate(),this.initEvent(),this.initSubsettingsItem()}initSubsettingsItem(){this.initBaseSubsettingsItem()}initTemplate(){this.el=l("div.video-subsettings-danmaku-main"),this.el.dataset.width="250",this.el.style.display="none"}initEvent(){this.subsetting.on("OpacityChange",t=>{this.player.danmakuController.setOpacity(t),this.SubsettingsItem[2].instance.rightTipBox.innerText=100*t+"%"}),this.subsetting.on("RangeChange",t=>{let e=null;"满屏"===t?e=1:"半屏"===t?e=.5:"1/4"===t?e=1/4:"3/4"===t&&(e=3/4),this.player.danmakuController.setTrackNumber(e),this.SubsettingsItem[4].instance.rightTipBox.innerText=t}),this.subsetting.on("SizeChange",t=>{let e=null;"极小"===t?e=.5:"小"===t?e=.75:"适中"===t?e=1:"大"===t?e=1.25:"极大"===t&&(e=1.5),this.player.danmakuController.setFontSize(e),this.SubsettingsItem[3].instance.rightTipBox.innerText=t})}}class Ht{constructor(t){this.id="DanmakuSettings",this.player=t,this.init()}init(){this.initTemplate()}initTemplate(){this.subsettingsMain=yt.instance,this.subsettingsMain.registerSubsettingsItem({leftIcon:_(["M714.752 555.008h-112.64v-26.624h61.44c24.576 0 36.864-14.336 36.864-36.864v-147.456c0-34.816-20.48-38.912-32.768-38.912h-16.384c6.144-8.192 10.24-14.336 14.336-20.48 8.192-14.336 4.096-24.576-8.192-32.768-12.288-6.144-24.576-2.048-32.768 8.192-2.048 2.048-6.144 8.192-8.192 12.288-10.24 16.384-18.432 26.624-20.48 32.768H552.96c-8.192-14.336-18.432-30.72-28.672-47.104-8.192-10.24-20.48-12.288-32.768-6.144-12.288 8.192-16.384 20.48-8.192 32.768 4.096 4.096 8.192 12.288 14.336 22.528h-8.192c-12.288-2.048-20.48 2.048-26.624 6.144-6.144 6.144-8.192 16.384-8.192 28.672V491.52c0 12.288 2.048 22.528 8.192 28.672 6.144 6.144 16.384 8.192 26.624 8.192H552.96v28.672h-102.4c-4.096 0-8.192 0-12.288 6.144v-43.008c0-28.672-16.384-36.864-28.672-36.864h-51.2s-2.048-2.048 0-10.24l2.048-45.056c0-4.096 0-8.192 2.048-8.192H395.264c8.192 0 16.384-2.048 20.48-6.144 6.144-6.144 10.24-16.384 10.24-32.768V307.2c0-14.336-2.048-24.576-10.24-30.72-6.144-6.144-16.384-10.24-30.72-10.24h-65.536c-8.192 0-20.48 2.048-22.528 22.528 0 14.336 6.144 22.528 20.48 24.576h53.248c6.144 0 10.24 2.048 10.24 12.288v30.72c0 14.336-6.144 16.384-12.288 16.384h-22.528c-12.288 0-20.48 2.048-26.624 8.192-6.144 6.144-8.192 16.384-8.192 28.672l-2.048 86.016c0 10.24 2.048 20.48 8.192 24.576 6.144 6.144 14.336 8.192 24.576 8.192h40.96c4.096 0 6.144 0 6.144 2.048 2.048 2.048 4.096 4.096 2.048 14.336 0 2.048 0 8.192-2.048 16.384-2.048 43.008-6.144 59.392-8.192 65.536-6.144 12.288-26.624 6.144-43.008 0-18.432-6.144-26.624 2.048-32.768 10.24-6.144 14.336-2.048 26.624 12.288 32.768 47.104 16.384 79.872 14.336 100.352-8.192 6.144-6.144 14.336-20.48 18.432-67.584 4.096 6.144 10.24 8.192 14.336 8.192h102.4v69.632c0 6.144 2.048 20.48 24.576 20.48 14.336 0 22.528-8.192 22.528-20.48v-69.632h110.592c6.144 0 18.432-2.048 20.48-22.528 2.048-20.48-8.192-24.576-16.384-24.576z m-151.552-65.536h-53.248c-10.24 2.048-14.336-6.144-12.288-18.432v-34.816h65.536v53.248z m0-90.112h-65.536v-43.008c-2.048-10.24 2.048-14.336 12.288-12.288h53.248v55.296z m32.768-53.248h51.2c10.24-2.048 14.336 2.048 14.336 12.288v43.008h-65.536v-55.296z m0 141.312v-53.248h65.536V471.04c0 10.24-6.144 16.384-16.384 16.384h-49.152z","M724.992 145.408H299.008C200.704 145.408 122.88 223.232 122.88 321.536v288.768c0 96.256 77.824 176.128 176.128 176.128h106.496l83.968 83.968c6.144 6.144 14.336 8.192 22.528 8.192s16.384-2.048 22.528-8.192l83.968-83.968h106.496c96.256 0 176.128-77.824 176.128-176.128V321.536c0-98.304-77.824-176.128-176.128-176.128zM839.68 610.304c0 63.488-51.2 114.688-114.688 114.688h-118.784c-4.096 0-8.192 0-10.24 2.048-4.096 2.048-8.192 4.096-10.24 6.144L512 804.864l-71.68-71.68c-2.048-2.048-6.144-6.144-10.24-6.144-4.096-2.048-8.192-2.048-10.24-2.048h-118.784c-63.488 0-114.688-51.2-114.688-114.688V321.536c0-63.488 51.2-114.688 114.688-114.688h428.032c63.488 0 114.688 51.2 114.688 114.688v288.768z"],"0 0 1024 1024"),leftText:"弹幕设置",rightTip:"更多",rightIcon:b(J,"0 0 1024 1024"),target:Mt})}}window.global=window;class Gt{constructor(t){this.config=Object.assign({baseURL:"https://loaclhost/",timeout:1e4,headers:{}},t)}get(t,e){return new Promise((i,n)=>{let s=`${this.config.baseURL}${t}`;if(e.query){s+="?";for(let t in e.query)s+=`${t}=${e.query[t]}&`;s=s.slice(0,s.length-1)}fetch(s,{method:"GET",mode:"cors",headers:this.config.header}).then(t=>(!1===t.ok&&n("fail"),t.json()),t=>{n("fail")}).then(t=>{i(t)},t=>{n("fail")})})}}class jt{constructor(t,e){this.player=t,this.video=t.video,this.container=t.el,this.options=Object.assign({type:"http"},e),this.instance=new Gt({baseURL:""}),this.init()}init(){this.onTimeupdate=this.onTimeupdate.bind(this),this.el=l("div.video-danmaku-container"),this.el.style.backgroundColor="#000",this.danmakuLoading=l("div"),p(this.danmakuLoading,["video-danmaku-loading-base","video-danmaku-loading","video-danmaku-shaking"]),this.danmakuLoading.innerHTML="<span>弹幕数据加载中...</span>",this.container.appendChild(this.el),this.el.appendChild(this.danmakuLoading),this.danmaku=new Lt(this.el,this.player),this.initTemlate(),this.initializeEvent(),"websocket"===this.options.type?this.initWebSocket():this.initHTTP()}initWebSocket(){const t=r()(this.options.api,{transports:["websocket","polling"]});t.on("connect",()=>{this.setDanmakuSuccess(),this.player.video.addEventListener("timeupdate",e=>{t.emit(n.REQUEST_DANMAKU_DATA,{time:this.player.video.currentTime})}),t.on(n.SEND_DANMAKU_DATA,t=>{console.log(`接受到数据${JSON.stringify(t)},当前时间${this.player.video.currentTime}`);for(let e of t)this.danmaku.addData(e)})}),t.io.on("error",()=>{this.setDanmakuFail()}),t.connect()}initHTTP(){this.instance.get(this.options.api,{query:{time:0}}).then(t=>{this.setDanmakuSuccess(),this.player.video.addEventListener("timeupdate",this.onTimeupdate)},t=>{this.setDanmakuFail()})}setDanmakuFail(){this.el.style.backgroundColor="",this.danmakuLoading.childNodes[0].innerText="弹幕加载失败",c(this.danmakuLoading,["video-danmaku-loading","video-danmaku-shaking"]),setTimeout(()=>{p(this.danmakuLoading,["video-danmaku-loading-hide"])},3e3)}setDanmakuSuccess(){this.el.style.backgroundColor="",this.danmakuLoading.childNodes[0].innerText="弹幕加载成功",c(this.danmakuLoading,["video-danmaku-loading","video-danmaku-shaking"]),setTimeout(()=>{p(this.danmakuLoading,["video-danmaku-loading-hide"])},3e3)}initTemlate(){let t=this;this.danmakuInput=new Ot(this.player,null,"div"),this.danmakuSettings=new Ht(this.player),this.danmakuOpenClose=new Dt(this.player,null,"div"),this.player.use({install(e){e.mountComponent(t.danmakuOpenClose.id,t.danmakuOpenClose,{mode:{type:"BottomToolBar",pos:"medium"}}),e.mountComponent(t.danmakuInput.id,t.danmakuInput,{mode:{type:"BottomToolBar",pos:"medium"}})}})}initializeEvent(){this.video.addEventListener("seeked",t=>{this.onSeeking(t)}),this.video.addEventListener("pause",()=>{this.danmaku.pause()}),this.video.addEventListener("waiting",()=>{this.danmaku.pause()}),this.video.addEventListener("abort",()=>{this.danmaku.flush()}),this.video.addEventListener("play",()=>{this.danmaku.resume()}),this.danmakuInput.on("sendData",(function(t){})),this.player.on(n.DOT_DRAG,()=>{this.danmaku.flush()}),this.player.on("closeDanmaku",()=>{this.danmaku.close()}),this.player.on("openDanmaku",()=>{this.danmaku.open()})}onTimeupdate(t){this.instance.get(this.options.api,{query:{time:this.player.video.currentTime}}).then(t=>{console.log(t);for(let e of t)this.danmaku.addData(e)})}onSeeking(t){this.danmaku.flush()}setTrackNumber(t){this.danmaku.setTrackNumber(t)}setOpacity(t){this.danmaku.setOpacity(t)}setFontSize(t){this.danmaku.setFontSize(t)}}Pt(".Niplayer_video-wrapper {\n  width: 100%;\n  height: 100%;\n  background-color: #000;\n  position: relative;\n  overflow: hidden;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  -webkit-transform: all 0.5s ease;\n          transform: all 0.5s ease;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.Niplayer_video-wrapper:focus {\n  outline: none;\n}\n.Niplayer_video-wrapper video {\n  max-width: 100%;\n  max-height: 100%;\n  outline: none;\n  -ms-touch-action: none;\n      touch-action: none;\n  -o-object-fit: cover;\n     object-fit: cover;\n  cursor: pointer;\n}\n.Niplayer_video-wrapper video:focus {\n  outline: none;\n}\n.Niplayer_video-wrapper .video-texttrack-container-showtoolbar {\n  bottom: calc(50px + 5px) !important;\n}\n.Niplayer_video-wrapper .video-texttrack-container {\n  -webkit-transition: all 0.5s;\n  transition: all 0.5s;\n  position: absolute;\n  bottom: 5px;\n  color: #fe9200;\n  font-size: 20px;\n}\n.Niplayer_video-wrapper .video-texttrack-container p {\n  word-break: break-all;\n  height: -webkit-fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  margin: 5px 0 0;\n  line-height: 1.2;\n}\n.Niplayer_video-wrapper .video-toast-wrapper {\n  position: absolute;\n  text-align: center;\n  top: 0;\n  opacity: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  -webkit-transition: all 0.5s ease;\n  transition: all 0.5s ease;\n  border-radius: 10px;\n}\n.Niplayer_video-wrapper .video-toast-animate {\n  opacity: 1;\n}\n.Niplayer_video-wrapper .video-topbar {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 35px;\n  color: #fff;\n  -webkit-transition: all 0.3s ease;\n  transition: all 0.3s ease;\n  z-index: 2001;\n  padding: 5px 5px 0px 5px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n  -webkit-flex-direction: row-reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n  height: 100%;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set {\n  height: auto;\n  max-height: 300px;\n  background-color: #000000e6;\n  -webkit-backdrop-filter: saturate(180%) blur(20px);\n          backdrop-filter: saturate(180%) blur(20px);\n  border-radius: 3px;\n  font-size: 13px;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-main,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-subtitle,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-playrate,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-main,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-opacity,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-range,\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-size {\n  width: 100%;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  height: 35px;\n  cursor: pointer;\n  color: #fffc;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 1;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  overflow: hidden;\n  width: 100%;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item:hover {\n  color: #f00;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft {\n  white-space: nowrap;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon {\n  height: 24px;\n  width: 24px;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  margin-right: 10px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon svg {\n  height: 100%;\n  width: 100%;\n  fill: #fff;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-text {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright {\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-tip {\n  white-space: nowrap;\n  color: #ffffff80;\n  margin-right: 5px;\n  font-size: 12px;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  height: 24px;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon svg {\n  width: 100%;\n  height: 100%;\n  fill: #fff;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings svg {\n  -webkit-transition: -webkit-transform 0.5s ease;\n  transition: -webkit-transform 0.5s ease;\n  transition: transform 0.5s ease;\n  transition: transform 0.5s ease, -webkit-transform 0.5s ease;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings .video-subsettings-set {\n  right: 0;\n  left: auto !important;\n  -webkit-transform: translateX(0) !important;\n          transform: translateX(0) !important;\n}\n.Niplayer_video-wrapper .video-topbar .video-topbar-right .video-subsettings-animate {\n  -webkit-transform: rotate(360deg);\n          transform: rotate(360deg);\n}\n.Niplayer_video-wrapper .video-topbar-hidde {\n  display: none;\n}\n.Niplayer_video-wrapper .video-toolbar {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  color: #fff;\n  height: 50px;\n  -webkit-transition: all 0.3s ease;\n  transition: all 0.3s ease;\n  z-index: 4001;\n  background-image: -webkit-gradient(linear, left bottom, left top, from(#000), color-stop(#0006), to(#0000));\n  background-image: linear-gradient(to top, #000, #0006, #0000);\n  background-position: bottom;\n  background-repeat: repeat-x;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-left,\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-right {\n  height: 100%;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress {\n  width: calc(100% - 18px);\n  margin: 0 auto;\n  height: 3px;\n  -webkit-transition: width 0.5s ease;\n  transition: width 0.5s ease;\n  background-color: hsla(0, 0%, 100%, 0.2);\n  cursor: pointer;\n  position: relative;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress .video-progress-pretime {\n  position: absolute;\n  left: 0;\n  top: -18px;\n  height: 15px;\n  width: 35px;\n  background-color: rgba(0, 0, 0, 0.6);\n  color: #fff;\n  line-height: 15px;\n  text-align: center;\n  font-size: 10px;\n  display: none;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress .video-progress-buffered {\n  left: 0;\n  height: 100%;\n  width: 0;\n  z-index: 1001;\n  position: absolute;\n  background-color: hsla(0, 0%, 100%, 0.3);\n  border-top-right-radius: 3px;\n  border-bottom-right-radius: 3px;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress .video-progress-completed {\n  position: absolute;\n  background-color: #f00;\n  height: 100%;\n  border-top-right-radius: 3px;\n  border-bottom-right-radius: 3px;\n  left: 0;\n  width: 0;\n  z-index: 2002;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress .video-progress-dot-hidden {\n  opacity: 0;\n}\n.Niplayer_video-wrapper .video-toolbar .video-mediumbar .video-mediumbar-medium .video-progress .video-progress-dot {\n  position: absolute;\n  left: 0px;\n  height: 8px;\n  width: 8px;\n  border-radius: 100%;\n  background-color: #f00;\n  cursor: pointer;\n  z-index: 2003;\n  top: 50%;\n  -webkit-transform: translateY(-50%);\n          transform: translateY(-50%);\n  -webkit-transition: opacity 0.6s ease;\n  transition: opacity 0.6s ease;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  padding: 10px 5px 0 5px;\n  position: relative;\n  height: 30px;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 100%;\n  position: relative;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-start-pause {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 100%;\n  margin-right: 5px;\n  cursor: pointer;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  position: relative;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume .video-volume-set {\n  position: absolute;\n  width: 32px;\n  height: 100px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume .video-volume-set .video-volume-show {\n  width: 100%;\n  height: 15px;\n  line-height: 15px;\n  text-align: center;\n  font-size: 12px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume .video-volume-set .video-volume-progress {\n  border-radius: 2px;\n  width: 3px;\n  padding-top: 5px;\n  height: calc(100% - 15px - 5px);\n  margin-left: 50%;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: #fff;\n  position: relative;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n  -webkit-flex-direction: column-reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume .video-volume-set .video-volume-progress .video-volume-completed {\n  height: 50%;\n  background-color: #f00;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-volume .video-volume-set .video-volume-progress .video-volume-dot {\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #f00;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  z-index: 1003;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-duration-time {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  font-size: 12px;\n  opacity: 0.7;\n  margin-left: 5px;\n  height: 100%;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-left .video-duration-time:hover {\n  opacity: 1;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-medium {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-flex: 1;\n  -webkit-flex-grow: 1;\n      -ms-flex-positive: 1;\n          flex-grow: 1;\n  height: 100%;\n  position: relative;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  position: relative;\n  margin-right: 10px;\n  height: 100%;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-controller {\n  margin-left: 5px;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-playrate {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  margin-right: 5px;\n  position: relative;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-playrate .video-playrate-set {\n  width: 70px;\n  padding: 0;\n  margin: 0;\n  text-align: center;\n  list-style: none;\n  outline: none;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-playrate .video-playrate-set li {\n  color: #fff;\n  text-align: center;\n  height: 26px;\n  line-height: 26px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-playrate .video-playrate-set li:hover {\n  background-color: #c9ccd0;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set {\n  height: auto;\n  max-height: 300px;\n  background-color: #000000e6;\n  -webkit-backdrop-filter: saturate(180%) blur(20px);\n          backdrop-filter: saturate(180%) blur(20px);\n  border-radius: 3px;\n  font-size: 13px;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-main,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-subtitle,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-playrate,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-main,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-opacity,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-range,\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-danmaku-size {\n  width: 100%;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  height: 35px;\n  cursor: pointer;\n  color: #fffc;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 1;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  overflow: hidden;\n  width: 100%;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item:hover {\n  color: #f00;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft {\n  white-space: nowrap;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon {\n  height: 24px;\n  width: 24px;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  margin-right: 10px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon svg {\n  height: 100%;\n  width: 100%;\n  fill: #fff;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-text {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright {\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-tip {\n  white-space: nowrap;\n  color: #ffffff80;\n  margin-right: 5px;\n  font-size: 12px;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  height: 24px;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon svg {\n  width: 100%;\n  height: 100%;\n  fill: #fff;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings svg {\n  -webkit-transition: -webkit-transform 0.5s ease;\n  transition: -webkit-transform 0.5s ease;\n  transition: transform 0.5s ease;\n  transition: transform 0.5s ease, -webkit-transform 0.5s ease;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-subsettings-animate {\n  -webkit-transform: rotate(360deg);\n          transform: rotate(360deg);\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-screenshot svg {\n  -webkit-transition: -webkit-transform 0.25s ease;\n  transition: -webkit-transform 0.25s ease;\n  transition: transform 0.25s ease;\n  transition: transform 0.25s ease, -webkit-transform 0.25s ease;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-screenshot-animate {\n  -webkit-transform: scale(0.85);\n          transform: scale(0.85);\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-videoshot svg {\n  -webkit-transition: -webkit-transform 0.3s ease;\n  transition: -webkit-transform 0.3s ease;\n  transition: transform 0.3s ease;\n  transition: transform 0.3s ease, -webkit-transform 0.3s ease;\n}\n.Niplayer_video-wrapper .video-toolbar .video-bottombar .video-bottombar-right .video-videoshot-animate {\n  -webkit-transform: scale(0.75);\n          transform: scale(0.75);\n}\n.Niplayer_video-wrapper .video-toolbar-hidden {\n  -webkit-transform: translateY(47px);\n          transform: translateY(47px);\n}\n.Niplayer_video-wrapper .video-mask {\n  position: absolute;\n  background: transparent;\n  z-index: 0;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n.Niplayer_video-wrapper .video-loading {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  z-index: 1001;\n  background-color: rgba(0, 0, 0, 0.4);\n  left: 0;\n  top: 0;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.Niplayer_video-wrapper .video-loading .video-loading-loadingbox {\n  height: 30px;\n  width: 30px;\n  border: 2px solid #fff;\n  border-top-color: transparent;\n  border-radius: 100%;\n  -webkit-animation: circle infinite 0.75s linear;\n          animation: circle infinite 0.75s linear;\n}\n.Niplayer_video-wrapper .video-loading .video-loading-errorbox {\n  height: 30px;\n  width: 30px;\n  background-color: red;\n}\n.Niplayer_video-wrapper .video-loading .video-loading-msgbox {\n  padding: 0px 5px;\n  color: #fff;\n  font-size: 13px;\n  margin-top: 10px;\n}\n@-webkit-keyframes circle {\n  0% {\n    -webkit-transform: rotate(0);\n            transform: rotate(0);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n@keyframes circle {\n  0% {\n    -webkit-transform: rotate(0);\n            transform: rotate(0);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.video-switch-on {\n  fill: #007aff !important;\n}\n.video-switch-off {\n  fill: #fff !important;\n}\n.Nplayer_controller {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  min-width: 30px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  padding: 4px;\n  height: 100%;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  cursor: pointer;\n  color: #fff;\n  opacity: 0.9;\n  position: relative;\n}\n.Nplayer_controller:hover svg {\n  opacity: 1 !important;\n}\n.Nplayer_controller:hover .video-controller-span {\n  opacity: 1;\n}\n.Nplayer_controller .video-controller-span,\n.Nplayer_controller span {\n  width: 100%;\n  height: 100%;\n  font-weight: 550;\n  color: #fff;\n  padding: 0 5px;\n  font-size: 14px;\n  line-height: 22px;\n  opacity: 0.85;\n}\n.Nplayer_controller .video-icon {\n  height: 100%;\n  width: 100%;\n}\n.Nplayer_controller .video-icon svg {\n  height: 100%;\n  width: 100%;\n  opacity: 0.8;\n}\n.Nplayer_controller .video-icon svg path {\n  fill: #fff;\n}\n.Nplayer_controller .video-set-hidden {\n  display: none!important;\n}\n.Nplayer_subsettings .video-subsettings-set {\n  height: auto;\n  max-height: 300px;\n  background-color: #000000e6;\n  -webkit-backdrop-filter: saturate(180%) blur(20px);\n          backdrop-filter: saturate(180%) blur(20px);\n  border-radius: 3px;\n  font-size: 13px;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-main,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-subtitle,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-playrate,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-danmaku-main,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-danmaku-opacity,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-danmaku-range,\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-danmaku-size {\n  width: 100%;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  height: 35px;\n  cursor: pointer;\n  color: #fffc;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 1;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  overflow: hidden;\n  width: 100%;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item:hover {\n  color: #f00;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft {\n  white-space: nowrap;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon {\n  height: 24px;\n  width: 24px;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  margin-right: 10px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-icon svg {\n  height: 100%;\n  width: 100%;\n  fill: #fff;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemleft .video-subsettings-itemleft-text {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright {\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-tip {\n  white-space: nowrap;\n  color: #ffffff80;\n  margin-right: 5px;\n  font-size: 12px;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon {\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  height: 24px;\n}\n.Nplayer_subsettings .video-subsettings-set .video-subsettings-item .video-subsettings-itemright .video-subsettings-itemright-icon svg {\n  width: 100%;\n  height: 100%;\n  fill: #fff;\n}\n.Nplayer_subsettings svg {\n  -webkit-transition: -webkit-transform 0.5s ease;\n  transition: -webkit-transform 0.5s ease;\n  transition: transform 0.5s ease;\n  transition: transform 0.5s ease, -webkit-transform 0.5s ease;\n}\n.video-controller {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  min-width: 30px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  padding: 4px;\n  height: 100%;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  cursor: pointer;\n  color: #fff;\n  opacity: 0.9;\n  position: relative;\n}\n.video-controller:hover svg {\n  opacity: 1 !important;\n}\n.video-controller:hover .video-controller-span {\n  opacity: 1;\n}\n.video-controller .video-controller-span,\n.video-controller span {\n  width: 100%;\n  height: 100%;\n  font-weight: 550;\n  color: #fff;\n  padding: 0 5px;\n  font-size: 14px;\n  line-height: 22px;\n  opacity: 0.85;\n}\n.video-controller .video-icon {\n  height: 100%;\n  width: 100%;\n}\n.video-controller .video-icon svg {\n  height: 100%;\n  width: 100%;\n  opacity: 0.8;\n}\n.video-controller .video-icon svg path {\n  fill: #fff;\n}\n.video-controller .video-set-hidden {\n  display: none!important;\n}\n.video-controller .video-set {\n  bottom: 48px;\n  position: absolute;\n  background: rgba(21, 21, 21, 0.9);\n  text-align: center;\n  border-radius: 2px;\n  padding: 5px 5px;\n  left: 50%;\n  white-space: nowrap;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  -webkit-animation: slideIn 0.5s ease;\n          animation: slideIn 0.5s ease;\n}\n@-webkit-keyframes slideIn {\n  from {\n    -webkit-transform: translate(-50%, 10px);\n            transform: translate(-50%, 10px);\n  }\n  to {\n    -webkit-transform: translate(-50%, 0);\n            transform: translate(-50%, 0);\n  }\n}\n@keyframes slideIn {\n  from {\n    -webkit-transform: translate(-50%, 10px);\n            transform: translate(-50%, 10px);\n  }\n  to {\n    -webkit-transform: translate(-50%, 0);\n            transform: translate(-50%, 0);\n  }\n}\n.video-topbar-controller {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  min-width: 30px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  padding: 4px;\n  height: 100%;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  cursor: pointer;\n  color: #fff;\n  opacity: 0.9;\n  position: relative;\n}\n.video-topbar-controller:hover svg {\n  opacity: 1 !important;\n}\n.video-topbar-controller:hover .video-controller-span {\n  opacity: 1;\n}\n.video-topbar-controller .video-controller-span,\n.video-topbar-controller span {\n  width: 100%;\n  height: 100%;\n  font-weight: 550;\n  color: #fff;\n  padding: 0 5px;\n  font-size: 14px;\n  line-height: 22px;\n  opacity: 0.85;\n}\n.video-topbar-controller .video-icon {\n  height: 100%;\n  width: 100%;\n}\n.video-topbar-controller .video-icon svg {\n  height: 100%;\n  width: 100%;\n  opacity: 0.8;\n}\n.video-topbar-controller .video-icon svg path {\n  fill: #fff;\n}\n.video-topbar-controller .video-set-hidden {\n  display: none!important;\n}\n.video-topbar-controller .video-set {\n  top: 32px;\n  position: absolute;\n  background: rgba(21, 21, 21, 0.9);\n  text-align: center;\n  border-radius: 2px;\n  padding: 5px 5px;\n  left: 50%;\n  white-space: nowrap;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  -webkit-animation: slideIn 0.5s ease;\n          animation: slideIn 0.5s ease;\n}\n.flex-vertical-center {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.flex-vertical-horizontal-center {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.flex-horizontal-center {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.toast-icon {\n  width: 24px;\n  height: 24px;\n  fill: #fff;\n  margin-right: 10px;\n}\n.toast-content {\n  text-align: center;\n  color: #fff;\n  font-size: 14px;\n  border-radius: 5px;\n  padding: 10px 20px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.toast-content svg {\n  width: 24px;\n  height: 24px;\n  fill: #fff;\n  margin-right: 10px;\n}\n.video-wrapper-fullpage {\n  position: fixed !important;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: 2001;\n}\n.fullscreen-mask {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100vw;\n  height: 100vh;\n  background: #000;\n  z-index: 2001;\n}\n.video-cross-screen {\n  position: fixed;\n  top: -375px;\n  left: 50%;\n  background: #000;\n  -webkit-transform-origin: 0;\n          transform-origin: 0;\n  -webkit-transform: rotate(90deg) translate3d(0, 0, 0);\n          transform: rotate(90deg) translate3d(0, 0, 0);\n}\n.video-screenshot-toast {\n  text-align: center;\n  color: #fff;\n  font-size: 14px;\n  border-radius: 5px;\n  padding: 10px 20px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.video-screenshot-toast svg {\n  width: 24px;\n  height: 24px;\n  fill: #fff;\n  margin-right: 10px;\n}\n.video-videoshot-inprogress-toast,\n.video-videoshot-success-toast {\n  text-align: center;\n  color: #fff;\n  font-size: 14px;\n  border-radius: 5px;\n  padding: 10px 20px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.video-videoshot-inprogress-toast svg,\n.video-videoshot-success-toast svg {\n  width: 24px;\n  height: 24px;\n  fill: #fff;\n  margin-right: 10px;\n}\n.video-videoshot-inprogress-toast svg {\n  -webkit-animation: countdown 0.5s ease infinite;\n          animation: countdown 0.5s ease infinite;\n}\n@-webkit-keyframes countdown {\n  0% {\n    -webkit-transform: rotate(0);\n            transform: rotate(0);\n  }\n  50% {\n    -webkit-transform: rotate(180deg);\n            transform: rotate(180deg);\n  }\n  100% {\n    -webkit-transform: rotate(180deg);\n            transform: rotate(180deg);\n  }\n}\n@keyframes countdown {\n  0% {\n    -webkit-transform: rotate(0);\n            transform: rotate(0);\n  }\n  50% {\n    -webkit-transform: rotate(180deg);\n            transform: rotate(180deg);\n  }\n  100% {\n    -webkit-transform: rotate(180deg);\n            transform: rotate(180deg);\n  }\n}\n");var Vt={};!function(t){var e,i,n=(e=new Date,i=4,{setLogLevel:function(t){i=t==this.debug?1:t==this.info?2:t==this.warn?3:(this.error,4)},debug:function(t,s){void 0===console.debug&&(console.debug=console.log),1>=i&&console.debug("["+n.getDurationString(new Date-e,1e3)+"]","["+t+"]",s)},log:function(t,e){this.debug(t.msg)},info:function(t,s){2>=i&&console.info("["+n.getDurationString(new Date-e,1e3)+"]","["+t+"]",s)},warn:function(t,s){3>=i&&console.warn("["+n.getDurationString(new Date-e,1e3)+"]","["+t+"]",s)},error:function(t,s){4>=i&&console.error("["+n.getDurationString(new Date-e,1e3)+"]","["+t+"]",s)}});n.getDurationString=function(t,e){var i;function n(t,e){for(var i=(""+t).split(".");i[0].length<e;)i[0]="0"+i[0];return i.join(".")}t<0?(i=!0,t=-t):i=!1;var s=t/(e||1),r=Math.floor(s/3600);s-=3600*r;var o=Math.floor(s/60),a=1e3*(s-=60*o);return a-=1e3*(s=Math.floor(s)),a=Math.floor(a),(i?"-":"")+r+":"+n(o,2)+":"+n(s,2)+"."+n(a,3)},n.printRanges=function(t){var e=t.length;if(e>0){for(var i="",s=0;s<e;s++)s>0&&(i+=","),i+="["+n.getDurationString(t.start(s))+","+n.getDurationString(t.end(s))+"]";return i}return"(empty)"},t.Log=n;var s=function(t){if(!(t instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=t,this.dataview=new DataView(t),this.position=0};s.prototype.getPosition=function(){return this.position},s.prototype.getEndPosition=function(){return this.buffer.byteLength},s.prototype.getLength=function(){return this.buffer.byteLength},s.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},s.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},s.prototype.readAnyInt=function(t,e){var i=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:i=e?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:i=e?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";i=this.dataview.getUint8(this.position)<<16,i|=this.dataview.getUint8(this.position+1)<<8,i|=this.dataview.getUint8(this.position+2);break;case 4:i=e?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";i=this.dataview.getUint32(this.position)<<32,i|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,i}throw"Not enough bytes in buffer"},s.prototype.readUint8=function(){return this.readAnyInt(1,!1)},s.prototype.readUint16=function(){return this.readAnyInt(2,!1)},s.prototype.readUint24=function(){return this.readAnyInt(3,!1)},s.prototype.readUint32=function(){return this.readAnyInt(4,!1)},s.prototype.readUint64=function(){return this.readAnyInt(8,!1)},s.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readUint8());return e}throw"Not enough bytes in buffer"},s.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(0===e)break;t.push(e)}return String.fromCharCode.apply(null,t)},s.prototype.readInt8=function(){return this.readAnyInt(1,!0)},s.prototype.readInt16=function(){return this.readAnyInt(2,!0)},s.prototype.readInt32=function(){return this.readAnyInt(4,!0)},s.prototype.readInt64=function(){return this.readAnyInt(8,!1)},s.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readUint8();return e},s.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readInt16();return e},s.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readUint16();return e},s.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUint32();return e},s.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=this.readInt32();return e},t.MP4BoxStream=s;var r=function(t,e,i){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:"object"==typeof t?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==i?r.LITTLE_ENDIAN:i};r.prototype={},r.prototype.getPosition=function(){return this.position},r.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i)e>this._byteLength&&(this._byteLength=e);else{for(i<1&&(i=1);e>i;)i*=2;var n=new ArrayBuffer(i),s=new Uint8Array(this._buffer);new Uint8Array(n,0,s.length).set(s),this.buffer=n,this._byteLength=e}}},r.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length);e.set(i),this.buffer=t}},r.BIG_ENDIAN=!1,r.LITTLE_ENDIAN=!0,r.prototype._byteLength=0,Object.defineProperty(r.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(r.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(r.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(r.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),r.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},r.prototype.isEof=function(){return this.position>=this._byteLength},r.prototype.mapUint8Array=function(t){this._realloc(1*t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},r.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Int32Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Int16Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return r.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},r.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Uint32Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Uint16Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return r.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},r.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var i=new Float64Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Float32Array(t);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},r.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,e},r.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,e},r.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},r.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,e},r.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,e},r.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},r.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,e},r.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,e},r.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,r.memcpy=function(t,e,i,n,s){var r=new Uint8Array(t,e,s),o=new Uint8Array(i,n,s);r.set(o)},r.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},r.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},r.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var n=i+t.BYTES_PER_ELEMENT-1,s=i;n>s;n--,s++){var r=e[s];e[s]=e[n],e[n]=r}return t},r.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)},r.prototype.readString=function(t,e){return null==e||"ASCII"==e?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==t?this.byteLength-this.position:t)]):new TextDecoder(e).decode(this.mapUint8Array(t))},r.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),n=e;null!=t&&(n=Math.min(t,e));for(var s=0;s<n&&0!==i[s];s++);var r=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(s)]);return null!=t?this.position+=n-s:s!=e&&(this.position+=1),r};var o=Math.pow(2,32);r.prototype.readInt64=function(){return this.readInt32()*o+this.readUint32()},r.prototype.readUint64=function(){return this.readUint32()*o+this.readUint32()},r.prototype.readInt64=function(){return this.readUint32()*o+this.readUint32()},r.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},t.DataStream=r,r.prototype.save=function(t){var e=new Blob([this.buffer]);if(!window.URL||!URL.createObjectURL)throw"DataStream.save: Can't create object URL.";var i=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("href",i),n.setAttribute("download",t),n.setAttribute("target","_self"),n.click(),window.URL.revokeObjectURL(i)},r.prototype._dynamicSize=!0,Object.defineProperty(r.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),r.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),i=new Uint8Array(e),n=new Uint8Array(this._buffer,t,i.length);i.set(n),this.buffer=e,this.position-=t},r.prototype.writeInt32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)},r.prototype.writeInt16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)},r.prototype.writeInt8Array=function(t){if(this._realloc(1*t.length),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},r.prototype.writeUint32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)},r.prototype.writeUint16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)},r.prototype.writeUint8Array=function(t){if(this._realloc(1*t.length),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},r.prototype.writeFloat64Array=function(t,e){if(this._realloc(8*t.length),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)},r.prototype.writeFloat32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)},r.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,null==e?this.endianness:e),this.position+=4},r.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,null==e?this.endianness:e),this.position+=2},r.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},r.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,null==e?this.endianness:e),this.position+=4},r.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,null==e?this.endianness:e),this.position+=2},r.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},r.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,null==e?this.endianness:e),this.position+=4},r.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,null==e?this.endianness:e),this.position+=8},r.prototype.writeUCS2String=function(t,e,i){null==i&&(i=t.length);for(var n=0;n<t.length&&n<i;n++)this.writeUint16(t.charCodeAt(n),e);for(;n<i;n++)this.writeUint16(0)},r.prototype.writeString=function(t,e,i){var n=0;if(null==e||"ASCII"==e)if(null!=i){var s=Math.min(t.length,i);for(n=0;n<s;n++)this.writeUint8(t.charCodeAt(n));for(;n<i;n++)this.writeUint8(0)}else for(n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,i)))},r.prototype.writeCString=function(t,e){var i=0;if(null!=e){var n=Math.min(t.length,e);for(i=0;i<n;i++)this.writeUint8(t.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else{for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));this.writeUint8(0)}},r.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var n=t[i+1];this.writeType(n,e[t[i]],e)}},r.prototype.writeType=function(t,e,i){var n;if("function"==typeof t)return t(this,e);if("object"==typeof t&&!(t instanceof Array))return t.set(this,e,i);var s=null,o="ASCII",a=this.position;switch("string"==typeof t&&/:/.test(t)&&(n=t.split(":"),t=n[0],s=parseInt(n[1])),"string"==typeof t&&/,/.test(t)&&(n=t.split(","),t=n[0],o=parseInt(n[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,r.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,r.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,r.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,r.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,r.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,r.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,r.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,r.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,r.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,r.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,r.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,r.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,s);break;case"string":this.writeString(e,o,s);break;case"u16string":this.writeUCS2String(e,this.endianness,s);break;case"u16stringle":this.writeUCS2String(e,r.LITTLE_ENDIAN,s);break;case"u16stringbe":this.writeUCS2String(e,r.BIG_ENDIAN,s);break;default:if(3==t.length){for(var h=t[1],l=0;l<e.length;l++)this.writeType(h,e[l]);break}this.writeStruct(t,e)}null!=s&&(this.position=a,this._realloc(s),this.position=a+s)},r.prototype.writeUint64=function(t){var e=Math.floor(t/o);this.writeUint32(e),this.writeUint32(4294967295&t)},r.prototype.writeUint24=function(t){this.writeUint8((16711680&t)>>16),this.writeUint8((65280&t)>>8),this.writeUint8(255&t)},r.prototype.adjustUint32=function(t,e){var i=this.position;this.seek(t),this.writeUint32(e),this.seek(i)},r.prototype.mapInt32Array=function(t,e){this._realloc(4*t);var i=new Int32Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},r.prototype.mapInt16Array=function(t,e){this._realloc(2*t);var i=new Int16Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},r.prototype.mapInt8Array=function(t){this._realloc(1*t);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},r.prototype.mapUint32Array=function(t,e){this._realloc(4*t);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},r.prototype.mapUint16Array=function(t,e){this._realloc(2*t);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},r.prototype.mapFloat64Array=function(t,e){this._realloc(8*t);var i=new Float64Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=8*t,i},r.prototype.mapFloat32Array=function(t,e){this._realloc(4*t);var i=new Float32Array(this._buffer,this.byteOffset+this.position,t);return r.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i};var a=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};(a.prototype=new r(new ArrayBuffer,0,r.BIG_ENDIAN)).initialized=function(){var t;return this.bufferIndex>-1||(this.buffers.length>0?0===(t=this.buffers[0]).fileStart?(this.buffer=t,this.bufferIndex=0,n.debug("MultiBufferStream","Stream ready for parsing"),!0):(n.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1):(n.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(t,e){n.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer},a.prototype.reduceBuffer=function(t,e,i){var n;return(n=new Uint8Array(i)).set(new Uint8Array(t,e,i)),n.buffer.fileStart=t.fileStart+e,n.buffer.usedBytes=0,n.buffer},a.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var s=this.buffers[i];if(t.fileStart<=s.fileStart){if(t.fileStart===s.fileStart){if(t.byteLength>s.byteLength){this.buffers.splice(i,1),i--;continue}n.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=s.fileStart||(t=this.reduceBuffer(t,0,s.fileStart-t.fileStart)),n.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),0===i&&(this.buffer=t);e=!1;break}if(t.fileStart<s.fileStart+s.byteLength){var r=s.fileStart+s.byteLength-t.fileStart,o=t.byteLength-r;if(!(o>0)){e=!1;break}t=this.reduceBuffer(t,r,o)}}e&&(n.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),0===i&&(this.buffer=t))},a.prototype.logBufferLevel=function(t){var e,i,s,r,o,a=[],h="";for(s=0,r=0,e=0;e<this.buffers.length;e++)i=this.buffers[e],0===e?(o={},a.push(o),o.start=i.fileStart,o.end=i.fileStart+i.byteLength,h+="["+o.start+"-"):o.end===i.fileStart?o.end=i.fileStart+i.byteLength:((o={}).start=i.fileStart,h+=a[a.length-1].end-1+"], ["+o.start+"-",o.end=i.fileStart+i.byteLength,a.push(o)),s+=i.usedBytes,r+=i.byteLength;a.length>0&&(h+=o.end-1+"]");var l=t?n.info:n.debug;0===this.buffers.length?l("MultiBufferStream","No more buffer in memory"):l("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+s+"/"+r+" bytes), continuous ranges: "+h)},a.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)(e=this.buffers[t]).usedBytes===e.byteLength&&(n.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},a.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length){if((t=this.buffers[this.bufferIndex+1]).fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,i=this.buffer.usedBytes,s=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=i,this.buffer.fileStart=s,n.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}return!1}return!1},a.prototype.findPosition=function(t,e,i){var s,r=null,o=-1;for(s=!0===t?0:this.bufferIndex;s<this.buffers.length&&(r=this.buffers[s]).fileStart<=e;)o=s,i&&(r.fileStart+r.byteLength<=e?r.usedBytes=r.byteLength:r.usedBytes=e-r.fileStart,this.logBufferLevel()),s++;return-1!==o&&(r=this.buffers[o]).fileStart+r.byteLength>=e?(n.debug("MultiBufferStream","Found position in existing buffer #"+o),o):-1},a.prototype.findEndContiguousBuf=function(t){var e,i,n,s=void 0!==t?t:this.bufferIndex;if(i=this.buffers[s],this.buffers.length>s+1)for(e=s+1;e<this.buffers.length&&(n=this.buffers[e]).fileStart===i.fileStart+i.byteLength;e++)i=n;return i.fileStart+i.byteLength},a.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return-1!==e?this.findEndContiguousBuf(e):t},a.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},a.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},a.prototype.seek=function(t,e,i){var s;return-1!==(s=this.findPosition(e,t,i))?(this.buffer=this.buffers[s],this.bufferIndex=s,this.position=t-this.buffer.fileStart,n.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(n.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},a.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},a.prototype.getLength=function(){return this.byteLength},a.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},t.MultiBufferStream=a;var h=function(){var t=[];t[3]="ES_Descriptor",t[4]="DecoderConfigDescriptor",t[5]="DecoderSpecificInfo",t[6]="SLConfigDescriptor",this.getDescriptorName=function(e){return t[e]};var e=this,i={};return this.parseOneDescriptor=function(e){var s,r,o,a=0;for(s=e.readUint8(),o=e.readUint8();128&o;)a=(127&o)<<7,o=e.readUint8();return a+=127&o,n.debug("MPEG4DescriptorParser","Found "+(t[s]||"Descriptor "+s)+", size "+a+" at position "+e.getPosition()),(r=t[s]?new i[t[s]](a):new i.Descriptor(a)).parse(e),r},i.Descriptor=function(t,e){this.tag=t,this.size=e,this.descs=[]},i.Descriptor.prototype.parse=function(t){this.data=t.readUint8Array(this.size)},i.Descriptor.prototype.findDescriptor=function(t){for(var e=0;e<this.descs.length;e++)if(this.descs[e].tag==t)return this.descs[e];return null},i.Descriptor.prototype.parseRemainingDescriptors=function(t){for(var i=t.position;t.position<i+this.size;){var n=e.parseOneDescriptor(t);this.descs.push(n)}},i.ES_Descriptor=function(t){i.Descriptor.call(this,3,t)},i.ES_Descriptor.prototype=new i.Descriptor,i.ES_Descriptor.prototype.parse=function(t){if(this.ES_ID=t.readUint16(),this.flags=t.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=t.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var e=t.readUint8();this.URL=t.readString(e),this.size-=e+1}else this.URL="";32&this.flags?(this.OCR_ES_ID=t.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(t)},i.ES_Descriptor.prototype.getOTI=function(t){var e=this.findDescriptor(4);return e?e.oti:0},i.ES_Descriptor.prototype.getAudioConfig=function(t){var e=this.findDescriptor(4);if(!e)return null;var i=e.findDescriptor(5);if(i&&i.data){var n=(248&i.data[0])>>3;return 31===n&&i.data.length>=2&&(n=32+((7&i.data[0])<<3)+((224&i.data[1])>>5)),n}return null},i.DecoderConfigDescriptor=function(t){i.Descriptor.call(this,4,t)},i.DecoderConfigDescriptor.prototype=new i.Descriptor,i.DecoderConfigDescriptor.prototype.parse=function(t){this.oti=t.readUint8(),this.streamType=t.readUint8(),this.bufferSize=t.readUint24(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32(),this.size-=13,this.parseRemainingDescriptors(t)},i.DecoderSpecificInfo=function(t){i.Descriptor.call(this,5,t)},i.DecoderSpecificInfo.prototype=new i.Descriptor,i.SLConfigDescriptor=function(t){i.Descriptor.call(this,6,t)},i.SLConfigDescriptor.prototype=new i.Descriptor,this};t.MPEG4DescriptorParser=h;var l={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){l.FullBox.prototype=new l.Box,l.ContainerBox.prototype=new l.Box,l.SampleEntry.prototype=new l.Box,l.TrackGroupTypeBox.prototype=new l.FullBox,l.BASIC_BOXES.forEach((function(t){l.createBoxCtor(t)})),l.FULL_BOXES.forEach((function(t){l.createFullBoxCtor(t)})),l.CONTAINER_BOXES.forEach((function(t){l.createContainerBoxCtor(t[0],null,t[1])}))},Box:function(t,e,i){this.type=t,this.size=e,this.uuid=i},FullBox:function(t,e,i){l.Box.call(this,t,e,i),this.flags=0,this.version=0},ContainerBox:function(t,e,i){l.Box.call(this,t,e,i),this.boxes=[]},SampleEntry:function(t,e,i,n){l.ContainerBox.call(this,t,e),this.hdr_size=i,this.start=n},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){l.FullBox.call(this,t,e)},createBoxCtor:function(t,e){l.boxCodes.push(t),l[t+"Box"]=function(e){l.Box.call(this,t,e)},l[t+"Box"].prototype=new l.Box,e&&(l[t+"Box"].prototype.parse=e)},createFullBoxCtor:function(t,e){l[t+"Box"]=function(e){l.FullBox.call(this,t,e)},l[t+"Box"].prototype=new l.FullBox,l[t+"Box"].prototype.parse=function(t){this.parseFullHeader(t),e&&e.call(this,t)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,i=0;i<e;i++)this[t[i]+"s"]=[]}},createContainerBoxCtor:function(t,e,i){l[t+"Box"]=function(e){l.ContainerBox.call(this,t,e),l.addSubBoxArrays.call(this,i)},l[t+"Box"].prototype=new l.ContainerBox,e&&(l[t+"Box"].prototype.parse=e)},createMediaSampleEntryCtor:function(t,e,i){l.sampleEntryCodes[t]=[],l[t+"SampleEntry"]=function(t,e){l.SampleEntry.call(this,t,e),l.addSubBoxArrays.call(this,i)},l[t+"SampleEntry"].prototype=new l.SampleEntry,e&&(l[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,i,n){l.sampleEntryCodes[t].push(e),l[e+"SampleEntry"]=function(i){l[t+"SampleEntry"].call(this,e,i),l.addSubBoxArrays.call(this,n)},l[e+"SampleEntry"].prototype=new l[t+"SampleEntry"],i&&(l[e+"SampleEntry"].prototype.parse=i)},createEncryptedSampleEntryCtor:function(t,e,i){l.createSampleEntryCtor.call(this,t,e,i,["sinf"])},createSampleGroupCtor:function(t,e){l[t+"SampleGroupEntry"]=function(e){l.SampleGroupEntry.call(this,t,e)},l[t+"SampleGroupEntry"].prototype=new l.SampleGroupEntry,e&&(l[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){l[t+"TrackGroupTypeBox"]=function(e){l.TrackGroupTypeBox.call(this,t,e)},l[t+"TrackGroupTypeBox"].prototype=new l.TrackGroupTypeBox,e&&(l[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,i,n){l.UUIDs.push(t),l.UUIDBoxes[t]=function(n){e?l.FullBox.call(this,"uuid",n,t):i?l.ContainerBox.call(this,"uuid",n,t):l.Box.call(this,"uuid",n,t)},l.UUIDBoxes[t].prototype=e?new l.FullBox:i?new l.ContainerBox:new l.Box,n&&(l.UUIDBoxes[t].prototype.parse=e?function(t){this.parseFullHeader(t),n&&n.call(this,t)}:n)}};l.initialize(),l.TKHD_FLAG_ENABLED=1,l.TKHD_FLAG_IN_MOVIE=2,l.TKHD_FLAG_IN_PREVIEW=4,l.TFHD_FLAG_BASE_DATA_OFFSET=1,l.TFHD_FLAG_SAMPLE_DESC=2,l.TFHD_FLAG_SAMPLE_DUR=8,l.TFHD_FLAG_SAMPLE_SIZE=16,l.TFHD_FLAG_SAMPLE_FLAGS=32,l.TFHD_FLAG_DUR_EMPTY=65536,l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,l.TRUN_FLAGS_DATA_OFFSET=1,l.TRUN_FLAGS_FIRST_FLAG=4,l.TRUN_FLAGS_DURATION=256,l.TRUN_FLAGS_SIZE=512,l.TRUN_FLAGS_FLAGS=1024,l.TRUN_FLAGS_CTS_OFFSET=2048,l.Box.prototype.add=function(t){return this.addBox(new l[t+"Box"])},l.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},l.Box.prototype.set=function(t,e){return this[t]=e,this},l.Box.prototype.addEntry=function(t,e){var i=e||"entries";return this[i]||(this[i]=[]),this[i].push(t),this},t.BoxParser=l,l.parseUUID=function(t){return l.parseHex16(t)},l.parseHex16=function(t){for(var e="",i=0;i<16;i++){var n=t.readUint8().toString(16);e+=1===n.length?"0"+n:n}return e},l.parseOneBox=function(t,e,i){var s,r,o,a=t.getPosition(),h=0;if(t.getEndPosition()-a<8)return n.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:l.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return n.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:l.ERR_NOT_ENOUGH_DATA};var d=t.readUint32(),p=t.readString(4),c=p;if(n.debug("BoxParser","Found box of type '"+p+"' and size "+d+" at position "+a),h=8,"uuid"==p){if(t.getEndPosition()-t.getPosition()<16||i-h<16)return t.seek(a),n.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:l.ERR_NOT_ENOUGH_DATA};h+=16,c=o=l.parseUUID(t)}if(1==d){if(t.getEndPosition()-t.getPosition()<8||i&&i-h<8)return t.seek(a),n.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+p+'" box'),{code:l.ERR_NOT_ENOUGH_DATA};d=t.readUint64(),h+=8}else if(0===d)if(i)d=i;else if("mdat"!==p)return n.error("BoxParser","Unlimited box size not supported for type: '"+p+"'"),s=new l.Box(p,d),{code:l.OK,box:s,size:s.size};return 0!==d&&d<h?(n.error("BoxParser","Box of type "+p+" has an invalid size "+d+" (too small to be a box)"),{code:l.ERR_NOT_ENOUGH_DATA,type:p,size:d,hdr_size:h,start:a}):0!==d&&i&&d>i?(n.error("BoxParser","Box of type '"+p+"' has a size "+d+" greater than its container size "+i),{code:l.ERR_NOT_ENOUGH_DATA,type:p,size:d,hdr_size:h,start:a}):0!==d&&a+d>t.getEndPosition()?(t.seek(a),n.info("BoxParser","Not enough data in stream to parse the entire '"+p+"' box"),{code:l.ERR_NOT_ENOUGH_DATA,type:p,size:d,hdr_size:h,start:a}):e?{code:l.OK,type:p,size:d,hdr_size:h,start:a}:(l[p+"Box"]?s=new l[p+"Box"](d):"uuid"!==p?(n.warn("BoxParser","Unknown box type: '"+p+"'"),(s=new l.Box(p,d)).has_unparsed_data=!0):l.UUIDBoxes[o]?s=new l.UUIDBoxes[o](d):(n.warn("BoxParser","Unknown uuid type: '"+o+"'"),(s=new l.Box(p,d)).uuid=o,s.has_unparsed_data=!0),s.hdr_size=h,s.start=a,s.write===l.Box.prototype.write&&"mdat"!==s.type&&(n.info("BoxParser","'"+c+"' box writing not yet implemented, keeping unparsed data in memory for later write"),s.parseDataAndRewind(t)),s.parse(t),(r=t.getPosition()-(s.start+s.size))<0?(n.warn("BoxParser","Parsing of box '"+c+"' did not read the entire indicated box data size (missing "+-r+" bytes), seeking forward"),t.seek(s.start+s.size)):r>0&&(n.error("BoxParser","Parsing of box '"+c+"' read "+r+" more bytes than the indicated box data size, seeking backwards"),0!==s.size&&t.seek(s.start+s.size)),{code:l.OK,box:s,size:s.size})},l.Box.prototype.parse=function(t){"mdat"!=this.type?this.data=t.readUint8Array(this.size-this.hdr_size):0===this.size?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},l.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},l.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},l.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},l.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},l.ContainerBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;){if((e=l.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==l.OK)return;if(i=e.box,this.boxes.push(i),this.subBoxNames&&-1!=this.subBoxNames.indexOf(i.type))this[this.subBoxNames[this.subBoxNames.indexOf(i.type)]+"s"].push(i);else{var s="uuid"!==i.type?i.type:i.uuid;this[s]?n.warn("Box of type "+s+" already stored in field of this type"):this[s]=i}}},l.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=31&this.language,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},l.SAMPLE_ENTRY_TYPE_VISUAL="Visual",l.SAMPLE_ENTRY_TYPE_AUDIO="Audio",l.SAMPLE_ENTRY_TYPE_HINT="Hint",l.SAMPLE_ENTRY_TYPE_METADATA="Metadata",l.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",l.SAMPLE_ENTRY_TYPE_SYSTEM="System",l.SAMPLE_ENTRY_TYPE_TEXT="Text",l.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},l.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},l.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},l.SampleEntry.prototype.parseFooter=function(t){l.ContainerBox.prototype.parse.call(this,t)},l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_HINT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,(function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)})),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,(function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT,"enct"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"encm"),l.createBoxCtor("a1lx",(function(t){var e=16*(1+(1&(1&t.readUint8())));this.layer_size=[];for(var i=0;i<3;i++)this.layer_size[i]=16==e?t.readUint16():t.readUint32()})),l.createBoxCtor("a1op",(function(t){this.op_index=t.readUint8()})),l.createFullBoxCtor("auxC",(function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)})),l.createBoxCtor("av1C",(function(t){var e=t.readUint8();if(e>>7&!1)n.error("av1C marker problem");else if(this.version=127&e,1===this.version)if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=31&e,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=3&e,e=t.readUint8(),this.reserved_1=e>>5&7,0===this.reserved_1){if(this.initial_presentation_delay_present=e>>4&1,1===this.initial_presentation_delay_present)this.initial_presentation_delay_minus_one=15&e;else if(this.reserved_2=15&e,0!==this.reserved_2)return void n.error("av1C reserved_2 parsing problem");var i=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(i)}else n.error("av1C reserved_1 parsing problem");else n.error("av1C version "+this.version+" not supported")})),l.createBoxCtor("avcC",(function(t){var e,i;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=3&t.readUint8(),this.nb_SPS_nalus=31&t.readUint8(),i=this.size-this.hdr_size-6,this.SPS=[],e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),i-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),i--,this.PPS=[],e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),i-=2+this.PPS[e].length;i>0&&(this.ext=t.readUint8Array(i))})),l.createBoxCtor("btrt",(function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()})),l.createBoxCtor("clap",(function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()})),l.createBoxCtor("clli",(function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()})),l.createFullBoxCtor("co64",(function(t){var e,i;if(e=t.readUint32(),this.chunk_offsets=[],0===this.version)for(i=0;i<e;i++)this.chunk_offsets.push(t.readUint64())})),l.createFullBoxCtor("CoLL",(function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()})),l.createBoxCtor("colr",(function(t){if(this.colour_type=t.readString(4),"nclx"===this.colour_type){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else("rICC"===this.colour_type||"prof"===this.colour_type)&&(this.ICC_profile=t.readUint8Array(this.size-4))})),l.createFullBoxCtor("cprt",(function(t){this.parseLanguage(t),this.notice=t.readCString()})),l.createFullBoxCtor("cslg",(function(t){0===this.version&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())})),l.createFullBoxCtor("ctts",(function(t){var e,i;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],0===this.version)for(i=0;i<e;i++){this.sample_counts.push(t.readUint32());var s=t.readInt32();s<0&&n.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(s)}else if(1==this.version)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())})),l.createBoxCtor("dac3",(function(t){var e=t.readUint8(),i=t.readUint8(),n=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(1&e)<<2|i>>6&3,this.acmod=i>>3&7,this.lfeon=i>>2&1,this.bit_rate_code=3&i|n>>5&7})),l.createBoxCtor("dec3",(function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=7&e,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var n={};this.ind_subs.push(n);var s=t.readUint8(),r=t.readUint8(),o=t.readUint8();n.fscod=s>>6,n.bsid=s>>1&31,n.bsmod=(1&s)<<4|r>>4&15,n.acmod=r>>1&7,n.lfeon=1&r,n.num_dep_sub=o>>1&15,n.num_dep_sub>0&&(n.chan_loc=(1&o)<<8|t.readUint8())}})),l.createFullBoxCtor("dfLa",(function(t){var e=[],i=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];for(this.parseFullHeader(t);;){var n=t.readUint8(),s=Math.min(127&n,i.length-1);if(s?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),e.push(i[s]),128&n)break}this.numMetadataBlocks=e.length+" ("+e.join(", ")+")"})),l.createBoxCtor("dimm",(function(t){this.bytessent=t.readUint64()})),l.createBoxCtor("dmax",(function(t){this.time=t.readUint32()})),l.createBoxCtor("dmed",(function(t){this.bytessent=t.readUint64()})),l.createBoxCtor("dOps",(function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),0!==this.ChannelMappingFamily){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var e=0;e<this.OutputChannelCount;e++)this.ChannelMapping[e]=t.readUint8()}})),l.createFullBoxCtor("dref",(function(t){var e,i;this.entries=[];for(var n=t.readUint32(),s=0;s<n;s++){if((e=l.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==l.OK)return;i=e.box,this.entries.push(i)}})),l.createBoxCtor("drep",(function(t){this.bytessent=t.readUint64()})),l.createFullBoxCtor("elng",(function(t){this.extended_language=t.readString(this.size-this.hdr_size)})),l.createFullBoxCtor("elst",(function(t){this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var n={};this.entries.push(n),1===this.version?(n.segment_duration=t.readUint64(),n.media_time=t.readInt64()):(n.segment_duration=t.readUint32(),n.media_time=t.readInt32()),n.media_rate_integer=t.readInt16(),n.media_rate_fraction=t.readInt16()}})),l.createFullBoxCtor("emsg",(function(t){1==this.version?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));1==this.version&&(e-=4),this.message_data=t.readUint8Array(e)})),l.createFullBoxCtor("esds",(function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(void 0!==h){var i=new h;this.esd=i.parseOneDescriptor(new r(e.buffer,0,r.BIG_ENDIAN))}})),l.createBoxCtor("fiel",(function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()})),l.createBoxCtor("frma",(function(t){this.data_format=t.readString(4)})),l.createBoxCtor("ftyp",(function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;e>=4;)this.compatible_brands[i]=t.readString(4),e-=4,i++})),l.createFullBoxCtor("hdlr",(function(t){0===this.version&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1)))})),l.createBoxCtor("hvcC",(function(t){var e,i,n,s;this.configurationVersion=t.readUint8(),s=t.readUint8(),this.general_profile_space=s>>6,this.general_tier_flag=(32&s)>>5,this.general_profile_idc=31&s,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=4095&t.readUint16(),this.parallelismType=3&t.readUint8(),this.chroma_format_idc=3&t.readUint8(),this.bit_depth_luma_minus8=7&t.readUint8(),this.bit_depth_chroma_minus8=7&t.readUint8(),this.avgFrameRate=t.readUint16(),s=t.readUint8(),this.constantFrameRate=s>>6,this.numTemporalLayers=(13&s)>>3,this.temporalIdNested=(4&s)>>2,this.lengthSizeMinusOne=3&s,this.nalu_arrays=[];var r=t.readUint8();for(e=0;e<r;e++){var o=[];this.nalu_arrays.push(o),s=t.readUint8(),o.completeness=(128&s)>>7,o.nalu_type=63&s;var a=t.readUint16();for(i=0;i<a;i++){var h={};o.push(h),n=t.readUint16(),h.data=t.readUint8Array(n)}}})),l.createFullBoxCtor("iinf",(function(t){var e;0===this.version?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++){if((e=l.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==l.OK)return;"infe"!==e.box.type&&n.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[i]=e.box}})),l.createFullBoxCtor("iloc",(function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=15&e,e=t.readUint8(),this.base_offset_size=e>>4&15,1===this.version||2===this.version?this.index_size=15&e:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";i=t.readUint32()}for(var n=0;n<i;n++){var s={};if(this.items.push(s),this.version<2)s.item_ID=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";s.item_ID=t.readUint16()}switch(1===this.version||2===this.version?s.construction_method=15&t.readUint16():s.construction_method=0,s.data_reference_index=t.readUint16(),this.base_offset_size){case 0:s.base_offset=0;break;case 4:s.base_offset=t.readUint32();break;case 8:s.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var r=t.readUint16();s.extents=[];for(var o=0;o<r;o++){var a={};if(s.extents.push(a),1===this.version||2===this.version)switch(this.index_size){case 0:a.extent_index=0;break;case 4:a.extent_index=t.readUint32();break;case 8:a.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:a.extent_offset=0;break;case 4:a.extent_offset=t.readUint32();break;case 8:a.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:a.extent_length=0;break;case 4:a.extent_length=t.readUint32();break;case 8:a.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}})),l.createBoxCtor("imir",(function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=1&e})),l.createFullBoxCtor("infe",(function(t){if(0!==this.version&&1!==this.version||(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),1===this.version)return this.extension_type=t.readString(4),n.warn("BoxParser","Cannot parse extension type"),void t.seek(this.start+this.size);this.version>=2&&(2===this.version?this.item_ID=t.readUint16():3===this.version&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),"mime"===this.item_type?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):"uri "===this.item_type&&(this.item_uri_type=t.readCString()))})),l.createFullBoxCtor("ipma",(function(t){var e,i;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var n={};this.associations.push(n),this.version<1?n.id=t.readUint16():n.id=t.readUint32();var s=t.readUint8();for(n.props=[],i=0;i<s;i++){var r=t.readUint8(),o={};n.props.push(o),o.essential=(128&r)>>7==1,1&this.flags?o.property_index=(127&r)<<8|t.readUint8():o.property_index=127&r}}})),l.createFullBoxCtor("iref",(function(t){var e,i;for(this.references=[];t.getPosition()<this.start+this.size;){if((e=l.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==l.OK)return;(i=0===this.version?new l.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):new l.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start)).write===l.Box.prototype.write&&"mdat"!==i.type&&(n.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.references.push(i)}})),l.createBoxCtor("irot",(function(t){this.angle=3&t.readUint8()})),l.createFullBoxCtor("ispe",(function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()})),l.createFullBoxCtor("kind",(function(t){this.schemeURI=t.readCString(),this.value=t.readCString()})),l.createFullBoxCtor("leva",(function(t){var e=t.readUint8();this.levels=[];for(var i=0;i<e;i++){var s={};this.levels[i]=s,s.track_ID=t.readUint32();var r=t.readUint8();switch(s.padding_flag=r>>7,s.assignment_type=127&r,s.assignment_type){case 0:s.grouping_type=t.readString(4);break;case 1:s.grouping_type=t.readString(4),s.grouping_type_parameter=t.readUint32();break;case 2:case 3:break;case 4:s.sub_track_id=t.readUint32();break;default:n.warn("BoxParser","Unknown leva assignement type")}}})),l.createBoxCtor("lsel",(function(t){this.layer_id=t.readUint16()})),l.createBoxCtor("maxr",(function(t){this.period=t.readUint32(),this.bytes=t.readUint32()})),l.createBoxCtor("mdcv",(function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()})),l.createFullBoxCtor("mdhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()})),l.createFullBoxCtor("mehd",(function(t){1&this.flags&&(n.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),1==this.version?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()})),l.createFullBoxCtor("meta",(function(t){this.boxes=[],l.ContainerBox.prototype.parse.call(this,t)})),l.createFullBoxCtor("mfhd",(function(t){this.sequence_number=t.readUint32()})),l.createFullBoxCtor("mfro",(function(t){this._size=t.readUint32()})),l.createFullBoxCtor("mvhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()})),l.createBoxCtor("npck",(function(t){this.packetssent=t.readUint32()})),l.createBoxCtor("nump",(function(t){this.packetssent=t.readUint64()})),l.createFullBoxCtor("padb",(function(t){var e=t.readUint32();this.padbits=[];for(var i=0;i<Math.floor((e+1)/2);i++)this.padbits=t.readUint8()})),l.createBoxCtor("pasp",(function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()})),l.createBoxCtor("payl",(function(t){this.text=t.readString(this.size-this.hdr_size)})),l.createBoxCtor("payt",(function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)})),l.createFullBoxCtor("pdin",(function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<e;i++)this.rate[i]=t.readUint32(),this.initial_delay[i]=t.readUint32()})),l.createFullBoxCtor("pitm",(function(t){0===this.version?this.item_id=t.readUint16():this.item_id=t.readUint32()})),l.createFullBoxCtor("pixi",(function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()})),l.createBoxCtor("pmax",(function(t){this.bytes=t.readUint32()})),l.createFullBoxCtor("prft",(function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),0===this.version?this.media_time=t.readUint32():this.media_time=t.readUint64()})),l.createFullBoxCtor("pssh",(function(t){if(this.system_id=l.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var i=0;i<e;i++)this.kid[i]=l.parseHex16(t)}var n=t.readUint32();n>0&&(this.data=t.readUint8Array(n))})),l.createFullBoxCtor("clef",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),l.createFullBoxCtor("enof",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),l.createFullBoxCtor("prof",(function(t){this.width=t.readUint32(),this.height=t.readUint32()})),l.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),l.createBoxCtor("rtp ",(function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)})),l.createFullBoxCtor("saio",(function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var i=0;i<e;i++)0===this.version?this.offset[i]=t.readUint32():this.offset[i]=t.readUint64()})),l.createFullBoxCtor("saiz",(function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var i=0;i<e;i++)this.sample_info_size[i]=t.readUint8()})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"mett",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"metx",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",(function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",(function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",(function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)})),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",(function(t){this.parseHeader(t),this.parseFooter(t)})),l.createSampleGroupCtor("alst",(function(t){var e,i=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<i;e++)this.sample_offset[e]=t.readUint32();var n=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<n/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()})),l.createSampleGroupCtor("avll",(function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()})),l.createSampleGroupCtor("avss",(function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var i=t.readUint8(),n=0;n<i;n++){var s={};this.dependency.push(s),s.subSeqDirectionFlag=t.readUint8(),s.layerNumber=t.readUint8(),s.subSequenceIdentifier=t.readUint16()}})),l.createSampleGroupCtor("dtrt",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("mvif",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("prol",(function(t){this.roll_distance=t.readInt16()})),l.createSampleGroupCtor("rap ",(function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=127&e})),l.createSampleGroupCtor("rash",(function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)n.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}})),l.createSampleGroupCtor("roll",(function(t){this.roll_distance=t.readInt16()})),l.SampleGroupEntry.prototype.parse=function(t){n.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},l.createSampleGroupCtor("scif",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("scnm",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("seig",(function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=15&e,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=l.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,1===this.isProtected&&0===this.Per_Sample_IV_Size&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))})),l.createSampleGroupCtor("stsa",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("sync",(function(t){var e=t.readUint8();this.NAL_unit_type=63&e})),l.createSampleGroupCtor("tele",(function(t){var e=t.readUint8();this.level_independently_decodable=e>>7})),l.createSampleGroupCtor("tsas",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("tscl",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createSampleGroupCtor("vipr",(function(t){n.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),l.createFullBoxCtor("sbgp",(function(t){this.grouping_type=t.readString(4),1===this.version?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var n={};this.entries.push(n),n.sample_count=t.readInt32(),n.group_description_index=t.readInt32()}})),l.createFullBoxCtor("schm",(function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),1&this.flags&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))})),l.createBoxCtor("sdp ",(function(t){this.sdptext=t.readString(this.size-this.hdr_size)})),l.createFullBoxCtor("sdtp",(function(t){var e,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var n=0;n<i;n++)e=t.readUint8(),this.is_leading[n]=e>>6,this.sample_depends_on[n]=e>>4&3,this.sample_is_depended_on[n]=e>>2&3,this.sample_has_redundancy[n]=3&e})),l.createFullBoxCtor("senc"),l.createFullBoxCtor("sgpd",(function(t){this.grouping_type=t.readString(4),n.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var s;s=l[this.grouping_type+"SampleGroupEntry"]?new l[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new l.SampleGroupEntry(this.grouping_type),this.entries.push(s),1===this.version&&0===this.default_length?s.description_length=t.readUint32():s.description_length=this.default_length,s.write===l.SampleGroupEntry.prototype.write&&(n.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),s.data=t.readUint8Array(s.description_length),t.position-=s.description_length),s.parse(t)}})),l.createFullBoxCtor("sidx",(function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),i=0;i<e;i++){var n={};this.references.push(n);var s=t.readUint32();n.reference_type=s>>31&1,n.referenced_size=2147483647&s,n.subsegment_duration=t.readUint32(),s=t.readUint32(),n.starts_with_SAP=s>>31&1,n.SAP_type=s>>28&7,n.SAP_delta_time=268435455&s}})),l.SingleItemTypeReferenceBox=function(t,e,i,n){l.Box.call(this,t,e),this.hdr_size=i,this.start=n},l.SingleItemTypeReferenceBox.prototype=new l.Box,l.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint16()},l.SingleItemTypeReferenceBoxLarge=function(t,e,i,n){l.Box.call(this,t,e),this.hdr_size=i,this.start=n},l.SingleItemTypeReferenceBoxLarge.prototype=new l.Box,l.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint32()},l.createFullBoxCtor("SmDm",(function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()})),l.createFullBoxCtor("smhd",(function(t){this.balance=t.readUint16(),t.readUint16()})),l.createFullBoxCtor("ssix",(function(t){this.subsegments=[];for(var e=t.readUint32(),i=0;i<e;i++){var n={};this.subsegments.push(n),n.ranges=[];for(var s=t.readUint32(),r=0;r<s;r++){var o={};n.ranges.push(o),o.level=t.readUint8(),o.range_size=t.readUint24()}}})),l.createFullBoxCtor("stco",(function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],0===this.version)for(var i=0;i<e;i++)this.chunk_offsets.push(t.readUint32())})),l.createFullBoxCtor("stdp",(function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<e;i++)this.priority[i]=t.readUint16()})),l.createFullBoxCtor("sthd"),l.createFullBoxCtor("stri",(function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()})),l.createFullBoxCtor("stsc",(function(t){var e,i;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(i=0;i<e;i++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())})),l.createFullBoxCtor("stsd",(function(t){var e,i,s,r;for(this.entries=[],s=t.readUint32(),e=1;e<=s;e++){if((i=l.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==l.OK)return;l[i.type+"SampleEntry"]?((r=new l[i.type+"SampleEntry"](i.size)).hdr_size=i.hdr_size,r.start=i.start):(n.warn("BoxParser","Unknown sample entry type: "+i.type),r=new l.SampleEntry(i.type,i.size,i.hdr_size,i.start)),r.write===l.SampleEntry.prototype.write&&(n.info("BoxParser","SampleEntry "+r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.entries.push(r)}})),l.createFullBoxCtor("stsg",(function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var i=0;i<e;i++)this.group_description_index[i]=t.readUint32()})),l.createFullBoxCtor("stsh",(function(t){var e,i;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(i=0;i<e;i++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())})),l.createFullBoxCtor("stss",(function(t){var e,i;if(i=t.readUint32(),0===this.version)for(this.sample_numbers=[],e=0;e<i;e++)this.sample_numbers.push(t.readUint32())})),l.createFullBoxCtor("stsz",(function(t){var e;if(this.sample_sizes=[],0===this.version)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)0===this.sample_size?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size})),l.createFullBoxCtor("stts",(function(t){var e,i,s;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],0===this.version)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),(s=t.readInt32())<0&&(n.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),s=1),this.sample_deltas.push(s)})),l.createFullBoxCtor("stvi",(function(t){var e=t.readUint32();this.single_view_allowed=3&e,this.stereo_scheme=t.readUint32();var i,n,s=t.readUint32();for(this.stereo_indication_type=t.readString(s),this.boxes=[];t.getPosition()<this.start+this.size;){if((i=l.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==l.OK)return;n=i.box,this.boxes.push(n),this[n.type]=n}})),l.createBoxCtor("styp",(function(t){l.ftypBox.prototype.parse.call(this,t)})),l.createFullBoxCtor("stz2",(function(t){var e,i;if(this.sample_sizes=[],0===this.version)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),i=t.readUint32(),4===this.field_size)for(e=0;e<i;e+=2){var s=t.readUint8();this.sample_sizes[e]=s>>4&15,this.sample_sizes[e+1]=15&s}else if(8===this.field_size)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint8();else if(16===this.field_size)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint16();else n.error("BoxParser","Error in length field in stz2 box")})),l.createFullBoxCtor("subs",(function(t){var e,i,n,s;for(n=t.readUint32(),this.entries=[],e=0;e<n;e++){var r={};if(this.entries[e]=r,r.sample_delta=t.readUint32(),r.subsamples=[],(s=t.readUint16())>0)for(i=0;i<s;i++){var o={};r.subsamples.push(o),1==this.version?o.size=t.readUint32():o.size=t.readUint16(),o.priority=t.readUint8(),o.discardable=t.readUint8(),o.codec_specific_parameters=t.readUint32()}}})),l.createFullBoxCtor("tenc",(function(t){if(t.readUint8(),0===this.version)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=15&e}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=l.parseHex16(t),1===this.default_isProtected&&0===this.default_Per_Sample_IV_Size&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))})),l.createFullBoxCtor("tfdt",(function(t){1==this.version?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()})),l.createFullBoxCtor("tfhd",(function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0})),l.createFullBoxCtor("tfra",(function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=3&e,this.entries=[];for(var i=t.readUint32(),n=0;n<i;n++)1===this.version?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()})),l.createFullBoxCtor("tkhd",(function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()})),l.createBoxCtor("tmax",(function(t){this.time=t.readUint32()})),l.createBoxCtor("tmin",(function(t){this.time=t.readUint32()})),l.createBoxCtor("totl",(function(t){this.bytessent=t.readUint32()})),l.createBoxCtor("tpay",(function(t){this.bytessent=t.readUint32()})),l.createBoxCtor("tpyl",(function(t){this.bytessent=t.readUint64()})),l.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},l.createTrackGroupCtor("msrc"),l.TrackReferenceTypeBox=function(t,e,i,n){l.Box.call(this,t,e),this.hdr_size=i,this.start=n},l.TrackReferenceTypeBox.prototype=new l.Box,l.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},l.trefBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;){if((e=l.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==l.OK)return;(i=new l.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start)).write===l.Box.prototype.write&&"mdat"!==i.type&&(n.info("BoxParser","TrackReference "+i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.boxes.push(i)}},l.createFullBoxCtor("trep",(function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;){if(ret=l.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code!==l.OK)return;box=ret.box,this.boxes.push(box)}})),l.createFullBoxCtor("trex",(function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()})),l.createBoxCtor("trpy",(function(t){this.bytessent=t.readUint64()})),l.createFullBoxCtor("trun",(function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&l.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&l.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&l.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&l.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&l.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())})),l.createFullBoxCtor("tsel",(function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()})),l.createFullBoxCtor("txtC",(function(t){this.config=t.readCString()})),l.createFullBoxCtor("url ",(function(t){1!==this.flags&&(this.location=t.readCString())})),l.createFullBoxCtor("urn ",(function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())})),l.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,(function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")})),l.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,(function(t){this.system_id=l.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))})),l.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),l.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,(function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=l.parseHex16(t)})),l.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,(function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var i={},n=0,s=0;1===this.version?(n=t.readUint64(),s=t.readUint64()):(n=t.readUint32(),s=t.readUint32()),i.absolute_time=n,i.absolute_duration=s,this.entries.push(i)}})),l.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,(function(t){1===this.version?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())})),l.createFullBoxCtor("vmhd",(function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)})),l.createFullBoxCtor("vpcC",(function(t){var e;1===this.version?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=1&e,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=15&e,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=1&e,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))})),l.createBoxCtor("vttC",(function(t){this.text=t.readString(this.size-this.hdr_size)})),l.createFullBoxCtor("vvcC",(function(t){var e,i,n={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(t){this.held_bits=t.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(t){this.held_bits=t.readUint16(),this.num_held_bits=16},extract_bits:function(t){var e=this.held_bits>>this.num_held_bits-t&(1<<t)-1;return this.num_held_bits-=t,e}};if(n.stream_read_1_bytes(t),n.extract_bits(5),this.lengthSizeMinusOne=n.extract_bits(2),this.ptl_present_flag=n.extract_bits(1),this.ptl_present_flag){if(n.stream_read_2_bytes(t),this.ols_idx=n.extract_bits(9),this.num_sublayers=n.extract_bits(3),this.constant_frame_rate=n.extract_bits(2),this.chroma_format_idc=n.extract_bits(2),n.stream_read_1_bytes(t),this.bit_depth_minus8=n.extract_bits(3),n.extract_bits(5),n.stream_read_2_bytes(t),n.extract_bits(2),this.num_bytes_constraint_info=n.extract_bits(6),this.general_profile_idc=n.extract_bits(7),this.general_tier_flag=n.extract_bits(1),this.general_level_idc=t.readUint8(),n.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=n.extract_bits(1),this.ptl_multilayer_enabled_flag=n.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(e=0;e<this.num_bytes_constraint_info-1;e++){var s=n.extract_bits(6);n.stream_read_1_bytes(t);var r=n.extract_bits(2);this.general_constraint_info[e]=s<<2|r}this.general_constraint_info[this.num_bytes_constraint_info-1]=n.extract_bits(6)}else n.extract_bits(6);for(n.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,i=this.num_sublayers-2;i>=0;--i){var o=n.extract_bits(1);this.ptl_sublayer_present_mask|=o<<i}for(i=this.num_sublayers;i<=8&&this.num_sublayers>1;++i)n.extract_bits(1);for(i=this.num_sublayers-2;i>=0;--i)this.ptl_sublayer_present_mask&1<<i&&(this.sublayer_level_idc[i]=t.readUint8());if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(e=0;e<this.ptl_num_sub_profiles;e++)this.general_sub_profile_idc.push(t.readUint32());this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}this.nalu_arrays=[];var a=t.readUint8();for(e=0;e<a;e++){var h=[];this.nalu_arrays.push(h),n.stream_read_1_bytes(t),h.completeness=n.extract_bits(1),n.extract_bits(2),h.nalu_type=n.extract_bits(5);var l=1;for(13!=h.nalu_type&&12!=h.nalu_type&&(l=t.readUint16()),i=0;i<l;i++){var d=t.readUint16();h.push({data:t.readUint8Array(d),length:d})}}})),l.createFullBoxCtor("vvnC",(function(t){var e=strm.readUint8();this.lengthSizeMinusOne=3&e})),l.SampleEntry.prototype.isVideo=function(){return!1},l.SampleEntry.prototype.isAudio=function(){return!1},l.SampleEntry.prototype.isSubtitle=function(){return!1},l.SampleEntry.prototype.isMetadata=function(){return!1},l.SampleEntry.prototype.isHint=function(){return!1},l.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},l.SampleEntry.prototype.getWidth=function(){return""},l.SampleEntry.prototype.getHeight=function(){return""},l.SampleEntry.prototype.getChannelCount=function(){return""},l.SampleEntry.prototype.getSampleRate=function(){return""},l.SampleEntry.prototype.getSampleSize=function(){return""},l.VisualSampleEntry.prototype.isVideo=function(){return!0},l.VisualSampleEntry.prototype.getWidth=function(){return this.width},l.VisualSampleEntry.prototype.getHeight=function(){return this.height},l.AudioSampleEntry.prototype.isAudio=function(){return!0},l.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},l.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},l.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},l.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},l.MetadataSampleEntry.prototype.isMetadata=function(){return!0},l.decimalToHex=function(t,e){var i=Number(t).toString(16);for(e=null==e?e=2:e;i.length<e;)i="0"+i;return i},l.avc1SampleEntry.prototype.getCodec=l.avc2SampleEntry.prototype.getCodec=l.avc3SampleEntry.prototype.getCodec=l.avc4SampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+l.decimalToHex(this.avcC.AVCProfileIndication)+l.decimalToHex(this.avcC.profile_compatibility)+l.decimalToHex(this.avcC.AVCLevelIndication):t},l.hev1SampleEntry.prototype.getCodec=l.hvc1SampleEntry.prototype.getCodec=function(){var t,e=l.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C"}e+=this.hvcC.general_profile_idc,e+=".";var i=this.hvcC.general_profile_compatibility,n=0;for(t=0;t<32&&(n|=1&i,31!=t);t++)n<<=1,i>>=1;e+=l.decimalToHex(n,0),e+=".",0===this.hvcC.general_tier_flag?e+="L":e+="H",e+=this.hvcC.general_level_idc;var s=!1,r="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||s)&&(r="."+l.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+r,s=!0);e+=r}return e},l.vvc1SampleEntry.prototype.getCodec=l.vvi1SampleEntry.prototype.getCodec=function(){var t,e=l.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){e+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?e+=".H":e+=".L",e+=this.vvcC.general_level_idc;var i="";if(this.vvcC.general_constraint_info){var n,s=[],r=0;for(r|=this.vvcC.ptl_frame_only_constraint<<7,r|=this.vvcC.ptl_multilayer_enabled<<6,t=0;t<this.vvcC.general_constraint_info.length;++t)r|=this.vvcC.general_constraint_info[t]>>2&63,s.push(r),r&&(n=t),r=this.vvcC.general_constraint_info[t]>>2&3;if(void 0===n)i=".CA";else{i=".C";var o=0,a=0;for(t=0;t<=n;++t)for(o=o<<8|s[t],a+=8;a>=5;){i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"[o>>a-5&31],o&=(1<<(a-=5))-1}a&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"[31&(o<<=5-a)])}}e+=i}return e},l.mp4aSampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return t+"."+l.decimalToHex(e)+(i?"."+i:"")}return t},l.stxtSampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},l.vp08SampleEntry.prototype.getCodec=l.vp09SampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;0==e&&(e="00");var i=this.vpcC.bitDepth;return 8==i&&(i="08"),t+".0"+this.vpcC.profile+"."+e+"."+i},l.av01SampleEntry.prototype.getCodec=function(){var t,e=l.SampleEntry.prototype.getCodec.call(this),i=this.av1C.seq_level_idx_0;return i<10&&(i="0"+i),2===this.av1C.seq_profile&&1===this.av1C.high_bitdepth?t=1===this.av1C.twelve_bit?"12":"10":this.av1C.seq_profile<=2&&(t=1===this.av1C.high_bitdepth?"10":"08"),e+"."+this.av1C.seq_profile+"."+i+(this.av1C.seq_tier_0?"H":"M")+"."+t},l.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>o&&(this.size+=8),"uuid"===this.type&&(this.size+=16),n.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>o?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),"uuid"===this.type&&t.writeUint8Array(this.uuid),this.size>o&&t.writeUint64(this.size)},l.FullBox.prototype.writeHeader=function(t){this.size+=4,l.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},l.Box.prototype.write=function(t){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},l.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);n.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.TrackReferenceTypeBox.prototype.write=function(t){this.size=4*this.track_ids.length,this.writeHeader(t),t.writeUint32Array(this.track_ids)},l.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},l.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},l.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},l.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),1===this.version?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},l.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;n.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},l.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeUint32(i.segment_duration),t.writeInt32(i.media_time),t.writeInt16(i.media_rate_integer),t.writeInt16(i.media_rate_fraction)}},l.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},l.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},l.hdlrBox.prototype.write=function(t){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},l.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},l.mdhdBox.prototype.write=function(t){this.size=20,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},l.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},l.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},l.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=96,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},l.SampleEntry.prototype.writeHeader=function(t){this.size=8,l.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},l.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;n.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,n.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=70,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},l.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=20,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},l.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},l.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},l.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeInt32(i.sample_count),t.writeInt32(i.group_description_index)}},l.sgpdBox.prototype.write=function(t){var e,i;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)i=this.entries[e],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),1===this.version&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)i=this.entries[e],1===this.version&&0===this.default_length&&t.writeUint32(i.description_length),i.write(t)},l.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var i=this.references[e];t.writeUint32(i.reference_type<<31|i.referenced_size),t.writeUint32(i.subsegment_duration),t.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}},l.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},l.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},l.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},l.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;n.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},l.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},l.stszBox.prototype.write=function(t){var e,i=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;){if(this.sample_sizes[e+1]!==this.sample_sizes[0]){i=!1;break}e++}else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),i?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),i||t.writeUint32Array(this.sample_sizes)},l.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},l.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(t),1===this.version?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},l.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},l.tkhdBox.prototype.write=function(t){this.version=0,this.size=80,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},l.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},l.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&l.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&l.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&l.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&l.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&l.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&l.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},l["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},l["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},l.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},l.cttsBox.prototype.unpack=function(t){var e,i,n;for(n=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)t[n].pts=t[n].dts+this.sample_offsets[e],n++},l.sttsBox.prototype.unpack=function(t){var e,i,n;for(n=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)t[n].dts=0===n?0:t[n-1].dts+this.sample_deltas[e],n++},l.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},l.stscBox.prototype.unpack=function(t){var e,i,n,s,r;for(s=0,r=0,e=0;e<this.first_chunk.length;e++)for(i=0;i<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);i++)for(r++,n=0;n<this.samples_per_chunk[e];n++){if(!t[s])return;t[s].description_index=this.sample_description_index[e],t[s].chunk_index=r,s++}},l.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},l.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],l.boxEqualFields=function(t,e){if(t&&!e)return!1;var i;for(i in t)if(!(l.DIFF_BOXES_PROP_NAMES.indexOf(i)>-1||t[i]instanceof l.Box||e[i]instanceof l.Box||void 0===t[i]||void 0===e[i]||"function"==typeof t[i]||"function"==typeof e[i]||t.subBoxNames&&t.subBoxNames.indexOf(i.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(i.slice(0,4))>-1||"data"===i||"start"===i||"size"===i||"creation_time"===i||"modification_time"===i||l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(i)>-1||t[i]===e[i]))return!1;return!0},l.boxEqual=function(t,e){if(!l.boxEqualFields(t,e))return!1;for(var i=0;i<l.DIFF_BOXES_PROP_NAMES.length;i++){var n=l.DIFF_BOXES_PROP_NAMES[i];if(t[n]&&e[n]&&!l.boxEqual(t[n],e[n]))return!1}return!0};var d=function(){};d.prototype.parseSample=function(t){var e,i={};i.resources=[];var n=new s(t.data.buffer);if(t.subsamples&&0!==t.subsamples.length){if(i.documentString=n.readString(t.subsamples[0].size),t.subsamples.length>1)for(e=1;e<t.subsamples.length;e++)i.resources[e]=n.readUint8Array(t.subsamples[e].size)}else i.documentString=n.readString(t.data.length);return"undefined"!=typeof DOMParser&&(i.document=(new DOMParser).parseFromString(i.documentString,"application/xml")),i};var p=function(){};p.prototype.parseSample=function(t){return new s(t.data.buffer).readString(t.data.length)},p.prototype.parseConfig=function(t){var e=new s(t.buffer);return e.readUint32(),e.readCString()},t.XMLSubtitlein4Parser=d,t.Textin4Parser=p;var c=function(t){this.stream=t||new a,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};c.prototype.setSegmentOptions=function(t,e,i){var n=this.getTrackById(t);if(n){var s={};this.fragmentedTracks.push(s),s.id=t,s.user=e,s.trak=n,n.nextSample=0,s.segmentStream=null,s.nb_samples=1e3,s.rapAlignement=!0,i&&(i.nbSamples&&(s.nb_samples=i.nbSamples),i.rapAlignement&&(s.rapAlignement=i.rapAlignement))}},c.prototype.unsetSegmentOptions=function(t){for(var e=-1,i=0;i<this.fragmentedTracks.length;i++){this.fragmentedTracks[i].id==t&&(e=i)}e>-1&&this.fragmentedTracks.splice(e,1)},c.prototype.setExtractionOptions=function(t,e,i){var n=this.getTrackById(t);if(n){var s={};this.extractedTracks.push(s),s.id=t,s.user=e,s.trak=n,n.nextSample=0,s.nb_samples=1e3,s.samples=[],i&&i.nbSamples&&(s.nb_samples=i.nbSamples)}},c.prototype.unsetExtractionOptions=function(t){for(var e=-1,i=0;i<this.extractedTracks.length;i++){this.extractedTracks[i].id==t&&(e=i)}e>-1&&this.extractedTracks.splice(e,1)},c.prototype.parse=function(){var t,e;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),(t=l.parseOneBox(this.stream,!1)).code===l.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}return}var i;switch(i="uuid"!==(e=t.box).type?e.type:e.uuid,this.boxes.push(e),i){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[i]&&n.warn("ISOFile","Duplicate Box of type: "+i+", overriding previous occurrence"),this[i]=e}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},c.prototype.checkBuffer=function(t){if(null==t)throw"Buffer must be defined and non empty";if(void 0===t.fileStart)throw"Buffer must have a fileStart property";return 0===t.byteLength?(n.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(n.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),!!this.stream.initialized()||(n.warn("ISOFile","Not ready to start parsing"),!1))},c.prototype.appendBuffer=function(t,e){var i;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(i=this.nextSeekPosition,this.nextSeekPosition=void 0):i=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(i=this.stream.getEndFilePositionAfter(i))):i=this.nextParsePosition?this.nextParsePosition:0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(n.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+i),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),n.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),i},c.prototype.getInfo=function(){var t,e,i,n,s,r,o={},a=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(o.hasMoov=!0,o.duration=this.moov.mvhd.duration,o.timescale=this.moov.mvhd.timescale,o.isFragmented=null!=this.moov.mvex,o.isFragmented&&this.moov.mvex.mehd&&(o.fragment_duration=this.moov.mvex.mehd.fragment_duration),o.isProgressive=this.isProgressive,o.hasIOD=null!=this.moov.iods,o.brands=[],o.brands.push(this.ftyp.major_brand),o.brands=o.brands.concat(this.ftyp.compatible_brands),o.created=new Date(a+1e3*this.moov.mvhd.creation_time),o.modified=new Date(a+1e3*this.moov.mvhd.modification_time),o.tracks=[],o.audioTracks=[],o.videoTracks=[],o.subtitleTracks=[],o.metadataTracks=[],o.hintTracks=[],o.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(r=(i=this.moov.traks[t]).mdia.minf.stbl.stsd.entries[0],n={},o.tracks.push(n),n.id=i.tkhd.track_id,n.name=i.mdia.hdlr.name,n.references=[],i.tref)for(e=0;e<i.tref.boxes.length;e++)s={},n.references.push(s),s.type=i.tref.boxes[e].type,s.track_ids=i.tref.boxes[e].track_ids;i.edts&&(n.edits=i.edts.elst.entries),n.created=new Date(a+1e3*i.tkhd.creation_time),n.modified=new Date(a+1e3*i.tkhd.modification_time),n.movie_duration=i.tkhd.duration,n.movie_timescale=o.timescale,n.layer=i.tkhd.layer,n.alternate_group=i.tkhd.alternate_group,n.volume=i.tkhd.volume,n.matrix=i.tkhd.matrix,n.track_width=i.tkhd.width/65536,n.track_height=i.tkhd.height/65536,n.timescale=i.mdia.mdhd.timescale,n.cts_shift=i.mdia.minf.stbl.cslg,n.duration=i.mdia.mdhd.duration,n.samples_duration=i.samples_duration,n.codec=r.getCodec(),n.kind=i.udta&&i.udta.kinds.length?i.udta.kinds[0]:{schemeURI:"",value:""},n.language=i.mdia.elng?i.mdia.elng.extended_language:i.mdia.mdhd.languageString,n.nb_samples=i.samples.length,n.size=i.samples_size,n.bitrate=8*n.size*n.timescale/n.samples_duration,r.isAudio()?(n.type="audio",o.audioTracks.push(n),n.audio={},n.audio.sample_rate=r.getSampleRate(),n.audio.channel_count=r.getChannelCount(),n.audio.sample_size=r.getSampleSize()):r.isVideo()?(n.type="video",o.videoTracks.push(n),n.video={},n.video.width=r.getWidth(),n.video.height=r.getHeight()):r.isSubtitle()?(n.type="subtitles",o.subtitleTracks.push(n)):r.isHint()?(n.type="metadata",o.hintTracks.push(n)):r.isMetadata()?(n.type="metadata",o.metadataTracks.push(n)):(n.type="metadata",o.otherTracks.push(n))}else o.hasMoov=!1;if(o.mime="",o.hasMoov&&o.tracks){for(o.videoTracks&&o.videoTracks.length>0?o.mime+='video/mp4; codecs="':o.audioTracks&&o.audioTracks.length>0?o.mime+='audio/mp4; codecs="':o.mime+='application/mp4; codecs="',t=0;t<o.tracks.length;t++)0!==t&&(o.mime+=","),o.mime+=o.tracks[t].codec;o.mime+='"; profiles="',o.mime+=this.ftyp.compatible_brands.join(),o.mime+='"'}return o},c.prototype.processSamples=function(t){var e,i;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(e=0;e<this.fragmentedTracks.length;e++){var s=this.fragmentedTracks[e];for(i=s.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){n.debug("ISOFile","Creating media fragment on track #"+s.id+" for sample "+i.nextSample);var r=this.createFragment(s.id,i.nextSample,s.segmentStream);if(!r)break;if(s.segmentStream=r,i.nextSample++,(i.nextSample%s.nb_samples==0||t||i.nextSample>=i.samples.length)&&(n.info("ISOFile","Sending fragmented data on track #"+s.id+" for samples ["+Math.max(0,i.nextSample-s.nb_samples)+","+(i.nextSample-1)+"]"),n.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(s.id,s.user,s.segmentStream.buffer,i.nextSample,t||i.nextSample>=i.samples.length),s.segmentStream=null,s!==this.fragmentedTracks[e]))break}}if(null!==this.onSamples)for(e=0;e<this.extractedTracks.length;e++){var o=this.extractedTracks[e];for(i=o.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){n.debug("ISOFile","Exporting on track #"+o.id+" sample #"+i.nextSample);var a=this.getSample(i,i.nextSample);if(!a)break;if(i.nextSample++,o.samples.push(a),(i.nextSample%o.nb_samples==0||i.nextSample>=i.samples.length)&&(n.debug("ISOFile","Sending samples on track #"+o.id+" for sample "+i.nextSample),this.onSamples&&this.onSamples(o.id,o.user,o.samples),o.samples=[],o!==this.extractedTracks[e]))break}}}},c.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},c.prototype.getBoxes=function(t,e){var i=[];return c._sweep.call(this,t,i,e),i},c._sweep=function(t,e,i){for(var n in this.type&&this.type==t&&e.push(this),this.boxes){if(e.length&&i)return;c._sweep.call(this.boxes[n],t,e,i)}},c.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);return e?e.samples:void 0},c.prototype.getTrackSample=function(t,e){var i=this.getTrackById(t);return this.getSample(i,e)},c.prototype.releaseUsedSamples=function(t,e){var i=0,s=this.getTrackById(t);s.lastValidSample||(s.lastValidSample=0);for(var r=s.lastValidSample;r<e;r++)i+=this.releaseSample(s,r);n.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+i+", remaining: "+this.samplesDataSize+")"),s.lastValidSample=e},c.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},c.prototype.stop=function(){this.sampleProcessingStarted=!1},c.prototype.flush=function(){n.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},c.prototype.seekTrack=function(t,e,i){var s,r,o,a,h=0,l=0;if(0===i.samples.length)return n.info("ISOFile","No sample in track, cannot seek! Using time "+n.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(s=0;s<i.samples.length;s++){if(r=i.samples[s],0===s)l=0,a=r.timescale;else if(r.cts>t*r.timescale){l=s-1;break}e&&r.is_sync&&(h=s)}for(e&&(l=h),t=i.samples[l].cts,i.nextSample=l;i.samples[l].alreadyRead===i.samples[l].size&&i.samples[l+1];)l++;return o=i.samples[l].offset+i.samples[l].alreadyRead,n.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+n.getDurationString(t,a)+" and offset: "+o),{offset:o,time:t/a}},c.prototype.seek=function(t,e){var i,s,r,o=this.moov,a={offset:1/0,time:1/0};if(this.moov){for(r=0;r<o.traks.length;r++)i=o.traks[r],(s=this.seekTrack(t,e,i)).offset<a.offset&&(a.offset=s.offset),s.time<a.time&&(a.time=s.time);return n.info("ISOFile","Seeking at time "+n.getDurationString(a.time,1)+" needs a buffer with a fileStart position of "+a.offset),a.offset===1/0?a={offset:this.nextParsePosition,time:0}:a.offset=this.stream.getEndFilePositionAfter(a.offset),n.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+a.offset),a}throw"Cannot seek: moov not received!"},c.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var i=this.boxes[e],n=t.boxes[e];if(!l.boxEqual(i,n))return!1;e++}return!0},t.ISOFile=c,c.prototype.lastBoxStartPosition=0,c.prototype.parsingMdat=null,c.prototype.nextParsePosition=0,c.prototype.discardMdatData=!1,c.prototype.processIncompleteBox=function(t){var e;return"mdat"===t.type?(e=new l[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,this.stream.seek(e.start+e.size,!1,this.discardMdatData)?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):("moov"===t.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),!!this.stream.mergeNextBuffer&&this.stream.mergeNextBuffer()?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},c.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},c.prototype.processIncompleteMdat=function(){var t;return t=this.parsingMdat,this.stream.seek(t.start+t.size,!1,this.discardMdatData)?(n.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},c.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},c.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},c.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&("mdat"===t.type?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},c.prototype.add=l.Box.prototype.add,c.prototype.addBox=l.Box.prototype.addBox,c.prototype.init=function(t){var e=t||{};this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]);var i=this.add("moov");return i.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),i.add("mvex"),this},c.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var i=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,i.add("tkhd").set("flags",l.TKHD_FLAG_ENABLED|l.TKHD_FLAG_IN_MOVIE|l.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",e.width<<16).set("height",e.height<<16);var n=i.add("mdia");n.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),n.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),n.add("elng").set("extended_language",e.language||"fr-FR");var r=n.add("minf");if(void 0!==l[e.type+"SampleEntry"]){var o=new l[e.type+"SampleEntry"];o.data_reference_index=1;var a="";for(var h in l.sampleEntryCodes)for(var d=l.sampleEntryCodes[h],p=0;p<d.length;p++)if(d.indexOf(e.type)>-1){a=h;break}switch(a){case"Visual":if(r.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),o.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var c=new l.avcCBox,u=new s(e.avcDecoderConfigRecord);c.parse(u),o.addBox(c)}break;case"Audio":r.add("smhd").set("balance",e.balance||0),o.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":r.add("hmhd");break;case"Subtitle":switch(r.add("sthd"),e.type){case"stpp":o.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"")}break;case"Metadata":case"System":default:r.add("nmhd")}e.description&&o.addBox(e.description),e.description_boxes&&e.description_boxes.forEach((function(t){o.addBox(t)})),r.add("dinf").add("dref").addEntry((new l["url Box"]).set("flags",1));var f=r.add("stbl");return f.add("stsd").addEntry(o),f.add("stts").set("sample_counts",[]).set("sample_deltas",[]),f.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),f.add("stco").set("chunk_offsets",[]),f.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(i),e.id}},l.Box.prototype.computeSize=function(t){var e=t||new r;e.endianness=r.BIG_ENDIAN,this.write(e)},c.prototype.addSample=function(t,e,i){var n=i||{},s={},r=this.getTrackById(t);if(null!==r){s.number=r.samples.length,s.track_id=r.tkhd.track_id,s.timescale=r.mdia.mdhd.timescale,s.description_index=n.sample_description_index?n.sample_description_index-1:0,s.description=r.mdia.minf.stbl.stsd.entries[s.description_index],s.data=e,s.size=e.byteLength,s.alreadyRead=s.size,s.duration=n.duration||1,s.cts=n.cts||0,s.dts=n.dts||0,s.is_sync=n.is_sync||!1,s.is_leading=n.is_leading||0,s.depends_on=n.depends_on||0,s.is_depended_on=n.is_depended_on||0,s.has_redundancy=n.has_redundancy||0,s.degradation_priority=n.degradation_priority||0,s.offset=0,s.subsamples=n.subsamples,r.samples.push(s),r.samples_size+=s.size,r.samples_duration+=s.duration,r.first_dts||(r.first_dts=n.dts),this.processSamples();var o=this.createSingleSampleMoof(s);return this.addBox(o),o.computeSize(),o.trafs[0].truns[0].data_offset=o.size+8,this.add("mdat").data=new Uint8Array(e),s}},c.prototype.createSingleSampleMoof=function(t){var e=0;e=t.is_sync?1<<25:65536;var i=new l.moofBox;i.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var n=i.add("traf"),s=this.getTrackById(t.track_id);return n.add("tfhd").set("track_id",t.track_id).set("flags",l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),n.add("tfdt").set("baseMediaDecodeTime",t.dts-(s.first_dts||0)),n.add("trun").set("flags",l.TRUN_FLAGS_DATA_OFFSET|l.TRUN_FLAGS_DURATION|l.TRUN_FLAGS_SIZE|l.TRUN_FLAGS_FLAGS|l.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),i},c.prototype.lastMoofIndex=0,c.prototype.samplesDataSize=0,c.prototype.resetTables=function(){var t,e,i,n,s,r;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){(e=this.moov.traks[t]).tkhd.duration=0,e.mdia.mdhd.duration=0,(e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64).chunk_offsets=[],(i=e.mdia.minf.stbl.stsc).first_chunk=[],i.samples_per_chunk=[],i.sample_description_index=[],(e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2).sample_sizes=[],(n=e.mdia.minf.stbl.stts).sample_counts=[],n.sample_deltas=[],(s=e.mdia.minf.stbl.ctts)&&(s.sample_counts=[],s.sample_offsets=[]),r=e.mdia.minf.stbl.stss;var o=e.mdia.minf.stbl.boxes.indexOf(r);-1!=o&&(e.mdia.minf.stbl.boxes[o]=null)}},c.initSampleGroups=function(t,e,i,n,s){var r,o,a,h;function l(t,e,i){this.grouping_type=t,this.grouping_type_parameter=e,this.sbgp=i,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),o=0;o<i.length;o++){for(h=i[o].grouping_type+"/"+i[o].grouping_type_parameter,a=new l(i[o].grouping_type,i[o].grouping_type_parameter,i[o]),e&&(e.sample_groups_info[h]=a),t.sample_groups_info[h]||(t.sample_groups_info[h]=a),r=0;r<n.length;r++)n[r].grouping_type===i[o].grouping_type&&(a.description=n[r],a.description.used=!0);if(s)for(r=0;r<s.length;r++)s[r].grouping_type===i[o].grouping_type&&(a.fragment_description=s[r],a.fragment_description.used=!0,a.is_fragment=!0)}if(e){if(s)for(o=0;o<s.length;o++)!s[o].used&&s[o].version>=2&&(h=s[o].grouping_type+"/0",(a=new l(s[o].grouping_type,0)).is_fragment=!0,e.sample_groups_info[h]||(e.sample_groups_info[h]=a))}else for(o=0;o<n.length;o++)!n[o].used&&n[o].version>=2&&(h=n[o].grouping_type+"/0",a=new l(n[o].grouping_type,0),t.sample_groups_info[h]||(t.sample_groups_info[h]=a))},c.setSampleGroupProperties=function(t,e,i,n){var s,r;for(s in e.sample_groups=[],n){var o;if(e.sample_groups[s]={},e.sample_groups[s].grouping_type=n[s].grouping_type,e.sample_groups[s].grouping_type_parameter=n[s].grouping_type_parameter,i>=n[s].last_sample_in_run&&(n[s].last_sample_in_run<0&&(n[s].last_sample_in_run=0),n[s].entry_index++,n[s].entry_index<=n[s].sbgp.entries.length-1&&(n[s].last_sample_in_run+=n[s].sbgp.entries[n[s].entry_index].sample_count)),n[s].entry_index<=n[s].sbgp.entries.length-1?e.sample_groups[s].group_description_index=n[s].sbgp.entries[n[s].entry_index].group_description_index:e.sample_groups[s].group_description_index=-1,0!==e.sample_groups[s].group_description_index)o=n[s].fragment_description?n[s].fragment_description:n[s].description,e.sample_groups[s].group_description_index>0?(r=e.sample_groups[s].group_description_index>65535?(e.sample_groups[s].group_description_index>>16)-1:e.sample_groups[s].group_description_index-1,o&&r>=0&&(e.sample_groups[s].description=o.entries[r])):o&&o.version>=2&&o.default_group_description_index>0&&(e.sample_groups[s].description=o.entries[o.default_group_description_index-1])}},c.process_sdtp=function(t,e,i){e&&(t?(e.is_leading=t.is_leading[i],e.depends_on=t.sample_depends_on[i],e.is_depended_on=t.sample_is_depended_on[i],e.has_redundancy=t.sample_has_redundancy[i]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},c.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)},c.prototype.buildTrakSampleLists=function(t){var e,i,n,s,r,o,a,h,l,d,p,u,f,m,g,v,b,y,_,x,w,k,S,E;if(t.samples=[],t.samples_duration=0,t.samples_size=0,i=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,n=t.mdia.minf.stbl.stsc,s=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,r=t.mdia.minf.stbl.stts,o=t.mdia.minf.stbl.ctts,a=t.mdia.minf.stbl.stss,h=t.mdia.minf.stbl.stsd,l=t.mdia.minf.stbl.subs,u=t.mdia.minf.stbl.stdp,d=t.mdia.minf.stbl.sbgps,p=t.mdia.minf.stbl.sgpds,y=-1,_=-1,x=-1,w=-1,k=0,S=0,E=0,c.initSampleGroups(t,null,d,p),void 0!==s){for(e=0;e<s.sample_sizes.length;e++){var T={};T.number=e,T.track_id=t.tkhd.track_id,T.timescale=t.mdia.mdhd.timescale,T.alreadyRead=0,t.samples[e]=T,T.size=s.sample_sizes[e],t.samples_size+=T.size,0===e?(m=1,f=0,T.chunk_index=m,T.chunk_run_index=f,b=n.samples_per_chunk[f],v=0,g=f+1<n.first_chunk.length?n.first_chunk[f+1]-1:1/0):e<b?(T.chunk_index=m,T.chunk_run_index=f):(m++,T.chunk_index=m,v=0,m<=g||(g=++f+1<n.first_chunk.length?n.first_chunk[f+1]-1:1/0),T.chunk_run_index=f,b+=n.samples_per_chunk[f]),T.description_index=n.sample_description_index[T.chunk_run_index]-1,T.description=h.entries[T.description_index],T.offset=i.chunk_offsets[T.chunk_index-1]+v,v+=T.size,e>y&&(_++,y<0&&(y=0),y+=r.sample_counts[_]),e>0?(t.samples[e-1].duration=r.sample_deltas[_],t.samples_duration+=t.samples[e-1].duration,T.dts=t.samples[e-1].dts+t.samples[e-1].duration):T.dts=0,o?(e>=x&&(w++,x<0&&(x=0),x+=o.sample_counts[w]),T.cts=t.samples[e].dts+o.sample_offsets[w]):T.cts=T.dts,a?(e==a.sample_numbers[k]-1?(T.is_sync=!0,k++):(T.is_sync=!1,T.degradation_priority=0),l&&l.entries[S].sample_delta+E==e+1&&(T.subsamples=l.entries[S].subsamples,E+=l.entries[S].sample_delta,S++)):T.is_sync=!0,c.process_sdtp(t.mdia.minf.stbl.sdtp,T,T.number),T.degradation_priority=u?u.priority[e]:0,l&&l.entries[S].sample_delta+E==e&&(T.subsamples=l.entries[S].subsamples,E+=l.entries[S].sample_delta),(d.length>0||p.length>0)&&c.setSampleGroupProperties(t,T,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},c.prototype.updateSampleLists=function(){var t,e,i,n,s,r,o,a,h,d,p,u,f,m,g;if(void 0!==this.moov)for(;this.lastMoofIndex<this.moofs.length;)if(h=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==h.type)for(d=h,t=0;t<d.trafs.length;t++){for(p=d.trafs[t],u=this.getTrackById(p.tfhd.track_id),f=this.getTrexById(p.tfhd.track_id),n=p.tfhd.flags&l.TFHD_FLAG_SAMPLE_DESC?p.tfhd.default_sample_description_index:f?f.default_sample_description_index:1,s=p.tfhd.flags&l.TFHD_FLAG_SAMPLE_DUR?p.tfhd.default_sample_duration:f?f.default_sample_duration:0,r=p.tfhd.flags&l.TFHD_FLAG_SAMPLE_SIZE?p.tfhd.default_sample_size:f?f.default_sample_size:0,o=p.tfhd.flags&l.TFHD_FLAG_SAMPLE_FLAGS?p.tfhd.default_sample_flags:f?f.default_sample_flags:0,p.sample_number=0,p.sbgps.length>0&&c.initSampleGroups(u,p,p.sbgps,u.mdia.minf.stbl.sgpds,p.sgpds),e=0;e<p.truns.length;e++){var v=p.truns[e];for(i=0;i<v.sample_count;i++){(m={}).moof_number=this.lastMoofIndex,m.number_in_traf=p.sample_number,p.sample_number++,m.number=u.samples.length,p.first_sample_index=u.samples.length,u.samples.push(m),m.track_id=u.tkhd.track_id,m.timescale=u.mdia.mdhd.timescale,m.description_index=n-1,m.description=u.mdia.minf.stbl.stsd.entries[m.description_index],m.size=r,v.flags&l.TRUN_FLAGS_SIZE&&(m.size=v.sample_size[i]),u.samples_size+=m.size,m.duration=s,v.flags&l.TRUN_FLAGS_DURATION&&(m.duration=v.sample_duration[i]),u.samples_duration+=m.duration,u.first_traf_merged||i>0?m.dts=u.samples[u.samples.length-2].dts+u.samples[u.samples.length-2].duration:(p.tfdt?m.dts=p.tfdt.baseMediaDecodeTime:m.dts=0,u.first_traf_merged=!0),m.cts=m.dts,v.flags&l.TRUN_FLAGS_CTS_OFFSET&&(m.cts=m.dts+v.sample_composition_time_offset[i]),g=o,v.flags&l.TRUN_FLAGS_FLAGS?g=v.sample_flags[i]:0===i&&v.flags&l.TRUN_FLAGS_FIRST_FLAG&&(g=v.first_sample_flags),m.is_sync=!(g>>16&1),m.is_leading=g>>26&3,m.depends_on=g>>24&3,m.is_depended_on=g>>22&3,m.has_redundancy=g>>20&3,m.degradation_priority=65535&g;var b=!!(p.tfhd.flags&l.TFHD_FLAG_BASE_DATA_OFFSET),y=!!(p.tfhd.flags&l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),_=!!(v.flags&l.TRUN_FLAGS_DATA_OFFSET),x=0;x=b?p.tfhd.base_data_offset:y||0===e?d.start:a,m.offset=0===e&&0===i?_?x+v.data_offset:x:a,a=m.offset+m.size,(p.sbgps.length>0||p.sgpds.length>0||u.mdia.minf.stbl.sbgps.length>0||u.mdia.minf.stbl.sgpds.length>0)&&c.setSampleGroupProperties(u,m,m.number_in_traf,p.sample_groups_info)}}if(p.subs){u.has_fragment_subsamples=!0;var w=p.first_sample_index;for(e=0;e<p.subs.entries.length;e++)w+=p.subs.entries[e].sample_delta,(m=u.samples[w-1]).subsamples=p.subs.entries[e].subsamples}}},c.prototype.getSample=function(t,e){var i,s=t.samples[e];if(!this.moov)return null;if(s.data){if(s.alreadyRead==s.size)return s}else s.data=new Uint8Array(s.size),s.alreadyRead=0,this.samplesDataSize+=s.size,n.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+s.size+" (total: "+this.samplesDataSize+")");for(;;){var o=this.stream.findPosition(!0,s.offset+s.alreadyRead,!1);if(!(o>-1))return null;var a=(i=this.stream.buffers[o]).byteLength-(s.offset+s.alreadyRead-i.fileStart);if(s.size-s.alreadyRead<=a)return n.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-i.fileStart)+" read size: "+(s.size-s.alreadyRead)+" full size: "+s.size+")"),r.memcpy(s.data.buffer,s.alreadyRead,i,s.offset+s.alreadyRead-i.fileStart,s.size-s.alreadyRead),i.usedBytes+=s.size-s.alreadyRead,this.stream.logBufferLevel(),s.alreadyRead=s.size,s;if(0===a)return null;n.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-i.fileStart)+" read size: "+a+" full size: "+s.size+")"),r.memcpy(s.data.buffer,s.alreadyRead,i,s.offset+s.alreadyRead-i.fileStart,a),s.alreadyRead+=a,i.usedBytes+=a,this.stream.logBufferLevel()}},c.prototype.releaseSample=function(t,e){var i=t.samples[e];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0},c.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},c.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){t>0&&(e+=","),e+=this.moov.traks[t].mdia.minf.stbl.stsd.entries[0].getCodec()}return e},c.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var i=this.moov.mvex.trexs[e];if(i.track_id==t)return i}return null},c.prototype.getTrackById=function(t){if(void 0===this.moov)return null;for(var e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];if(i.tkhd.track_id==t)return i}return null},c.prototype.items=[],c.prototype.itemsDataSize=0,c.prototype.flattenItemInfo=function(){var t,e,i,s=this.items,r=this.meta;if(null!=r&&void 0!==r.hdlr&&void 0!==r.iinf){for(t=0;t<r.iinf.item_infos.length;t++)(i={}).id=r.iinf.item_infos[t].item_ID,s[i.id]=i,i.ref_to=[],i.name=r.iinf.item_infos[t].item_name,r.iinf.item_infos[t].protection_index>0&&(i.protection=r.ipro.protections[r.iinf.item_infos[t].protection_index-1]),r.iinf.item_infos[t].item_type?i.type=r.iinf.item_infos[t].item_type:i.type="mime",i.content_type=r.iinf.item_infos[t].content_type,i.content_encoding=r.iinf.item_infos[t].content_encoding;if(r.iloc)for(t=0;t<r.iloc.items.length;t++){var o=r.iloc.items[t];switch(i=s[o.item_ID],0!==o.data_reference_index&&(n.warn("Item storage with reference to other files: not supported"),i.source=r.dinf.boxes[o.data_reference_index-1]),o.construction_method){case 0:break;case 1:case 2:n.warn("Item storage with construction_method : not supported")}for(i.extents=[],i.size=0,e=0;e<o.extents.length;e++)i.extents[e]={},i.extents[e].offset=o.extents[e].extent_offset+o.base_offset,i.extents[e].length=o.extents[e].extent_length,i.extents[e].alreadyRead=0,i.size+=i.extents[e].length}if(r.pitm&&(s[r.pitm.item_id].primary=!0),r.iref)for(t=0;t<r.iref.references.length;t++){var a=r.iref.references[t];for(e=0;e<a.references.length;e++)s[a.from_item_ID].ref_to.push({type:a.type,id:a.references[e]})}if(r.iprp)for(var h=0;h<r.iprp.ipmas.length;h++){var l=r.iprp.ipmas[h];for(t=0;t<l.associations.length;t++){var d=l.associations[t];for(void 0===(i=s[d.id]).properties&&(i.properties={},i.properties.boxes=[]),e=0;e<d.props.length;e++){var p=d.props[e];if(p.property_index>0&&p.property_index-1<r.iprp.ipco.boxes.length){var c=r.iprp.ipco.boxes[p.property_index-1];i.properties[c.type]=c,i.properties.boxes.push(c)}}}}}},c.prototype.getItem=function(t){var e,i;if(!this.meta)return null;if(!(i=this.items[t]).data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,n.debug("ISOFile","Allocating item #"+t+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var s=0;s<i.extents.length;s++){var o=i.extents[s];if(o.alreadyRead!==o.length){var a=this.stream.findPosition(!0,o.offset+o.alreadyRead,!1);if(!(a>-1))return null;var h=(e=this.stream.buffers[a]).byteLength-(o.offset+o.alreadyRead-e.fileStart);if(!(o.length-o.alreadyRead<=h))return n.debug("ISOFile","Getting item #"+t+" extent #"+s+" partial data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-e.fileStart)+" read size: "+h+" full extent size: "+o.length+" full item size: "+i.size+")"),r.memcpy(i.data.buffer,i.alreadyRead,e,o.offset+o.alreadyRead-e.fileStart,h),o.alreadyRead+=h,i.alreadyRead+=h,e.usedBytes+=h,this.stream.logBufferLevel(),null;n.debug("ISOFile","Getting item #"+t+" extent #"+s+" data (alreadyRead: "+o.alreadyRead+" offset: "+(o.offset+o.alreadyRead-e.fileStart)+" read size: "+(o.length-o.alreadyRead)+" full extent size: "+o.length+" full item size: "+i.size+")"),r.memcpy(i.data.buffer,i.alreadyRead,e,o.offset+o.alreadyRead-e.fileStart,o.length-o.alreadyRead),e.usedBytes+=o.length-o.alreadyRead,this.stream.logBufferLevel(),i.alreadyRead+=o.length-o.alreadyRead,o.alreadyRead=o.length}}return i.alreadyRead===i.size?i:null},c.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var i=0;i<e.extents.length;i++){e.extents[i].alreadyRead=0}return e.size}return 0},c.prototype.processItems=function(t){for(var e in this.items){var i=this.items[e];this.getItem(i.id),t&&!i.sent&&(t(i),i.sent=!0,i.data=null)}},c.prototype.hasItem=function(t){for(var e in this.items){var i=this.items[e];if(i.name===t)return i.id}return-1},c.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},c.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},c.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},i=null;if(null==(i=e.itemId?this.getItem(e.itemId):this.getPrimaryItem()))return null;var n=new c;n.discardMdatData=!1;var s={type:i.type,description_boxes:i.properties.boxes};i.properties.ispe&&(s.width=i.properties.ispe.image_width,s.height=i.properties.ispe.image_height);var r=n.addTrack(s);return r?(n.addSample(r,i.data),n):null},c.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},c.prototype.createFragment=function(t,e,i){var s=this.getTrackById(t),o=this.getSample(s,e);if(null==o)return o=s.samples[e],this.nextSeekPosition?this.nextSeekPosition=Math.min(o.offset+o.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=s.samples[e].offset+o.alreadyRead,null;var a=i||new r;a.endianness=r.BIG_ENDIAN;var h=this.createSingleSampleMoof(o);h.write(a),h.trafs[0].truns[0].data_offset=h.size+8,n.debug("MP4Box","Adjusting data_offset with new value "+h.trafs[0].truns[0].data_offset),a.adjustUint32(h.trafs[0].truns[0].data_offset_position,h.trafs[0].truns[0].data_offset);var d=new l.mdatBox;return d.data=o.data,d.write(a),a},c.writeInitializationSegment=function(t,e,i,s){var o;n.debug("ISOFile","Generating initialization segment");var a=new r;a.endianness=r.BIG_ENDIAN,t.write(a);var h=e.add("mvex");for(i&&h.add("mehd").set("fragment_duration",i),o=0;o<e.traks.length;o++)h.add("trex").set("track_id",e.traks[o].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",s).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(a),a.buffer},c.prototype.save=function(t){var e=new r;e.endianness=r.BIG_ENDIAN,this.write(e),e.save(t)},c.prototype.getBuffer=function(){var t=new r;return t.endianness=r.BIG_ENDIAN,this.write(t),t.buffer},c.prototype.initializeSegmentation=function(){var t,e,i,s;for(null===this.onSegment&&n.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var r=new l.moovBox;r.mvhd=this.moov.mvhd,r.boxes.push(r.mvhd),i=this.getTrackById(this.fragmentedTracks[t].id),r.boxes.push(i),r.traks.push(i),(s={}).id=i.tkhd.track_id,s.user=this.fragmentedTracks[t].user,s.buffer=c.writeInitializationSegment(this.ftyp,r,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),e.push(s)}return e},l.Box.prototype.printHeader=function(t){this.size+=8,this.size>o&&(this.size+=8),"uuid"===this.type&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},l.FullBox.prototype.printHeader=function(t){this.size+=4,l.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},l.Box.prototype.print=function(t){this.printHeader(t)},l.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var i=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=i}},c.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},l.mvhdBox.prototype.print=function(t){l.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},l.tkhdBox.prototype.print=function(t){l.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var u={createFile:function(t,e){var i=void 0===t||t,n=new c(e);return n.discardMdatData=!i,n}};t.createFile=u.createFile}(Vt);class Yt{constructor(t){this.url="",this.url=t.url,this.header=t.header,this.method=t.method,this.responseType=t.responseType||"arraybuffer",this.xhr=t.xhr}}class qt{constructor(){}setup(){}load(t){let e,i=t.request;if(i.xhr?e=i.xhr:(e=new XMLHttpRequest,i.xhr=e),e.open(i.method||"get",i.url),e.responseType=i.responseType,i.header)for(let t in i.header)e.setRequestHeader(t,i.header[t]);e.onreadystatechange=i=>{4===e.readyState&&(e.status>=200&&e.status<300||304===e.status?t.success&&t.success.call(e,e.response):t.error&&t.error.call(e,i))},e.onabort=i=>{t.abort&&t.abort.call(e,i)},e.onerror=i=>{t.error&&t.error.call(e,i)},e.onprogress=i=>{t.progress&&t.progress.call(e,i)},e.send()}}class Wt{constructor(t){this.isActive=!1,this.realtime=!1,this.chunkStart=0,this.chunkSize=0,this.totalLength=0,this.chunkTimeout=1e3,this.timeoutID=null,this.url="",this.callback=null,this.eof=!1,this.url=t||"",this.loader=new qt}start(){return Vt.Log.info("Downloader","Starting file download"),this.chunkStart=0,this.resume(),this}reset(){return this.chunkStart=0,this.totalLength=0,this.eof=!1,this}stop(){return window.clearTimeout(this.timeoutID),this.timeoutID=null,this.isActive=!1,this}resume(){return Vt.Log.info("Downloader","Resuming file download"),this.isActive=!0,0===this.chunkSize&&(this.chunkSize=1/0),this.getFile(),this}setUrl(t){return this.url=t,this}setRealTime(t){return this.realtime=t,this}setChunkSize(t){return this.chunkSize=t,this}setChunkStart(t){return this.chunkStart=t,this.eof=!1,this}setInterval(t){return this.chunkTimeout=t,this}setCallback(t){return this.callback=t,this}getFileLength(){return this.totalLength}isStopped(){return!this.isActive}initHttpRequest(){let t=new XMLHttpRequest,e={};if(t.start=this.chunkStart,this.chunkStart+this.chunkSize<1/0){let t=0,i="bytes="+this.chunkStart+"-";t=this.chunkStart+this.chunkSize-1,i+=t,e.Range=i}return new Yt({url:this.url,header:e,method:"get",xhr:t})}getFile(){let t=this;if(this.isStopped())return;if(0!==t.totalLength&&t.chunkStart>=t.totalLength&&(t.eof=!0),!0===t.eof)return Vt.Log.info("Downloader","File download done."),void t.callback(null,!0);let e=this.initHttpRequest();this.loader.load({request:e,error:function(e){t.callback(null,!1,!0)},success:function(e){let i=this.getResponseHeader("Content-Range");if(0===t.totalLength&&i){let e;e=i.indexOf("/"),e>-1&&(t.totalLength=+i.slice(e+1))}t.eof=this.response.byteLength!==t.chunkSize||this.response.byteLength===t.totalLength;let n=this.response;if(n.fileStart=this.start,t.callback(n,t.eof),!0===t.isActive&&!1===t.eof){let e=t.chunkTimeout;t.timeoutID=window.setTimeout(t.getFile.bind(t),e)}}})}}class Kt{constructor(t,e){this.lastSeekTime=0,this.url=t,this.player=e,this.init()}init(){this.mp4boxfile=Vt.createFile(),this.downloader=new Wt(this.url),this.mediaSource=new MediaSource,this.player.video.src=window.URL.createObjectURL(this.mediaSource),this.initEvent()}initEvent(){let t=this;this.mediaSource.addEventListener("sourceopen",t=>{this.loadFile()}),this.mp4boxfile.onMoovStart=function(){Vt.Log.info("Application","Starting to parse movie information")},this.mp4boxfile.onReady=function(e){Vt.Log.info("Application","Movie information received"),t.mediaInfo=e,e.isFragmented?t.mediaSource.duration=e.fragment_duration/e.timescale:t.mediaSource.duration=e.duration/e.timescale,t.stop(),t.initializeAllSourceBuffers()},this.mp4boxfile.onSegment=function(e,i,n,s,r){var o=i;o.segmentIndex++,o.pendingAppends.push({id:e,buffer:n,sampleNum:s,is_last:r}),t.onUpdateEnd.call(o,!0,!1,t)},this.player.on("seeking",t=>{var e,i,n,s;console.log("seeking");var r=this.player.video;if(this.lastSeekTime!==r.currentTime){for(e=0;e<r.buffered.length;e++)if(i=r.buffered.start(e),n=r.buffered.end(e),r.currentTime>=i&&r.currentTime<=n)return;this.downloader.stop(),s=this.mp4boxfile.seek(r.currentTime,!0),this.downloader.setChunkStart(s.offset),this.downloader.resume(),this.lastSeekTime=r.currentTime}})}start(){this.downloader.setChunkStart(this.mp4boxfile.seek(0,!0).offset),this.downloader.setChunkSize(1e6),this.downloader.setInterval(1e3),this.mp4boxfile.start(),this.downloader.resume()}reset(){}stop(){this.downloader.isStopped()||this.downloader.stop()}addBuffer(t){var e,i=t.id,n='video/mp4; codecs="'+t.codec+'"';if(!MediaSource.isTypeSupported(n))throw new Error(`你的浏览器不支持${n}媒体类型`);try{console.log("MSE - SourceBuffer #"+i,"Creation with type '"+n+"'"),(e=this.mediaSource.addSourceBuffer(n)).addEventListener("error",(function(t){Vt.Log.error("MSE SourceBuffer #"+i,t)})),e.ms=this.mediaSource,e.id=i,this.mp4boxfile.setSegmentOptions(i,e),e.pendingAppends=[]}catch(t){Vt.Log.error("MSE - SourceBuffer #"+i,"Cannot create buffer with type '"+n+"'"+t)}}loadFile(){let t=this;"open"===this.mediaSource.readyState&&(this.downloader.setInterval(500),this.downloader.setChunkSize(1e6),this.downloader.setUrl(this.url),this.downloader.setCallback((function(e,i,n){var s=0;e&&(s=t.mp4boxfile.appendBuffer(e,i)),i?t.mp4boxfile.flush():t.downloader.setChunkStart(s),n&&t.reset()})),this.downloader.start())}initializeAllSourceBuffers(){if(this.mediaInfo){for(var t=this.mediaInfo,e=0;e<t.tracks.length;e++){var i=t.tracks[e];this.addBuffer(i)}this.initializeSourceBuffers()}}initializeSourceBuffers(){for(var t=this.mp4boxfile.initializeSegmentation(),e=0;e<t.length;e++){var i=t[e].user;0===e&&(i.ms.pendingInits=0),this.onInitAppended=this.onInitAppended.bind(this),i.onupdateend=this.onInitAppended,Vt.Log.info("MSE - SourceBuffer #"+i.id,"Appending initialization data"),i.appendBuffer(t[e].buffer),i.segmentIndex=0,i.ms.pendingInits++}}onInitAppended(t){let e=this;var i=t.target;"open"===i.ms.readyState&&(i.sampleNum=0,i.onupdateend=null,i.addEventListener("updateend",this.onUpdateEnd.bind(i,!0,!0,e)),this.onUpdateEnd.call(i,!1,!0,e),i.ms.pendingInits--,0===i.ms.pendingInits&&this.start())}onUpdateEnd(t,e,i){if(!0===e&&(this.sampleNum&&(i.mp4boxfile.releaseUsedSamples(this.id,this.sampleNum),delete this.sampleNum),this.is_last&&this.ms.endOfStream()),"open"===this.ms.readyState&&!1===this.updating&&this.pendingAppends.length>0){var n=this.pendingAppends.shift();this.sampleNum=n.sampleNum,this.is_last=n.is_last,this.appendBuffer(n.buffer)}}}var Xt;Pt(".video-mobile-medium-wrapper {\n  position: absolute;\n  height: 40px;\n  width: 40%;\n  padding: 5px;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 100;\n  border-radius: 5px;\n  top: 50%;\n  left: 50%;\n  -webkit-transform: translateX(-50%) translateY(-50%);\n          transform: translateX(-50%) translateY(-50%);\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.video-mobile-medium-wrapper .video-mobile-medium-iconbox {\n  height: 100%;\n  min-width: 30px;\n}\n.video-mobile-medium-wrapper .video-mobile-medium-iconbox svg {\n  height: 100%;\n  width: 100%;\n}\n.video-mobile-medium-wrapper .video-mobile-medium-iconbox svg path {\n  fill: #fff;\n}\n.video-mobile-medium-wrapper .video-mobile-medium-progressbox {\n  height: 3px;\n  background-color: #fff;\n  -webkit-box-flex: 0.9;\n  -webkit-flex-grow: 0.9;\n      -ms-flex-positive: 0.9;\n          flex-grow: 0.9;\n  margin-left: 5px;\n  border-radius: 3px;\n}\n.video-mobile-medium-wrapper .video-mobile-medium-progressbox .video-mobile-medium-completed {\n  background-color: #007aff;\n  height: 100%;\n  width: 0;\n}\n");class $t extends T{constructor(t,e,i,n,s){super(e,i,n,s),this.id="MobileVolume",this.timer=0,this.player=t,this.props=n||{},this.init()}init(){this.initTemplate(),this.initEvent()}initTemplate(){p(this.el,["video-mobile-medium-wrapper"]),this.el.style.display="none",this.iconBox=l("div.video-mobile-medium-iconbox"),this.progressBox=l("div.video-mobile-medium-progressbox"),this.completedBox=l("div.video-mobile-medium-completed",{style:{width:"0px"}}),this.icon=b(K),this.iconBox.appendChild(this.icon),this.progressBox.appendChild(this.completedBox),this.el.appendChild(this.iconBox),this.el.appendChild(this.progressBox)}initEvent(){let t=this.completedBox.clientWidth;this.player.on(n.MOVE_VERTICAL,e=>{this.timer&&window.clearInterval(this.timer),this.timer=null,this.el.style.display="";let i=e.deltaY,n=(t+-i)/this.progressBox.clientWidth;n<0?n=0:n>1&&(n=1),this.completedBox.style.width=100*n+"%",this.player.video.volume=n}),this.player.on(n.SLIDE_VERTICAL,e=>{t=this.completedBox.clientWidth,this.timer=window.setTimeout(()=>{this.el.style.display="none"},600)}),this.player.on(n.VIDEO_CLICK,()=>{this.el.style.display="none"})}}class Qt{constructor(t,e){this.player=t,this.subtitles=e,this.init()}init(){this.initTemplate(),this.initTextTrack(),this.initEvent(),St(()=>{let t=this;this.subsettingsSubtitle=Et.instance,this.subtitles.forEach(e=>{let i=null;e===this.defaultSubtitle&&(i=b(it,"0 0 1024 1024"));let n=this.subsettingsSubtitle.registerSubsettingsItem({leftIcon:i,leftText:e.tip,target:yt,click:i=>{this.leadItem.instance.rightTipBox.innerText=i.leftText,t.trackElement.src=e.source;for(let e in t.subtitles)t.subtitles[e].instance.leftIconBox.innerHTML="",i.leftIcon&&delete i.leftIcon,t.subtitles[e].instance===i.instance&&(i.leftIcon=b(it,"0 0 1024 1024"),t.subtitles[e].instance.leftIconBox.appendChild(i.leftIcon))}});e.instance=n.instance})})}initTemplate(){this.el=l("div.video-texttrack-container"),this.player.el.appendChild(this.el),this.subsettingsMain=yt.instance,this.leadItem=this.subsettingsMain.registerSubsettingsItem({leftIcon:_(["M803.6 150.498H220.4c-65.286 0-118.4 53.114-118.4 118.4v486.203c0 65.286 53.114 118.4 118.4 118.4h583.2c65.286 0 118.4-53.114 118.4-118.4V268.898c0-65.286-53.114-118.4-118.4-118.4zM862 755.102c0 32.202-26.198 58.4-58.4 58.4H220.4c-32.202 0-58.4-26.198-58.4-58.4V268.898c0-32.202 26.198-58.4 58.4-58.4h583.2c32.202 0 58.4 26.198 58.4 58.4v486.204z","M691.841 322.542H332.159c-16.568 0-30 13.432-30 30s13.432 30 30 30H482v288.917c0 16.568 13.432 30 30 30 16.569 0 30-13.432 30-30V382.542h149.841c16.568 0 30-13.432 30-30s-13.432-30-30-30z"],"0 0 1024 1024"),leftText:"字幕设置",rightTip:"默认",rightIcon:b(J,"0 0 1024 1024"),target:Et})}initTextTrack(){this.xhrLoader=new qt,this.onsuccess=this.onsuccess.bind(this),this.defaultSubtitle=this.subtitles[0];for(let t of this.subtitles)if(t.default){this.defaultSubtitle=t;break}this.trackElement=document.createElement("track"),this.player.video.appendChild(this.trackElement),this.player.on("HideSubtitle",()=>{this.currentSource=this.trackElement.src,this.trackElement.src="",this.el.innerHTML=""}),this.player.on("ShowSubtitle",()=>{this.trackElement.src=this.currentSource}),this.loadVTTFile(this.defaultSubtitle.source)}initEvent(){this.player.on(n.SHOW_TOOLBAR,()=>{p(this.el,["video-texttrack-container-showtoolbar"])}),this.player.on(n.HIDE_TOOLBAR,()=>{c(this.el,["video-texttrack-container-showtoolbar"])}),this.textTrack=this.player.video.textTracks[0],this.textTrack.mode="hidden",this.textTrack.addEventListener("cuechange",t=>{this.el.innerHTML="",this.textTrack.activeCues.length>0&&[...this.textTrack.activeCues].forEach(t=>{if(!t)return;t.text.split("\n").forEach(t=>{let e=l("p");e.innerText=t,this.el.appendChild(e)})})})}loadVTTFile(t){let e=new Yt({url:t,method:"get"});this.xhrLoader.load({request:e,success:t=>{this.onsuccess(t)}})}onsuccess(t){let e=window.URL.createObjectURL(new Blob([t]));this.trackElement.src=e,this.trackElement.default=!0,this.trackElement.srclang=this.defaultSubtitle.tip,this.trackElement.kind="subtitles"}}class Zt extends T{constructor(t){super(t.container,"div.Niplayer_video-wrapper"),this.id="Player",this.enableSeek=!0,this.env=wt.env,this.fullScreenMode="Horizontal",this.mediaProportion=9/16,this.playerOptions=Object.assign({autoPlay:!1,streamPlay:!1},t),this.container=t.container,this.containerHeight=t.container.clientHeight,this.containerWidth=t.container.clientWidth,this.init()}init(){var t;this.playerOptions.video?(this.video=this.playerOptions.video,this.video.parentNode&&this.video.parentNode.removeChild(this.video)):(this.video=l("video"),this.video.playsinline=!0,this.video["x5-video-player-type"]="h5"),this.video.crossOrigin="anonymous",this.el.appendChild(this.video),(null===(t=this.playerOptions)||void 0===t?void 0:t.url)&&this.attachSource(this.playerOptions.url),this.initComponent(),this.initTemplate(),this.initEvent(),this.initPlugin(),this.initResizeObserver(),this.checkFullScreenMode()}initTemplate(){"Mobile"===this.env&&(this.unmountComponent("Volume"),new $t(this,this.el,"div"))}initComponent(){this.loading=new C(this,"视频姬正在努力加载中(⑅˃◡˂⑅)",this.el),this.error=new B(this,"你的网络罢工啦Q_Q",this.el),this.toolBar=new At(this,this.el,"div"),this.topbar=new It(this,this.el,"div"),this.playerOptions.subtitles&&this.playerOptions.subtitles.length>0&&new Qt(this,this.playerOptions.subtitles),this.playerOptions.danmaku&&this.playerOptions.danmaku.open&&(this.danmakuController=new jt(this,this.playerOptions.danmaku))}initEvent(){"Mobile"===this.env?this.initMobileEvent():this.initPCEvent(),this.video.addEventListener("loadedmetadata",t=>{this.emit(n.LOADED_META_DATA,t),this.adjustMediaSize()}),this.video.addEventListener("timeupdate",t=>{this.emit(n.TIME_UPDATE,t)}),this.video.addEventListener("play",t=>{this.emit(n.PLAY,t)}),this.video.addEventListener("pause",t=>{this.emit(n.PAUSE,t)}),this.video.addEventListener("seeking",t=>{this.enableSeek&&this.emit(n.SEEKING,t)}),this.video.addEventListener("waiting",t=>{this.emit(n.WAITING,t)}),this.video.addEventListener("canplay",t=>{this.emit(n.CAN_PLAY,t)}),this.video.addEventListener("error",t=>{this.emit(n.ERROR)}),this.video.addEventListener("abort",t=>{this.emit(n.ERROR)}),this.video.addEventListener("ratechange",t=>{this.emit(n.RATE_CHANGE)}),this.on(n.DANMAKU_INPUT_FOCUS,()=>{this.el.onmouseleave=null}),this.on(n.DANMAKU_INPUT_BLUR,()=>{this.el.onmouseleave=t=>{this.emit(n.HIDE_TOOLBAR,t)}}),this.on(n.DOT_DOWN,()=>{this.enableSeek=!1}),this.on(n.DOT_UP,()=>{this.enableSeek=!0}),this.on(n.VIDEO_DOT_DRAG,(t,e)=>{this.emit(n.SHOW_TOOLBAR,e)}),this.on(n.ENTER_FULLSCREEN,()=>{document.querySelectorAll(".video-controller").forEach(t=>{t.style.marginRight="15px"}),document.querySelectorAll(".video-topbar-controller").forEach(t=>{t.style.marginRight="15px"})}),this.on(n.LEAVE_FULLSCREEN,()=>{document.querySelectorAll(".video-controller").forEach(t=>{t.style.marginRight=""}),document.querySelectorAll(".video-topbar-controller").forEach(t=>{t.style.marginRight=""})})}initPCEvent(){this.el.onclick=t=>{this.video.paused?this.video.play():this.video.played&&this.video.pause()},this.el.onmousemove=t=>{this.emit(n.SHOW_TOOLBAR,t)},this.el.onmouseenter=t=>{this.emit(n.SHOW_TOOLBAR,t)},this.el.onmouseleave=t=>{this.video.paused||this.emit(n.HIDE_TOOLBAR,t)}}initMobileEvent(){R(this.video).addEventListener("singleTap",t=>{"hidden"===this.toolBar.status?this.emit(n.SHOW_TOOLBAR,t):this.emit(n.HIDE_TOOLBAR,t),this.emit(n.VIDEO_CLICK)}),R(this.video).addEventListener("doubleTap",t=>{this.video.paused?this.video.play():this.video.played&&this.video.pause()}),R(this.video).addEventListener("move",t=>{let e=t.deltaX,i=t.deltaY;dt(e,i)>=75?this.emit(n.MOVE_VERTICAL,t):dt(e,i)<=15&&this.emit(n.MOVE_HORIZONTAL,t)}),R(this.video).addEventListener("swipe",t=>{let e=t.endPos.x-t.startPos.x,i=t.endPos.y-t.startPos.y;dt(e,i)>=75?this.emit(n.SLIDE_VERTICAL,t):dt(e,i)<=15&&this.emit(n.SLIDE_HORIZONTAL,t)})}initPlugin(){this.playerOptions.plugins&&this.playerOptions.plugins.forEach(t=>{this.use(t)})}attachSource(t){this.playerOptions.streamPlay?new Kt(t,this):this.video.src=t}initResizeObserver(){new ResizeObserver(t=>{let e;if(this.emit(n.RESIZE,t),this.adjustMediaSize(),t[0].contentRect.width<=500)j.forEach((t,i)=>{-1!==["SubSetting"].indexOf(i)?(e=V.get(i),this.unmountComponent(i)):-1!==["PicInPic","Playrate","ScreenShot","SubSetting","VideoShot"].indexOf(i)&&(Y.get(i)||this.hideComponent(i))}),this.mountComponent(e.id,e,{mode:{type:"TopToolBar",pos:"right"}}),p(e.el,["video-subsettings","video-topbar-controller"]);else if(Y.forEach((t,e)=>{this.showComponent(e)}),j.has("SubSetting")){let t="SubSetting",e=V.get(t);this.unmountComponent(t),this.mountComponent(t,e,{mode:{type:"BottomToolBar",pos:"right"},index:1}),p(e.el,["video-subsettings","video-controller"])}}).observe(this.el)}adjustMediaSize(){0!==this.mediaProportion&&(this.el.clientHeight/this.el.clientWidth>this.mediaProportion?(this.video.style.width="100%",this.video.style.height=this.el.clientWidth*this.mediaProportion+.05*this.el.clientWidth+"px"):(this.video.style.height="100%",this.video.style.width=this.el.clientHeight/this.mediaProportion+"px"))}checkFullScreenMode(){}mountComponent(t,e,i){if(j.has(t))throw new Error("无法挂载一个已经存在于视图上的组件，请先将其卸载或者删除");if(j.set(t,e),V.has(t)||V.set(t,e),i){let t=i.mode;if("BottomToolBar"===t.type){let n;"left"===t.pos?n=this.toolBar.controller.leftArea:"right"===t.pos?n=this.toolBar.controller.rightArea:"medium"===t.pos&&(n=this.toolBar.controller.mediumArea);let s=[...n.children];if(i.index){if(i.index<0)throw new Error("index不能传入负值");n.insertBefore(e.el,s[i.index]||null)}else n.appendChild(e.el)}else if("TopToolBar"===t.type){let n;n="left"===t.pos?this.topbar.leftArea:this.topbar.rightArea;let s=[...n.children];if(i.index){if(i.index<0)throw new Error("index不能传入负值");n.insertBefore(e.el,s[i.index]||null)}else n.appendChild(e.el)}else"AnyPosition"===t.type&&this.el.appendChild(e.el);e.container=e.el.parentElement}else{if(!e.container)throw new Error("必须传入Options选项或者传入的组件实例中需要有container选项");e.container.appendChild(e.el)}}updateComponent(t,e,i){if(!j.get(t))throw new Error("该组件不存在或者已经被卸载");x(j.get(t),e,i)}hideComponent(t){if(!j.get(t))throw new Error("无法隐藏一个未挂载在视图上的组件");if(Y.get(t))throw new Error("该元素已经隐藏");let e=j.get(t);e.el.style.display="none",Y.set(t,e)}showComponent(t){if(!Y.get(t))throw new Error("该元素已经隐藏");if(!j.get(t))throw new Error("该元素不存在或者被卸载");j.get(t).el.style.display="",Y.delete(t)}unmountComponent(t){if(!j.has(t))throw new Error("该组件不存在或者已经被卸载");let e=j.get(t);e.el.parentElement.removeChild(e.el),c(e.el,[...e.el.classList]),j.delete(t)}deleteComponent(t){j.has(t)&&this.unmountComponent(t),V.delete(t)}use(t){t.install(this)}}Xt=Zt,Zt.player=Xt}}]);